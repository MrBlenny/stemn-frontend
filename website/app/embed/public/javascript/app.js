"use strict";function uiCodemirrorDirective(a,b,c){function d(a,c,d,i){var j=angular.extend({value:c.text()},b.codemirror||{},a.$eval(d.uiCodemirror),a.$eval(d.uiCodemirrorOpts)),k=e(c,j);f(k,d.uiCodemirror||d.uiCodemirrorOpts,a),g(k,i,a),h(k,d.uiRefresh,a),a.$on("CodeMirror",function(a,b){if(!angular.isFunction(b))throw new Error("the CodeMirror event requires a callback function");b(k)}),angular.isFunction(j.onLoad)&&j.onLoad(k)}function e(a,b){var c;return"TEXTAREA"===a[0].tagName?c=window.CodeMirror.fromTextArea(a[0],b):(a.html(""),c=new window.CodeMirror(function(b){a.append(b)},b)),c}function f(a,b,c){function d(b,c){angular.isObject(b)&&e.forEach(function(d){if(b.hasOwnProperty(d)){if(c&&b[d]===c[d])return;a.setOption(d,b[d])}})}if(b){var e=Object.keys(window.CodeMirror.defaults);c.$watch(b,d,!0)}}function g(b,c,d){c&&(c.$formatters.push(function(a){if(angular.isUndefined(a)||null===a)return"";if(angular.isObject(a)||angular.isArray(a))throw new Error("ui-codemirror cannot use an object or an array as a model");return a}),c.$render=function(){var d=c.$viewValue||"";b.setValue(d),a(function(){b.refresh()})},b.on("change",function(a){var b=a.getValue();b!==c.$viewValue&&d.$evalAsync(function(){c.$setViewValue(b)})}))}function h(b,c,d){c&&d.$watch(c,function(c,d){c!==d&&a(function(){b.refresh()})})}return{restrict:"EA",require:"?ngModel",compile:function(){return d}}}function mdIconDirective(a,b,c,d){function e(e,g,h){function i(){var a=g.parent();return a.attr("aria-label")||a.text()?!0:!(!a.parent().attr("aria-label")&&!a.parent().text())}function j(){h.mdSvgIcon||h.mdSvgSrc||(h.mdFontIcon&&g.addClass("md-font "+h.mdFontIcon),g.addClass(m))}function k(){if(!h.mdSvgIcon&&!h.mdSvgSrc){h.mdFontIcon&&(g.removeClass(l),g.addClass(h.mdFontIcon),l=h.mdFontIcon);var b=a.fontSet(h.mdFontSet);m!==b&&(g.removeClass(m),g.addClass(b),m=b)}}b(g);var l=h.mdFontIcon,m=a.fontSet(h.mdFontSet);j(),h.$observe("mdFontIcon",k),h.$observe("mdFontSet",k);var n=g[0].getAttribute(h.$attr.mdSvgSrc),o=h.alt||h.mdFontIcon||h.mdSvgIcon||g.text(),p=h.$normalize(h.$attr.mdSvgIcon||h.$attr.mdSvgSrc||"");h["aria-label"]||(""===o||i()?g.text()||c.expect(g,"aria-hidden","true"):(c.expect(g,"aria-label",o),c.expect(g,"role","img"))),p&&h.$observe(p,function(b){f(b)||b!==n||(b=d.trustAsUrl(b)),g.empty(),b&&a(b).then(function(a){g.empty(),g.append(a)})})}function f(a){var b=/^data:image\/svg\+xml[\s*;\w\-\=]*?(base64)?,(.*)$/i;return b.test(a)}return{restrict:"E",link:e}}function MdIconProvider(){}function ConfigurationItem(a,b){this.url=a,this.viewBoxSize=b||config.defaultViewBoxSize}function MdIconService(a,b,c,d,e,f){function g(b){if(b=b||"",angular.isString(b)||(b=f.getTrustedUrl(b)),r[b])return c.when(i(r[b]));if(t.test(b)||u.test(b))return m(b).then(j(b));-1==b.indexOf(":")&&(b="$default:"+b);var d=a[b]?k:l;return d(b).then(j(b))}function h(b){var c=angular.isUndefined(b)||!(b&&b.length);if(c)return a.defaultFontSet;var d=b;return angular.forEach(a.fontSets,function(a){a.alias==b&&(d=a.fontSet||d)}),d}function i(a){var b=a.clone(),c="_cache"+e.nextUid();return b.id&&(b.id+=c),angular.forEach(b.querySelectorAll("[id]"),function(a){a.id+=c}),b}function j(b){return function(c){return r[b]=n(c)?c:new o(c,a[b]),r[b].clone()}}function k(b){var c=a[b];return m(c.url).then(function(a){return new o(a,c)})}function l(b){function e(a){var c=b.slice(b.lastIndexOf(":")+1),d=a.querySelector("#"+c);return d?new o(d,h):f(b)}function f(a){var b="icon "+a+" not found";return d.warn(b),c.reject(b||a)}var g=b.substring(0,b.lastIndexOf(":"))||"$default",h=a[g];return h?m(h.url).then(e):f(b)}function m(a){function e(a){var b=u.exec(a),d=/base64/i.test(a),e=d?window.atob(b[2]):b[2];return c.when(angular.element(e)[0])}function f(a){return c(function(c,e){var f=function(a){var b=angular.isString(a)?a:a.message||a.data||a.statusText;d.warn(b),e(a)},g=function(b){s[a]||(s[a]=angular.element("<div>").append(b)[0].querySelector("svg")),c(s[a])};b(a,!0).then(g,f)})}return u.test(a)?e(a):f(a)}function n(a){return angular.isDefined(a.element)&&angular.isDefined(a.config)}function o(a,b){a&&"svg"!=a.tagName&&(a=angular.element('<svg xmlns="http://www.w3.org/2000/svg">').append(a.cloneNode(!0))[0]),a.getAttribute("xmlns")||a.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.element=a,this.config=b,this.prepare()}function p(){var b=this.config?this.config.viewBoxSize:a.defaultViewBoxSize;angular.forEach({fit:"",height:"100%",width:"100%",preserveAspectRatio:"xMidYMid meet",viewBox:this.element.getAttribute("viewBox")||"0 0 "+b+" "+b,focusable:!1},function(a,b){this.element.setAttribute(b,a)},this)}function q(){return this.element.cloneNode(!0)}var r={},s={},t=/[-\w@:%\+.~#?&\/\/=]{2,}\.[a-z]{2,4}\b(\/[-\w@:%\+.~#?&\/\/=]*)?/i,u=/^data:image\/svg\+xml[\s*;\w\-\=]*?(base64)?,(.*)$/i;return o.prototype={clone:q,prepare:p},g.fontSet=h,g}!function(){function a(a,b){b.html5Mode(!0),a.otherwise("/")}function b(a,b,c){a.$state=b,a.$stateParams=c}var c=["ngAnimate","templates","ui.router","angular-loading-bar","views.app","views.preview","views.home","views.error","views.preview-github","modules.core","modules.filters","modules.preview","modules.sync","modules.moment","modules.lazy-loading","modules.code-mirror"];angular.module("app",c),angular.module("app").config(a).run(b),a.$inject=["$urlRouterProvider","$locationProvider"],b.$inject=["$rootScope","$state","$stateParams"]}(),angular.module("material.components.icon",[]),angular.module("modules.preview",["modules.preview.cad","modules.preview.code","modules.preview.files","modules.preview.gerber","modules.preview.pcb","modules.preview.pdf"]),angular.module("modules.preview"),angular.module("views.app",[]),angular.module("views.app").config(["$stateProvider",function(a){a.state("app",{"abstract":!0,templateUrl:"app/views/app/app.tpl.html",controller:"AppViewCtrl",data:{pageTitle:"Home",viewClass:"home"}})}]),angular.module("views.error",[]),angular.module("views.error").run(["$rootScope","$state","$timeout",function(a,b,c){a.$on("$stateChangeError",function(a,c,d,e,f,g){b.go("app.error",null,{location:!1})})}]).config(["$stateProvider",function(a){a.state("app.error",{templateUrl:"app/views/error/error.tpl.html",controller:"ErrorViewCtrl",url:"/error",data:{pageTitle:"Error",viewClass:"error"}})}]),angular.module("views.home",[]),angular.module("views.home").config(["$stateProvider",function(a){a.state("app.home",{templateUrl:"app/views/home/home.tpl.html",controller:"HomeViewCtrl",url:"/",data:{pageTitle:"Home",viewClass:"home"}})}]),angular.module("views.preview-github",[]),angular.module("views.preview-github").config(["$stateProvider",function(a){a.state("app.preview-github",{url:"/preview-github?path",templateUrl:"app/views/preview-github/preview-github.tpl.html",controller:"PreviewGithubViewCtrl",data:{pageTitle:"Preview",viewClass:"preview"}})}]),angular.module("views.preview",[]),angular.module("views.preview").config(["$stateProvider",function(a){a.state("app.preview",{url:"/preview/:projectStub/:pathRev?children",templateUrl:"app/views/preview/preview.tpl.html",controller:"PreviewViewCtrl",data:{pageTitle:"Preview",viewClass:"preview"},resolve:{project:["$stateParams","$http",function(a,b){return b({method:"GET",url:"api/v1/projects/"+a.projectStub,params:{select:["stub","name","picture","blurb","permissions","team"]}}).then(function(a){return a.data})}],fileMeta:["SyncService","SyncUtilService","$stateParams","SyncUrlService",function(a,b,c,d){var e=d.parseChildren(c.children),f=d.parsePath(c.pathRev);return a.metadataVirtual(c.projectStub,f,e)}]}})}]),angular.module("ui.codemirror",[]).constant("uiCodemirrorConfig",{}).directive("uiCodemirror",uiCodemirrorDirective),uiCodemirrorDirective.$inject=["$timeout","uiCodemirrorConfig","CodeMirrorService"],angular.module("modules.code-mirror",["ui.codemirror"]),angular.module("modules.code-mirror").service("CodeMirrorService",["LazyLoadingService",function(a){function b(a,b){b&&(window.CodeMirror.modeURL=window.rootHostDomain+"/assets/js/codemirror/mode/%N/%N.js",window.CodeMirror.autoLoadMode(a,b),a.setOption("mode",b))}this.changeCodeMode=b}]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};angular.module("modules.core",[]),angular.module("modules.core").service("CoreLibrary",["$state",function(a){var b=this;this.getUuid=function(){var a="abcdef0123456789abcdef0123456789";return _.sample(a,24).join("")},this.getRandomString=function(a){var b="abcdefghijklmnopqrstuvwxyz0123456789";return _.sample(b,a||30).join("")},this.keyCodes={BACKSPACE:8,TABKEY:9,RETURNKEY:13,ESCAPE:27,SPACEBAR:32,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40},this.stubify=function(a){return a.toLowerCase().replace(/ /g,"-").replace(/[^a-z0-9\-]+/g,"")},this.stringTruncate=function(a,b){var c,d;if(c=a.split(""),c.length>b){for(d=c.length-1;d>-1;--d)if(d>b)c.length=d;else if(" "===c[d]){c.length=d;break}c.push("...")}return c.join("")},this.pluralise=function(a,b){if("People"==b)return 1==a?a+" Person":a+" People";var c=b[b.length];return 1==a?a+" "+b:"y"==c?a+" "+b.substring(0,b.length-1)+"ies":a+" "+b+"s"},this.capitalizeFirstLetter=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},this.getCurrentTab=function(b){var c,d=_.map(b,"sref"),e=a.current.name.replace("app.","");return _.forEach(d,function(a,b){var d=a.indexOf(e);-1!==d&&(c=b)}),c>=0||_.forEach(d,function(a,b){var d=a.indexOf(e.substring(0,e.lastIndexOf(".")));-1!==d&&(c=b)}),c},this.isObjectId=function(a){return/^[a-f0-9]{24}$/.test(a)},this.compactObject=function(a){return _.each(a,function(b,c){b||delete a[c]}),a},this.assignArray=function(a,b,c){var d=_.map(a,c),e=_.map(b,c);b.forEach(function(b){var e=d.indexOf(b[c]);-1==e&&a.splice(e,0,b)});var f=[];a.forEach(function(a,b){var d=e.indexOf(a[c]);-1==d&&f.push(b)}),_.forEachRight(f,function(b){a.splice(b,1)})},this.groupByKey=function(a,b){return _.reduce(a,function(a,c){var d=c[b];return a[d]?a[d].push(c):a[d]=[c],a},{})},this.uniqueArray=function(a,b){var c=[];_.forEachRight(a,function(d,e){-1!=c.indexOf(d[b])&&a.splice(e,1),c.push(d[b])})},this.checkStateParents=function(a,b){function c(a,b){a.self[b]?null!==a.self[b]&&"object"===_typeof(a.self[b])?(_.forEach(a.self[b],function(a,b){void 0===d[b]&&(d[b]=a)}),c(a.parent,b)):d=a.self[b]:a.parent&&c(a.parent,b)}var d={};return c(a,b),d},this.getDateFromId=function(a){return new Date(1e3*parseInt(a.toString().substring(0,8),16))},this.checkStateParentsSeo=function(a,c,d,e){function f(d,f){return d[f]?d[f]:b.checkStateParentsSeo(a.parent,c,f,e)}return a?a.self[c]?f(a.self[c](e),d):b.checkStateParentsSeo(a.parent,c,d,e):void 0}}]),angular.module("modules.filters",[]),angular.module("modules.filters").filter("capitaliseFirst",function(){return function(a){return a=a||"",a.substring(0,1).toUpperCase()+a.substring(1).toLowerCase()}}).filter("nospace",function(){return function(a){return a?a.replace(/ /g,""):""}}).filter("trustAsResourceUrl",["$sce",function(a){return function(b){return a.trustAsResourceUrl(b)}}]).filter("reverse",function(){return function(a){return a?a.slice().reverse():void 0}}).filter("money",["CoreLibrary",function(a){return function(b,c){var d,e,f,g="",h=a.getCurrencies();if(h[c]&&(g=h[c].symbol),b)if(e=b.toString(),f=e.split(".")[0],f.length>=4){var i=0;d=parseInt(e)/1e3,4==f.length&&(i=1),d=d.toFixed(i)+"k"}else d=e;return g+d}}]).filter("bytes",function(){return function(a,b){if("0"===a||0===a||isNaN(parseFloat(a))||!isFinite(a))return"-";"undefined"==typeof b&&(b=1);var c=["B","kB","MB","GB","TB","PB"],d=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(d))).toFixed(b)+" "+c[d]}}).filter("words",function(){return function(a,b){if(isNaN(b))return a;if(0>=b)return"";if(a){var c=a.split(/\s+/);c.length>b&&(a=c.slice(0,b).join(" ")+"…")}return a}}).filter("trustAsHtml",["$sce",function(a){return a.trustAsHtml}]).filter("letters",function(){return function(a,b){return isNaN(b)?a:0>=b?"":(a&&a.length>b&&(a=a.slice(0,b)+"…"),a)}}).filter("orderObjectBy",function(){return function(a,b){if(!angular.isObject(a))return a;var c=[];for(var d in a)c.push(a[d]);return c.sort(function(a,c){return a=parseInt(a[b]),c=parseInt(c[b]),a-c}),c}}).filter("hasValue",function(){return function(a){return null===a?!1:""!==a}}).filter("firstWord",function(){return function(a){return a=a.split(" ")[0]}}).filter("lastWord",function(){return function(a){return a=a.split(" ").pop()}}).filter("isEmptyObject",["$filter",function(a){return function(b){return _.every(b,function(b,c){return _.isArray(b)?_.every(b,a("isEmptyObject")):"$$hashKey"===c?!0:_.isEmpty(b)})}}]).filter("consolelog",function(){return function(a){console.log(a)}}).filter("trueValues",function(){return function(a){var b=[];return _.each(a,function(a,c){if(a===!0){var d={};d[c]=a,b.push(d)}}),b}}).filter("values",function(){return function(a){var b=[];return _.each(a,function(a,c){var d={};d[c]=a,b.push(d)}),b}}).filter("toJSON",function(){return function(a){return JSON.stringify(a,null,4)}}).filter("stripHttp",function(){return function(a){return a.toString().replace("http://","").replace("https://","").replace("www.","").replace("http://www.","").replace("https://www.","")}}).filter("typeaheadHighlightMatch",function(){function a(a){return a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(b,c){return c?(""+b).replace(new RegExp("\\b"+a(c),"gi"),"<strong>$&</strong>"):b}}),angular.module("modules.lazy-loading",[]),angular.module("modules.lazy-loading").directive("imageOnLoad",function(){return{restrict:"A",link:function(a,b,c){b.bind("load",function(){a.$apply(c.imageOnLoad)}),b.bind("error",function(){})}}}).service("LazyLoadingService",["$document","$q","$window",function(a,b,c){function d(a){var c=[];return _.forEach(a,function(a){if(g.registeredResources[a.src])g.registeredResources[a.src]!==!0&&c.push(g.registeredResources[a.src]);else{var b,d=a.src.indexOf("?");b=d>0?a.src.substring(0,a.src.indexOf("?")).split("."):a.src.split(".");var h=a.type||b[b.length-1];"js"==h?c.push(f(a.src,a.global)):"css"==h?c.push(e(a.src)):console.error("Unsupported file type")}}),b.all(c)}function e(c){var d=b.defer();g.registeredResources[c]=d.promise;var e=function(){g.registeredResources[c]=!0,d.resolve("Styles Loaded")},f=a[0].createElement("link");return f.href=c,f.rel="stylesheet",f.type="text/css",f.onreadystatechange=function(){"complete"==this.readyState&&e()},f.onload=e,a[0].getElementsByTagName("head")[0].appendChild(f),d.promise}function f(d,e){var f=b.defer();g.registeredResources[d]=f.promise;var h=function(){g.registeredResources[d]=!0,c[e]?f.resolve(c[e]):f.resolve("Js Loaded")},i=a[0].createElement("script");return i.type="text/javascript",i.async=!0,i.src=d,i.onreadystatechange=function(){"complete"==this.readyState&&h()},i.onload=h,a[0].getElementsByTagName("body")[0].appendChild(i),f.promise}var g=this;this.load=d,this.registeredResources={}}]),angular.module("material.components.icon").directive("mdIcon",["$mdIcon","$mdTheming","$mdAria","$sce",mdIconDirective]),angular.module("material.components.icon").constant("$$mdSvgRegistry",{mdTabsArrow:"data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxnPjxwb2x5Z29uIHBvaW50cz0iMTUuNCw3LjQgMTQsNiA4LDEyIDE0LDE4IDE1LjQsMTYuNiAxMC44LDEyICIvPjwvZz48L3N2Zz4=",mdClose:"data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxnPjxwYXRoIGQ9Ik0xOSA2LjQxbC0xLjQxLTEuNDEtNS41OSA1LjU5LTUuNTktNS41OS0xLjQxIDEuNDEgNS41OSA1LjU5LTUuNTkgNS41OSAxLjQxIDEuNDEgNS41OS01LjU5IDUuNTkgNS41OSAxLjQxLTEuNDEtNS41OS01LjU5eiIvPjwvZz48L3N2Zz4=",mdCancel:"data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxnPjxwYXRoIGQ9Ik0xMiAyYy01LjUzIDAtMTAgNC40Ny0xMCAxMHM0LjQ3IDEwIDEwIDEwIDEwLTQuNDcgMTAtMTAtNC40Ny0xMC0xMC0xMHptNSAxMy41OWwtMS40MSAxLjQxLTMuNTktMy41OS0zLjU5IDMuNTktMS40MS0xLjQxIDMuNTktMy41OS0zLjU5LTMuNTkgMS40MS0xLjQxIDMuNTkgMy41OSAzLjU5LTMuNTkgMS40MSAxLjQxLTMuNTkgMy41OSAzLjU5IDMuNTl6Ii8+PC9nPjwvc3ZnPg==",mdMenu:"data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxwYXRoIGQ9Ik0zLDZIMjFWOEgzVjZNMywxMUgyMVYxM0gzVjExTTMsMTZIMjFWMThIM1YxNloiIC8+PC9zdmc+",mdToggleArrow:"data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgNDggNDgiPjxwYXRoIGQ9Ik0yNCAxNmwtMTIgMTIgMi44MyAyLjgzIDkuMTctOS4xNyA5LjE3IDkuMTcgMi44My0yLjgzeiIvPjxwYXRoIGQ9Ik0wIDBoNDh2NDhoLTQ4eiIgZmlsbD0ibm9uZSIvPjwvc3ZnPg==",mdCalendar:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBkPSJNMTkgM2gtMVYxaC0ydjJIOFYxSDZ2Mkg1Yy0xLjExIDAtMS45OS45LTEuOTkgMkwzIDE5YzAgMS4xLjg5IDIgMiAyaDE0YzEuMSAwIDItLjkgMi0yVjVjMC0xLjEtLjktMi0yLTJ6bTAgMTZINVY4aDE0djExek03IDEwaDV2NUg3eiIvPjwvc3ZnPg=="}).provider("$mdIcon",MdIconProvider);var config={defaultViewBoxSize:24,defaultFontSet:"material-icons",fontSets:[]};MdIconProvider.prototype={icon:function(a,b,c){return-1==a.indexOf(":")&&(a="$default:"+a),config[a]=new ConfigurationItem(b,c),this},iconSet:function(a,b,c){return config[a]=new ConfigurationItem(b,c),this},defaultIconSet:function(a,b){var c="$default";return config[c]||(config[c]=new ConfigurationItem(a,b)),config[c].viewBoxSize=b||config.defaultViewBoxSize,this},defaultViewBoxSize:function(a){return config.defaultViewBoxSize=a,this},fontSet:function(a,b){return config.fontSets.push({alias:a,fontSet:b||a}),this},defaultFontSet:function(a){return config.defaultFontSet=a?a:"",this},defaultIconSize:function(a){return config.defaultIconSize=a,this},$get:["$templateRequest","$q","$log","$mdUtil","$sce",function(a,b,c,d,e){return MdIconService(config,a,b,c,d,e)}]},MdIconService.$inject=["config","$templateRequest","$q","$log","$mdUtil","$sce"],angular.module("modules.moment",["angularMoment"]),angular.module("modules.moment").run(["moment",function(a){a.locale("en",{relativeTime:{future:"in %s",past:"%s ago",s:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"}})}]),angular.module("modules.preview.cad",[]),angular.module("modules.preview.cad").directive("previewAutodesk",function(){return{restrict:"E",templateUrl:"app/modules/preview/preview-cad/tpls/autodesk-preview.html",scope:{project:"=",fileMeta:"=",previewer:"="},controller:["$element","$scope","$http","$timeout","AutoDeskService","$window","SyncService","$q","$interval",function(a,b,c,d,e,f,g,h,i){function j(){i.cancel(l)}function k(a){function c(){e.getViewStatus(b.urn64).then(function(a){b.status=a.data.status,"success"==b.status?(b.initialiseAutodesk=!0,i.cancel(l)):"failed"==b.status&&i.cancel(l)})}b.urn64=a[0].data.urn,b.token=a[2].data.token,l=i(c,700)}var l;b.previewer=b.previewer||{},b.$on("$destroy",j),b.status="pending",e.isWebGlSupported()?h.all([g.render(b.project.stub,b.fileMeta.path),e.load(),e.authenticate()]).then(k):b.status="disabled"}]}}).directive("autodeskElement",function(){return{restrict:"E",scope:{urn64:"@?",token:"@?"},controller:["$element","$scope","$timeout",function(a,b,c){function d(a,b){"urn:"===b.document.substring(0,4)&&(b.document=b.document.substring(4)),window.Autodesk.Viewing.Document.load("urn:"+b.document,e,f)}function e(a){console.log(window.Autodesk),h=a,j=window.Autodesk.Viewing.Document.getSubItemsWithProperties(a.getRootItem(),{type:"geometry",role:"3d"},!0),k=window.Autodesk.Viewing.Document.getSubItemsWithProperties(a.getRootItem(),{type:"geometry",role:"2d"},!0),j.length>0?i.load(a.getViewablePath(j[0])):k.length>0&&i.load(a.getViewablePath(k[0]))}function f(a){}var g=a[0],h=null,i=null,j=null,k=null,l={document:b.urn64,accessToken:b.token,env:"AutodeskProduction"};i=new window.Autodesk.Viewing.Private.GuiViewer3D(g,{}),window.Autodesk.Viewing.Initializer(l,function(){i.initialize(),d(i,l)})}]}}).service("autodeskInterceptor",["$q",function(a){return{request:function(a){return a}}}]).config(["$httpProvider",function(a){a.interceptors.push("autodeskInterceptor")}]).service("AutoDeskService",["$http","LazyLoadingService","autodeskInterceptor",function(a,b,c){function d(){return b.load([{global:"Autodesk",src:"https://developer.api.autodesk.com/viewingservice/v1/viewers/viewer3D.min.js"},{src:"https://developer.api.autodesk.com/viewingservice/v1/viewers/style.min.css"},{src:"https://developer.api.autodesk.com/viewingservice/v1/viewers/three.min.js"},{src:"https://developer.api.autodesk.com/viewingservice/v1/viewers/lmvworker.min.js"}]).then(function(a){return a[0]})}function e(){return a({method:"POST",url:"api/v1/auth/autodesk"}).then(function(a){return h.accessToken=a.data.token,a})}function f(b){return a({method:"GET",url:"https://developer.api.autodesk.com/viewingservice/v1/"+b+"/status"})}function g(a){if(window.WebGLRenderingContext){for(var b=document.createElement("canvas"),c=["webgl","experimental-webgl","moz-webgl","webkit-3d"],d=!1,e=0;4>e;e++)try{if(d=b.getContext(c[e]),d&&"function"==typeof d.getParameter)return a?{name:c[e],gl:d}:!0}catch(f){}return!1}return!1}var h=this;this.load=d,this.accessToken="",this.authenticate=e,this.getViewStatus=f,this.isWebGlSupported=g,e(),c.request=function(a){return-1!=a.url.indexOf("autodesk.com")&&(a.headers.Authorization="Bearer "+h.accessToken),a}}]),angular.module("modules.preview.code",[]),angular.module("modules.preview.code").directive("previewCode",["$window",function(a){return{restrict:"E",transclude:!0,scope:{project:"=",fileMeta:"=",previewer:"=?"},controller:["$scope","CodeMirrorService","LazyLoadingService","SyncService",function(a,b,c,d){function e(){a.loading=!0,d.download(a.fileMeta.downloadUrl).then(function(b){a.loading=!1,a.previewer.fileData=b.data}),a.optionsView={indentWithTabs:!0,readOnly:!0,dragDrop:!1,lineWrapping:!0,lineNumbers:!0,onLoad:function(c){a.cmEditor=c;var d=window.CodeMirror.findModeByFileName(a.fileMeta.name).mode;b.changeCodeMode(c,d)}},a.optionsEdit={indentWithTabs:!0,readOnly:!1,dragDrop:!1,lineWrapping:!0,lineNumbers:!0,onLoad:function(c){a.cmEditor=c;var d=window.CodeMirror.findModeByFileName(a.fileMeta.name).mode;b.changeCodeMode(c,d)}}}a.previewer.render=e,e()}],templateUrl:"app/modules/preview/preview-code/tpls/preview-code.html"}}]),angular.module("modules.preview.files",[]),angular.module("modules.preview.files").directive("previewFiles",["$window",function(a){return{restrict:"E",scope:{project:"=",viewerType:"=",fileMeta:"=",previewer:"=?"},controller:["$scope","SyncUtilService",function(a,b){a.previewer=a.previewer||{},a.previewer.type=b.getViewerType(a.fileMeta.fileType,a.fileMeta.provider),a.hostDomain=window.location.hostname}],templateUrl:"app/modules/preview/preview-files/tpls/preview-files.html"}}]),angular.module("modules.preview.gerber",[]),angular.module("modules.preview.gerber").directive("previewGerber",["$window",function(a){return{restrict:"E",scope:{fileMeta:"=?",previewer:"=?"},templateUrl:"app/modules/preview/preview-gerber/tpls/preview-gerber.html",controller:["$scope","WebGerberService","LazyLoadingService","$element","$http","$q","SyncService","SyncUtilService","$timeout",function(a,b,c,d,e,f,g,h,i){function j(){q(),a.loading=!0,a.fileMeta.virtualChildren?(_.forEach(a.fileMeta.virtualChildren,function(a){a.enabled=!0}),f.all([o(),m()]).then(function(a){u=a[1],l()})):f.all([o(),n(a.fileMeta.name,a.fileMeta.downloadUrl)]).then(function(a){u=[a[1]],l()})}function k(a){i(function(){_.forEach(b.activeInstances,function(b){var c=_.find(b.layers,"name",a.name);c&&(c.enabled=a.enabled,b.repaint=0)})},1)}function l(){if(t=b.register(),a.previewer.instance=t,t.callbacks={renderStart:function(){},renderComplete:function(){a.loading=!1}},a.layers=_.map(u,t.parse),_.forEachRight(a.layers,function(b,c){b.error?(p(b.error),a.layers.splice(c,1)):b.isGerber&&0===b.cmds.length&&(p("Could not parse file."),a.layers.splice(c,1))}),a.layers.length>0){if(!a.layers[0].isGerber){a.layers[0].side=2;var c=_.clone(a.layers[0],!0);c.boardFlipped=!0,c.side=1,a.layers.push(c)}t.init(a.layers,d[0].querySelector(".canvas-parent"),b.activeInstances),_.find(a.layers,"side",2)||s(!0)}else a.previewer.type="other"}function m(){return f.all(_.map(a.fileMeta.virtualChildren,function(a){return n(a.name,a.downloadUrl)}))}function n(a,b){return e({method:"GET",url:b}).then(function(b){var c={name:a,data:b.data};return c})}function o(){return c.load([{src:window.rootHostDomain+"/assets/js/gerber/js/thr51.min.js"},{src:window.rootHostDomain+"/assets/js/gerber/js/ObjectControls.js"},{src:window.rootHostDomain+"/assets/js/gerber/js/webGerber.js"},{src:window.rootHostDomain+"/assets/js/gerber/js/parse/gerber.js"},{src:window.rootHostDomain+"/assets/js/gerber/js/parse/eagle.js"},{src:window.rootHostDomain+"/assets/js/gerber/js/render/viewee-generic.js"},{src:window.rootHostDomain+"/assets/js/gerber/js/render/gerber.js"},{src:window.rootHostDomain+"/assets/js/gerber/js/render/viewee-canvas.js"},{src:window.rootHostDomain+"/assets/js/gerber/js/viewee.js"}])}function p(a){console.log(a)}function q(){b.deregister(t)}function r(){_.forEach(b.activeInstances,function(a){a.center()})}function s(c){a.flipped=c?c:!a.flipped,_.forEach(b.activeInstances,function(b){b.flip(a.flipped)})}var t,u={};a.previewer.render=j,a.previewer.center=r,j(),a.toggleLayer=k,a.flip=s,a.center=r,a.$on("$destroy",q)}]}}]).service("WebGerberService",["CoreLibrary",function(a){function b(){var b=a.getUuid(),c=window.webGerber();return c.id=b,d.activeInstances.push(c),c}function c(a){a&&(a.destroy(),d.activeInstances.splice(_.findIndex(d.activeInstances,"id",a.id),1))}var d=this;this.activeInstances=[],this.register=b,this.deregister=c}]),angular.module("modules.preview.pcb",[]),angular.module("modules.preview.pcb").directive("previewPcb",["$window",function(a){return{restrict:"E",transclude:!0,scope:{fileUrl:"@",previewer:"=?"},templateUrl:"app/modules/preview/preview-pcb/tpls/preview-pcb.html",controller:["$scope","LazyLoadingService","$element","$timeout","PanZoomService","ViewPcbService",function(a,b,c,d,e,f){function g(){console.log("INIT"),k(),a.loading=!0,i().then(h)}function h(){var b=a.fileUrl;o=c[0].querySelector(".canvas"),n=f.register(o),n.loadURL(b,function(){a.loading=!1,a.$apply()}),n.drawCallback=function(){a.loading=!1,a.$apply(),j()},a.flipBoard=l,a.reset=m}function i(){return b.load([{src:window.rootHostDomain+"/assets/js/viewee/js/utils/object-assign.js"},{src:window.rootHostDomain+"/assets/js/viewee/js/utils/minivents.js"},{src:window.rootHostDomain+"/assets/js/viewee/js/utils/htmlel.js"},{src:window.rootHostDomain+"/assets/js/viewee/js/parsers/eagle_xml_parser.js"},{src:window.rootHostDomain+"/assets/js/viewee/js/parsers/kicad_pcb_parser.js"},{src:window.rootHostDomain+"/assets/js/viewee/js/parsers/geda_parser.js"},{src:window.rootHostDomain+"/assets/js/viewee/js/renderers/renderer.js"},{src:window.rootHostDomain+"/assets/js/viewee/js/renderers/canvas_renderer.js"},{src:window.rootHostDomain+"/assets/js/viewee/js/renderers/svg_renderer.js"},{src:window.rootHostDomain+"/assets/js/viewee/js/viewee.js"},{src:window.rootHostDomain+"/assets/js/viewee/js/pan-zoom/svg-pan-zoom.js"}])}function j(){p=e.register(o,{zoomScaleSensitivity:.4,minZoom:.1,maxZoom:20,onZoom:function(a){_.forEach(e.activeInstances,function(b){b.id!=p.id&&b.zoom(a)})},onPan:function(a){_.forEach(e.activeInstances,function(b){b.id!=p.id&&b.pan(a)})}})}function k(){e.deregister(p),f.deregister(n)}function l(){a.flipped=!a.flipped,_.forEach(f.activeInstances,function(b){b.setBoardFlipped(a.flipped)})}function m(){_.forEach(e.activeInstances,function(a){a.resize(),a.fit(),a.center(),console.log(a.getSizes())})}var n,o,p;a.previewer.render=g,a.previewer.center=m,g(),a.$on("$destroy",k)}]}}]).service("ViewPcbService",["$window","CoreLibrary",function(a,b){function c(a){var c=b.getUuid(),d=new window.ViewEEPCB(a);return d.id=c,e.activeInstances.push(d),d}function d(a){a&&e.activeInstances.splice(_.findIndex(e.activeInstances,"id",a.id),1)}var e=this;this.activeInstances=[],this.register=c,this.deregister=d}]).service("PanZoomService",["$window","CoreLibrary",function(a,b){function c(a,c){var d=b.getUuid(),f=window.svgPanZoom(a,c);return f.id=d,e.activeInstances.push(f),f}function d(a){a&&(e.activeInstances.splice(_.findIndex(e.activeInstances,"id",a.id),1),a.destroy())}var e=this;this.activeInstances=[],this.register=c,this.deregister=d}]),angular.module("modules.preview.pdf",[]),angular.module("modules.preview.pdf").directive("previewPdf",["$window",function(a){return{restrict:"E",transclude:!0,scope:{fileUrl:"@"},templateUrl:"app/modules/preview/preview-pdf/tpls/preview-pdf.html",controller:["$scope",function(a){a.loading=!0,window.pdfLoadCompleteCallback=function(){a.loading=!1,a.$apply()}}]}}]),angular.module("modules.sync.file-select",[]),angular.module("modules.sync.file-select").directive("syncFileSelect",["RecursionHelper",function(a){return{restrict:"E",scope:{path:"=",project:"=",provider:"=",selected:"="},templateUrl:"app/modules/sync/sync-file-select/tpls/sync-file-select.html",controller:["$scope","SyncUtilService","SyncService","$stateParams",function(a,b,c,d){function e(){"drive"==a.provider?c.getPath(a.path,a.project.stub).then(function(b){a.breadCrumbs=b}):a.breadCrumbs=b.getCrumbs(a.path)}function f(b){a.path=b||"",a.selected={},e(),a.loading=!0,c.list(a.project.stub,a.path).then(function(b){a.files=b.data.entries,a.loading=!1})}function g(b){"folder"==b[".tag"]?f(b.path):a.selected=b}a.select=g,a.selected=a.selected||{},f(a.path)}]}}]).service("SyncFileSelectService",["$mdDialog",function(a){function b(b,c){return a.show({templateUrl:"app/modules/sync/sync-file-select/tpls/sync-file-select-modal.html",controller:["$scope","$mdDialog","CoreLibrary",function(a,b,d){a.project=c.project,a.provider=c.provider,a.path=c.path,a.selected={},a.cancel=b.cancel,a.save=function(){b.hide(a.selected)}}],targetEvent:b})}this.select=b}]),angular.module("modules.sync.folder-select",[]),angular.module("modules.sync.folder-select").directive("syncFolderSelect",["RecursionHelper",function(a){return{restrict:"E",scope:{provider:"@",item:"=",open:"=?",selected:"=",loading:"=?"},templateUrl:"app/modules/sync/sync-folder-select/tpls/sync-folder-select.html",compile:function(b){return a.compile(b)},controller:["$scope","SyncUtilService","SyncService","$stateParams",function(a,b,c,d){function e(a,b){b+=1,a&&a.children&&_.forEach(a.children,function(a){a.level=b-1,e(a,b)})}function f(b){a.item.children?a.item.showChildren=!a.item.showChildren:(a.loading.status=!0,c.explorePrivate(a.provider,b).then(function(b){a.loading.status=!1,a.item.children=b.data.entries,a.item.showChildren=!0}))}function g(b){a.selected.id=b.id,a.selected.path=b.path,a.selected.name=b.name}a.selected=a.selected||{},a.item=a.item||{},a.item.path=a.item.path||"",a.toggle=f,a.select=g,a.open&&(f(a.item.path),a.$watch("item",function(){e(a.item,0)},!0))}]}}]).service("SyncFolderSelectService",["$mdDialog",function(a){function b(b,c){return a.show({templateUrl:"app/modules/sync/sync-folder-select/tpls/sync-folder-select-modal.html",controller:["$scope","$mdDialog","CoreLibrary",function(a,b,d){a.selected={},a.loading={},a.provider=c.provider,a.projectName=d.stubify(c.projectName),a.folder={type:"new"},a.cancel=b.cancel,a.save=function(){"new"==a.folder&&(a.selected={}),b.hide(a.selected)}}],targetEvent:b})}this.select=b}]).factory("RecursionHelper",["$compile",function(a){return{compile:function(b,c){angular.isFunction(c)&&(c={post:c});var d,e=b.contents().remove();return{pre:c&&c.pre?c.pre:null,post:function(b,f){d||(d=a(e)),d(b,function(a){f.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]),angular.module("modules.sync.list-widget",[]),angular.module("modules.sync.list-widget").directive("syncListWidget",function(){return{restrict:"E",
scope:{project:"=",path:"@"},templateUrl:"app/modules/sync/sync-list-widget/tpls/sync-list-widget.html",controller:["$scope","SyncService","SyncUtilService",function(a,b,c){a.loading=!0,a.openFileFolder=c.openFileFolder,b.list(a.project.stub,a.path||"").then(function(b){a.loading=!1,a.items=b.data.entries})}]}}),angular.module("modules.sync.service",[]),angular.module("modules.sync.service").service("SyncService",["$http","SyncUtilService","$q",function(a,b,c){function d(c,d){return a({method:"GET",url:"/api/v1/sync/listFolder/"+c+"/"+d}).then(function(a){a.data.files?a.data.entries=_.map(a.data.files,function(a){return v(a,c)}):a.data.entries=_.map(a.data.entries,function(a){return u(a,c)});var e=b.processVirtualFiles(a.data.entries,c,d);return a.data.entries=a.data.entries.concat(e),a.data.entries=_.sortByOrder(a.data.entries,[".tag","client_modified"],["desc","desc"]),a})}function e(b,d,e,g){function h(a,b){b=b||[],x[m]=x[m]||{};var c=x[m][a];return console.log(c),c?c.parent&&c.path&&c.id!=e?(b.push(c),h(c.parent,b)):(b.push(c),b):(x[m][a]=l(a).then(function(a){return _.forEach(a.data[0],function(a){f(m,a)}),a.data[0]}),b.concat(x[m][a]))}function i(b){return a({url:"/api/v1/sync/path/"+d+"/",method:"GET",params:{"folderId[]":b}})}function j(b){return a({url:"/api/v1/sync/path/"+d+"/",method:"GET",params:{"folderId[]":b,absolute:!0}})}var k=c.defer(),l=d&&!g?i:j,m=d&&!g?"sync-path-"+d:"sync-path-"+d+"abs";return console.log(b),c.all(h(b)).then(function(a){var b=[];_.forEachRight(a,function(a){a.constructor===Array?_.forEach(a,function(a){a.path=a.id,b.push(a)}):(a.path=a.id,b.push(a))}),k.resolve(b)}),k.promise}function f(a,b){x[a]=x[a]||{},x[a][b.id]=b}function g(b){var c=b.split("@");return a({method:"GET",url:c[0],params:{revision:c[1]}})}function h(b,c,d){return a({method:"GET",url:"/api/v1/sync/metadata/"+b+"/"+c,params:d}).then(function(a){return a.data.mimeType?a.data=v(a.data,b):a.data=u(a.data,b),a})}function i(a,d,e){if(e){var f=[w.metadata(a,d.path).then(function(a){return a.data})];return f=f.concat(_.map(e,function(b){return w.metadata(a,b.path,{revision:b.rev}).then(function(a){return a.data})})),c.all(f).then(function(c){var e=c[0];return c.shift(),b.processVirtualFiles(c,a,d.path,e)[0]})}return w.metadata(a,d.path,{revision:d.rev}).then(function(a){return a.data})}function j(b,c,d){return a({method:"GET",url:"/api/v1/sync/render/"+b+"/"+c,params:d})}function k(c,d){return a({method:"GET",url:"/api/v1/sync/revisions/"+c+"/"+d}).then(function(a){var e;return"drive#revisionList"==a.data.kind?e=_.map(a.data.revisions,function(a,e){return{revDecimal:e+1,client_modified:a.modifiedTime,rev:a.id,endingUrl:b.getEndingUrl(c,d,a.id)}}):(e=_.forEach(a.data.entries,function(b,d){return u(b,c),b.revDecimal=a.data.entries.length-d,b}),e.reverse()),e})}function l(a){if(a.virtualChildren){var b=_.map(a.virtualChildren,function(b){return w.revisions(a.parentProject,b.path).then(function(a){return b.revisions=a,b})});return c.all(b).then(function(b){a.virtualChildren=b;var c=[];_.forEach(a.virtualChildren,function(a){_.forEach(a.revisions,function(a){var b=new Date(a.client_modified).getTime();-1==c.indexOf(b)&&c.push(b)})}),c=c.sort();var d=[];_.forEach(c,function(b,c){d[c]||(d[c]={name:a.name,path:a.path,client_modified:moment(b).format(),revDecimal:c+1,virtualChildren:[],virtualChildrenRevs:[],rev:c+1}),_.forEach(a.virtualChildren,function(a){var e=_.findLast(a.revisions,function(a){var c=new Date(a.client_modified).getTime();return b>=c});d[c].virtualChildren.push(e),d[c].virtualChildrenRevs.push(e.rev)})}),a.revisions=d;var e=_.map(a.virtualChildren,"rev"),f=_.find(a.revisions,function(a){return 0===_.difference(a.virtualChildrenRevs,e).length});return f&&(a.revDecimal=f.revDecimal,a.rev=f.rev),a})}return w.revisions(a.parentProject,a.path).then(function(b){a.revisions=b;var c=_.find(a.revisions,"rev",a.rev);return c&&(a.revDecimal=c.revDecimal),a})}function m(b,c){return a({method:"DELETE",url:"/api/v1/sync/delete/"+b+"/"+c})}function n(b,c){return a({method:"POST",url:"/api/v1/sync/createFolder/"+b+"/"+c})}function o(b,c,d,e){return a({method:"POST",url:"/api/v1/sync/upload/"+b+"/"+c,params:{revision:d.revision},headers:{"Content-Type":"application/octet-stream"},data:e})}function p(b,c,d){return a({method:"GET",url:"/api/v1/sync/search/"+b+"/"+c,params:d}).then(function(a){return a.data.files?a.data.matches=_.map(a.data.files,function(a){return console.log(a),v(a,b)}):a.data.matches=_.map(a.data.matches,function(a){return u(a.metadata,b)}),a})}function q(b,c){return a({method:"GET",url:"/api/v1/sync/folderMembers/"+b+"/"+c})}function r(b,c){return a({method:"GET",url:"/api/v1/sync/ownerInfo/"+b+"/"+c}).then(function(a){var b={};return a.data.name.display_name?(b.email=a.data.email,b.name=a.data.name.display_name,b.given_name=a.data.name.given_name,b.family_name=a.data.name.surname):(b.email=a.data.email,b.name=a.data.name,b.given_name=a.data.given_name,b.family_name=a.data.family_name),b})}function s(b,c){return a({method:"GET",url:"/api/v1/sync/explore/"+b+"/"+c}).then(function(a){return a.data.files?a.data.entries=_.map(a.data.files,function(a){return v(a)}):a.data.entries=_.map(a.data.entries,function(a){return u(a)}),a.data.entries=_.filter(a.data.entries,function(a){return"folder"==a[".tag"]}),a})}function t(b,c){return a({method:"GET",url:"/api/v1/sync/fileStats/"+b+"/"+c}).then(function(a){var b={numFiles:0};return _.forEach(a.data,function(a,c){b.numFiles=b.numFiles+parseInt(a)}),b})}function u(a,c){return a.path_display="/"==a.path_display[0]?a.path_display.substring(1):a.path_display,c&&(a.endingUrl=b.getEndingUrl(c,a.path_display,a.rev),a.downloadUrl="api/v1/sync/download/"+a.endingUrl),a.name=b.getFileName(a.path_display),a.nameRaw=a.name.split(".")[0],a.path=a.path_display,a.pathStub=a.path_display,a.provider="dropbox",a.parentFolder=a.path_display.substr(0,a.path_display.lastIndexOf("/")),a.parentProject=c,"file"==a[".tag"]&&(a.fileType=b.getFileType(a.path_display)),a}function v(a,c){var d;return-1!=a.mimeType.indexOf("apps.document")&&(d="gdoc"),-1!=a.mimeType.indexOf("apps.spreadsheet")&&(d="gsheet"),-1!=a.mimeType.indexOf("apps.presentation")&&(d="gslides"),"application/vnd.google-apps.folder"==a.mimeType&&(d="folder",f("sync-path-"+c||"absolute",{id:a.id,name:a.name,path:a.name,parent:a.parents[0]})),{".tag":"application/vnd.google-apps.folder"==a.mimeType?"folder":"file",nameRaw:a.name.split(".")[0],name:a.name.split(".").length>1||"folder"==d||!d?a.name:a.name+"."+d,path:a.id,id:a.id,pathStub:a.id,parentFolder:a.parents[0],parentProject:c,path_display:a.id,client_modified:a.modifiedTime,rev:a.revisionId||a.headRevisionId,size:a.size,fileType:a.fileExtension||d,webViewLink:a.webViewLink,thumbLink:a.thumbnailLink?a.thumbnailLink.replace("=s220","=s60"):"",provider:"drive",endingUrl:b.getEndingUrl(c,a.id,a.revisionId||a.headRevisionId),downloadUrl:"api/v1/sync/download/"+b.getEndingUrl(c,a.id,a.revisionId||a.headRevisionId)}}var w=this;this.list=d,this.getPath=e,this.download=g,this.render=j,this.metadata=h,this.metadataVirtual=i,this.search=p,this.revisions=k,this.revisionsDeep=l,this.remove=m,this.createFolder=n,this.upload=o,this.folderMembers=q,this.ownerInfo=r,this.fileStats=t,this.explorePrivate=s;var x={}}]),angular.module("modules.sync.timeline",[]),angular.module("modules.sync.timeline").directive("syncTimeline",function(){return{restrict:"E",scope:{timeline:"="},templateUrl:"app/modules/sync/sync-timeline/tpls/timeline.html",controller:["$scope",function(a){a.iconMap={update:"editor:mode_edit",create:"content:add"}}]}}),angular.module("modules.sync",["modules.sync.timeline","modules.sync.list-widget","modules.sync.folder-select","modules.sync.file-select","modules.sync.service"]),angular.module("modules.sync").service("SyncUtilService",["$state","SyncUrlService",function(a,b){function c(a,b){var c=p[a],d=p[b],e=d?_.intersection(c,d):c;return _.map(e,function(a){return o[a]})}function d(){var a=[];return _.forEach(window.CodeMirror.modeInfo,function(b){b.ext&&(a=a.concat(b.ext))}),a}function e(a){if(a){var b=a.split("/");""===b[0]&&b.shift();var c="";return _.map(b,function(a,b){return c=c?c+"/"+a:a,{name:a,path:c}})}}function f(a){var b=a.split(".");return b[b.length-1]}function g(a){var b=a.split("/");return b[b.length-1]}function h(a,b,c){var d=a+"/"+b;return c&&(d=d+"?revision="+c),d}function i(a,b){var c,d=a?a.toLowerCase():"";b="drive"==b?"drive":"dropbox";var e=_.clone(n.general);return _.forEach(n[b],function(a,b){e[b]=e[b]||[],e[b]=e[b].concat(a)}),_.forEach(e,function(a,b){-1!=a.indexOf(d)&&(c=b)}),c||"other"}function j(a){var b=a?a.toLowerCase():"";return-1!=n.general.gerber.indexOf(b)}function k(c){"folder"==c[".tag"]?a.go("app.project.files",{path:c.path,stub:c.parentProject}):a.go("app.preview",{path:b.getPath(c),projectStub:c.parentProject,children:c.virtualChildrenMap?_.map(c.virtualChildren,b.getPath).join(","):""})}function l(a,b,c,d){d=d||{};var e=[],f={},g={};return _.forEach(a,function(a){m.isGerber(a.fileType)&&(g[a.nameRaw]=g[a.nameRaw]||[],f[a.nameRaw]=f[a.nameRaw]||[],-1==f[a.nameRaw].indexOf(a.fileType)&&(f[a.nameRaw].push(a.fileType),g[a.nameRaw].push(a)))}),_.forEach(g,function(a,f){if(a.length>3){var g=_.extend({},d,{".tag":"virtual",name:f+".gerber",size:_.sum(a,"size"),fileType:"gerber",client_modified:_.reduce(a,function(a,b){var c=new Date(b.client_modified).getTime();return c>a?c:a},0),path:c,virtualChildren:a,virtualChildrenMap:_.map(a,"path"),parentProject:b,endingUrl:m.getEndingUrl(b,c),provider:a[0].provider});e.push(g)}}),e}var m=this,n={general:{gerber:["gerber","drl","drd","txt","out","outline","gbl","sol","gbs","sts","gbp","crs","gbo","pls","gtl","cmp","gts","stc","gtp","crc","gto","plc"],code:d(),autodesk:["3dm","3ds","asm","cam360","catpart","catproduct","cgr","collaboration","dae","dgn","dlv3","dwf","dwfx","dwg","dwt","dxf","exp","f3d","fbx","g","gbxml","iam","idw","ifc","ige","iges","igs","ipt","jt","model","neu","nwc","nwd","obj","pdf","prt","rcp","rvt","sab","sat","session","skp","sldasm","sldprt","smb","smt","ste","step","stl","stla","stlb","stp","wire","x_b","x_t","xas","xpr"],google:["webm","mpeg4","3gpp","mov","avi","mpegps","wmv","flv","xls","xlsx","pages","psd","tiff","eps","ps","ai","ttf","xps"],image:["png","jpg","jpeg","gif","svg","bmp","ico"],pdf:["pdf"],pcb:["brd","pcb","kicad_pcb"]},dropbox:{pdf:["docx","doc","docm","ppt","pps","ppsx","ppsm","pptx","pptm","rtf"]},drive:{google:["docx","doc","docm","ppt","pps","ppsx","ppsm","pptx","pptm","rtf"],gdoc:["gdoc","gsheet","gslides"]}},o=["sideBySide","aboveAndBelow","onion","slider"],p={gerber:[0,1,2,3],code:[0,1],autodesk:[0,1,2,3],google:[0,1],image:[0,1,2,3],pdf:[0,1],pcb:[0,1,2,3],gdoc:[0,1],other:[0,1]};this.getCrumbs=e,this.getFileName=g,this.getFileType=f,this.getViewerType=i,this.getEndingUrl=h,this.openFileFolder=k,this.isGerber=j,this.processVirtualFiles=l,this.getCompareModes=c}]).service("SyncUrlService",["$state",function(a){function b(a){return a.rev?a.path+"@"+a.rev:a.path}function c(a){return a?_.map(a,f.getPath).join(","):void 0}function d(a){if(a){var b=a.split(",");return _.map(b,function(a){var b=a.split("@");return{path:b[0],rev:b[1]}})}}function e(a){var b=a.split("@");return{path:b[0],rev:b[1]}}var f=this;this.getPath=b,this.getChildPath=c,this.parseChildren=d,this.parsePath=e}]).directive("fileThumbnail",function(){return{restrict:"E",scope:{endingUrl:"=?",fileType:"=",thumbLink:"=?"},templateUrl:"app/modules/sync/tpls/file-thumbnail.html",controller:["$scope",function(a){var b=["jpeg","png","jpg"];-1!=b.indexOf(a.fileType)?(a.isImage=!0,a.thumnailPath=a.thumbLink||"api/v1/sync/thumbnail/"+a.endingUrl):a.thumnailPath="/assets/images/vectors/filetype/"+(a.fileType||"folder")+".svg"}]}}).directive("fileBreadCrumbs",function(){return{restrict:"E",scope:{breadCrumbs:"=",project:"=",showProjectName:"=",selectFn:"=?"},templateUrl:"app/modules/sync/tpls/file-bread-crumbs.html",controller:["$scope","SyncUtilService",function(a,b){a.select=function(c){a.selectFn?a.selectFn(c):b.openFileFolder(c)}}]}}).directive("fileReadme",function(){return{restrict:"E",scope:{project:"=",files:"=?",path:"@?",readme:"="},templateUrl:"app/modules/sync/tpls/file-readme.html",controller:["$scope","SyncService",function(a,b){a.readme=a.readme||{},a.files&&_.forEach(a.files,function(c){"readme.md"==c.name.toLowerCase()&&(a.readme.body=" ",a.readme.loading=!0,b.download(c.downloadUrl).then(function(b){a.readme.path=c.path,a.readme.loading=!1,a.readme.body=b.data}))})}]}}).directive("fileList",function(){return{restrict:"E",scope:{project:"=",path:"=",selectFn:"=?"},templateUrl:"app/modules/sync/tpls/file-list.html",controller:["$scope","SyncUtilService","SyncService","$stateParams",function(a,b,c,d){a.loading=!0,c.list(a.project.stub,a.path||"").then(function(b){a.files=b.data.entries,a.loading=!1;var c;_.forEach(a.files,function(b,e){d.path&&d.path.substring(0,b.path.length)==b.path&&(b.isCurrent=!0),c=c||b[".tag"],b[".tag"]!=c&&a.files[e-1]&&(a.files[e-1].isDivider=!0),c=b[".tag"]})}),a.select=function(c){a.selectFn?a.selectFn(c):b.openFileFolder(c)}}]}}),angular.module("views.app").controller("AppViewCtrl",["$scope",function(a){}]),angular.module("views.error").controller("ErrorViewCtrl",["$scope",function(a){}]),angular.module("views.error").controller("HomeViewCtrl",["$scope","$http",function(a,b){}]),angular.module("views.preview-github").controller("PreviewGithubViewCtrl",["$scope","$stateParams",function(a,b){console.log(b.path),a.fileMeta={};var c=b.path.split("/"),d=b.path.split(".");a.fileMeta.fileType=d[d.length-1],a.fileMeta.name=c[c.length-1],a.fileMeta.downloadUrl=b.path,a.previewer={enabled:!0}}]),angular.module("views.preview").controller("PreviewViewCtrl",["project","fileMeta","$scope",function(a,b,c){c.project=a,c.fileMeta=b,c.previewer={enabled:!0}}]);