"use strict";!function(){function a(a,b,c){c.html5Mode(!0),a.otherwise("/")}function b(a,b,c){a.$state=b,a.$stateParams=c}var c=["ngAnimate","ngMessages","ngSanitize","ngMaterial","templates","ui.router","angular-loading-bar","ngMdIcons","ngTable","infinite-scroll","nvd3","views.app","views.campaigns","views.error","views.home","views.marketing","views.live","views.login","views.users","views.states","views.state","views.user","views.usage","views.popular","views.emails","views.fields","views.jobs","views.job-applications","views.organisations","views.organisation","views.projects","views.threads","views.crm","views.growth-accounting","views.reminders","views.referrals","views.github","modules.authentication","modules.d3","modules.error-handling","modules.core","modules.restangular","modules.filters","modules.material","modules.projects","modules.transition-overlay","modules.threads","modules.page-loading-overlay","modules.queryUsers","modules.users","modules.organisation","modules.field","modules.logs","modules.local-cache","modules.loading","modules.posts","modules.http","modules.tables","modules.moment","modules.analytics","modules.timeline","modules.confirm-click","modules.keyboard-navigation","modules.tabs"];angular.module("app",c),angular.module("app").config(a).run(b),angular.module("infinite-scroll").value("THROTTLE_MILLISECONDS",500),a.$inject=["$urlRouterProvider","$mdThemingProvider","$locationProvider"],b.$inject=["$rootScope","$state","$stateParams"]}(),angular.module("views.app",["ui.router","modules.toggle-menu"]),angular.module("views.app").config(["$stateProvider",function(a){a.state("app",{"abstract":!0,resolve:{userdata:["Authentication",function(a){return a.loadUserData()}]},templateUrl:"app/views/app/app.tpl.html",controller:"AppViewCtrl",data:{pageTitle:"Home",viewClass:"home"}})}]),angular.module("modules.queryUsers",[]),angular.module("modules.queryUsers").service("queryUsers",["$http",function(a){this.onlineUsers=function(){return a.get("/api/v1/admin/users/onlineUsers").then(function(a){return a.data})}}]),angular.module("modules.analytics",[]),angular.module("modules.analytics").directive("analyticsCount",["$http","$auth","Authentication",function(a,b,c){return{restrict:"E",scope:{type:"@?",criteria:"=?",parentType:"@?",parentId:"@?"},template:'<a ng-click="getCount()">{{count}}</a>',link:function(b,c,d){function e(){b.count="...",a({method:"GET",url:"/api/v1/search/",params:{type:b.type,count:!0,"select[]":["_id"],criteria:b.criteria,parentType:b.parentType,parentId:b.parentId}}).then(function(a){b.count=a.data[0]})}b.getCount=e,e()}}}]),angular.module("modules.authentication",["satellizer"]),angular.module("modules.authentication").run(["$rootScope","Authentication","$state","$q","CoreLibrary",function(a,b,c,d,e){a.$on("$stateChangeStart",function(a,d,e,f,g){b.loadUserData().then(function(e){b.userData.isContractor&&"app.campaigns"!=d.name&&"error"!=d.name&&"login"!=d.name&&(a.preventDefault(),c.go("app.campaigns",{},{reload:!0}))})})}]).config(["$authProvider",function(a){a.facebook({url:"/api/v1/auth/facebook",clientId:"710281375734499"})}]).service("Authentication",["$http","$state","$mdToast","$q",function(a,b,c,d){function e(c){if(c&&(g.loadUserDataPromise=""),!g.loadUserDataPromise){var e=d.defer();g.loadUserDataPromise=e.promise,a.get("/api/v1/me").then(function(a){a.data.isAdmin?(g.userData=a.data,g.isLoggedIn=!0,e.resolve(g.userData)):a.data.isContractor?(g.userData=a.data,g.isLoggedIn=!0,e.resolve(g.userData)):(g.isLoggedIn=!1,f(),"login"!=b.current.name&&b.go("error",null,{location:!1}),e.reject(a))})["catch"](function(a){f(),"login"!=b.current.name&&b.go("error",null,{location:!1}),e.reject(a)})}return g.loadUserDataPromise}function f(){c.show(c.simple().content("Authorisation Failed").theme("warn"))}var g={isLoggedIn:!1,userData:{},loadUserData:e,loadUserDataPromise:""};return g}]).directive("authenticationLogin",["$http","$auth","Authentication",function(a,b,c){return{restrict:"A",link:function(a,d,e){d.bind("click",function(a){b.authenticate("facebook").then(function(a){c.loadUserData(!0)})})}}}]).directive("authenticationLocal",["$mdDialog",function(a){return{restrict:"A",link:function(b,c,d){c.bind("click",function(b){a.show({templateUrl:"app/modules/authentication/tpls/local-login-modal.html",controller:["$scope","$auth","Authentication","$mdDialog",function(a,b,c,d){a.login=function(a){a&&(b.setToken(a),c.loadUserData(!0).then(function(){d.cancel()}))}}],targetEvent:b,clickOutsideToClose:!0})})}}}]).directive("authenticationLogout",["$auth","Authentication","$state",function(a,b,c){return{restrict:"A",link:function(d,e,f){e.bind("click",function(d){b.isLoggedIn=!1,b.userData={},b.loadUserDataPromise="",a.removeToken(),c.go("login")})}}}]),angular.module("modules.charts.charts-growth",[]),angular.module("modules.charts.charts-growth").directive("chartsUserGrowth",["$http",function(a){return{restrict:"E",templateUrl:"app/modules/charts/tpls/charts-user-growth.html",scope:{type:"@",title:"@",yAxis:"@",divisor:"@"},controller:["$scope","CoreLibrary","CoreModalService","GrowthChartService","$mdDialog","HttpService",function(b,c,d,e,f,g){function h(a){e.selectModal(a,b.query.params).then(function(a){console.log(a.from),b.query.params=_.extend(b.query.params,a),console.log(b.query.params.from)})}function i(a){g({method:"GET",url:"api/v1/analytics/growth",params:{from:a.data.x,to:a.data.x+b.query.params.timeResolution,type:a.data.key,format:"events"}}).then(function(a){a=c.keyedArrayToObject(a.values,a.key),d.showEntity(null,a)})}function j(){b.refreshData=k,b.loading=!0,b.options=e.getChartOptions(i,null,null),b.yAxis&&(b.options.chart.yAxis.axisLabel=b.yAxis),b.query={method:"GET",url:"api/v1/analytics/growth",params:{from:m-12*c.resolutionToMs("week"),to:m,timeResolution:c.resolutionToMs("week")}},b.$watch("query",k,!0)}function k(){b.loading=!0,a({url:b.query.url,method:"GET",params:b.query.params}).then(l)}function l(a){function c(a){return _.map(a,function(a){return{x:a[0],y:a[1]}})}function d(a){var b=-(1/0);return _.map(a,function(a){a[1]>b&&(b=a[1])}),b}function f(a){var b=1/0;return _.map(a,function(a){a[1]<b&&(b=a[1])}),b}if(b.loading=!1,"bar"===b.type){b.data=[{key:"New",type:"bar",yAxis:1,values:c(a.data.signups)},{key:"Churned",type:"bar",yAxis:1,values:c(a.data.churned)},{key:"Resurrected",type:"bar",yAxis:1,values:c(a.data.resurrected)}];var g=d(a.data.signups)+d(a.data.resurrected),h=f(a.data.churned);b.options=e.getChartOptions(null,h,g)}else"line"===b.type&&(b.data=[{key:"Quick Ratio",type:"line",yAxis:1,values:c(a.data.quickratio)},{key:"Retention Rate",type:"line",yAxis:1,values:c(a.data.retained)}],b.maxValue=d(a.data.quickratio),b.minValue=0,b.options=e.getChartOptions(null,b.minValue,b.maxValue))}var m=(new Date).getTime();b.resolutionObject=c.getResolutionObject(),b.showChartsSelectModal=h,j()}]}}]).service("GrowthChartService",["$mdDialog","CoreLibrary",function(a,b){function c(b,c){return a.show({templateUrl:"app/modules/charts/tpls/charts-select-modal-growth.html",controller:["$scope","$mdDialog","CoreLibrary",function(a,b,d){a.resolutionObject=d.getResolutionObject(),a.selectedChartTime=angular.copy(c)||{},a.selectedChartOptions=angular.copy(c)||{},a.selectedChartTime.to=new Date(a.selectedChartTime.to),a.selectedChartTime.from=new Date(a.selectedChartTime.from),a.cancel=function(){b.cancel()},a.save=function(){a.selectedChartOptions.from=a.selectedChartTime.from.getTime(),a.selectedChartOptions.to=a.selectedChartTime.to.getTime(),b.hide(a.selectedChartOptions)}}],targetEvent:b,clickOutsideToClose:!0})}function d(a,b,c){return{chart:{type:"multiChart",height:425,margin:{top:30,right:60,bottom:50,left:70},bars1:{stacked:!0,dispatch:{elementClick:a}},yDomain1:[b,c],color:d3.scale.category10().range(),useInteractiveGuideline:!0,duration:500,xAxis:{showMaxMin:!1,tickFormat:function(a){return d3.time.format("%x")(new Date(a))}},yAxis1:{tickFormat:function(a){return d3.format(",.2f")(a)}},yAxis2:{tickFormat:function(a){return d3.format(",.2f")(a)}},tooltip:{headerFormatter:function(a){return d3.time.format("%x")(new Date(a))}},interpolate:"linear"}}}this.selectModal=c,this.getChartOptions=d}]),angular.module("modules.charts.charts-retention",[]),angular.module("modules.charts.charts-retention").directive("chartsUserRetention",["$http",function(a){return{restrict:"E",templateUrl:"app/modules/charts/tpls/charts-user-retention.html",scope:{type:"@",title:"@",yAxis:"@",divisor:"@"},controller:["$scope","CoreLibrary","CoreModalService","RetentionChartService","$mdDialog",function(b,c,d,e,f){function g(a){e.selectModal(a,b.query.params).then(function(a){b.query.params=_.extend(b.query.params,a)})}function h(a){return l.filter(function(b){return b.value==a})[0].name}function i(){a(b.query).then(function(a){b.data=a.data})}var j=(new Date).getTime(),k=c.resolutionToMs("week"),l=c.getResolutionObject();b.query={method:"GET",url:"api/v1/analytics/retention",params:{signupFrom:j-8*c.resolutionToMs("week"),signupTo:j,duration:k,repeat:8,segregate:[{numProjects:1},{numThreads:1}]}},b.options=e.getChartOptions(),b.options.chart.xAxis.axisLabel=h(b.query.params.duration),b.$watch("query",i,!0),b.showChartsSelectModal=g}]}}]).service("RetentionChartService",["$mdDialog","CoreLibrary",function(a,b){function c(){return{current:"",options:[{model:"numProjects",title:"Projects"},{model:"numThreads",title:"Threads"}]}}function d(b,c){return a.show({templateUrl:"app/modules/charts/tpls/charts-select-modal-retention.html",controller:["$scope","$mdDialog","RetentionChartService","CoreLibrary",function(a,b,d,e){a.resolutionObject=e.getResolutionObject(),a.selectedChartTime=angular.copy(c)||{},a.selectedChartOptions=angular.copy(c)||{},a.selectedChartTime.signupTo=new Date(a.selectedChartTime.signupTo),a.selectedChartTime.signupFrom=new Date(a.selectedChartTime.signupFrom),a.segregateOptions=d.getSegregateOptions(),a.addItemType=a.segregateOptions.options[0].model,a.cancel=function(){b.cancel()},a.save=function(){a.selectedChartOptions.signupFrom=a.selectedChartTime.signupFrom.getTime(),a.selectedChartOptions.signupTo=a.selectedChartTime.signupTo.getTime(),b.hide(a.selectedChartOptions)},a.addItem=function(){var b={};b[a.addItemType]={$eq:1},a.selectedChartOptions.segregate.push(b)},a.removeItem=function(b){a.selectedChartOptions.segregate.splice(b,1)},a.getTitleFromModel=function(b){return a.segregateOptions.options.filter(function(a){return a.model===b})[0].title},a.getKey=function(a){return Object.keys(a)[0]}}],targetEvent:b,clickOutsideToClose:!0})}function e(){return{chart:{type:"stackedAreaChart",margin:{top:20,right:20,bottom:40,left:40},x:function(a){return a[0]},y:function(a){return a[1]},useVoronoi:!1,clipEdge:!0,duration:100,useInteractiveGuideline:!0,xAxis:{showMaxMin:!1,tickFormat:function(a){return d3.format(",d")(a)}},yAxis:{tickFormat:function(a){return d3.format(",.2f")(a)}}}}}this.getSegregateOptions=c,this.selectModal=d,this.getChartOptions=e}]),angular.module("modules.charts.charts-time-bar",[]),angular.module("modules.charts.charts-time-bar").directive("chartsTimeBar",["HttpService",function(a){return{restrict:"E",templateUrl:"app/modules/charts/tpls/charts-time-bar.html",scope:{chartType:"@",userId:"@",state:"@",stateParams:"@",chartStyle:"@",type:"@",title:"@",yAxis:"@",divisor:"@",percent:"=?"},controller:["$scope","CoreLibrary","CoreModalService","ChartService","$mdDialog",function(b,c,d,e,f){function g(){b.loading=!0,b.options=e.getChartOptions(b.chartStyle,k),b.yAxis&&(b.options.chart.yAxis.axisLabel=b.yAxis),b.query={url:"api/v1/analytics/historical",params:{to:o,user:b.userId,state:b.state,timeResolution:c.resolutionToMs("day"),stateParams:b.stateParams,format:"aggregate",query:{}}},b.divisor&&"true"!==b.divisor&&(b.divisorOptions.current=b.divisor,b.query.params.query.divisor=b.divisor),b.chartType?(b.typeInfo=j(b.chartType),b.typeInfo.setOptions()):b.query.params.query.type=b.type,m(),l()}function h(a){e.selectModal(a,b.query.params).then(function(a){b.query.params=_.extend(b.query.params,a),b.getData()})}function i(){b.divisorOptions.current&&(b.query.params.query.divisor=b.divisorOptions.current,l())}function j(a){var c={timeOnSite:{title:"Time On Site",query:{type:"timeOnSite"},setOptions:function(){b.options.chart.yAxis.axisLabel="Seconds"}},timeOnState:{title:"Time On State",query:{type:"timeOnState"},setOptions:function(){b.options.chart.yAxis.axisLabel="Seconds"}},activeUsers:{title:"Active Users",query:{type:"activeUsers"},setOptions:function(){b.options.chart.yAxis.axisLabel="Users"}},statesVisted:{title:"States Visted",query:{type:"statesVisited"},setOptions:function(){b.options.chart.yAxis.axisLabel="States"}},newSignups:{title:"New Signups",query:{type:"users"},setOptions:function(){b.options.chart.yAxis.axisLabel="Signups"}},contentCreation:{title:"Content Creation",query:{type:"content"},setOptions:function(){b.options.chart.yAxis.axisLabel="Number"}},visitors:{title:"Visitors",query:{type:"uniqueSiteVisits"},setOptions:function(){b.options.chart.yAxis.axisLabel="Visitors"}},landingPageConversions:{title:"Landing Page Conversions",query:{type:"landingPageConversions"},setOptions:function(){b.options.chart.yAxis.axisLabel="%"}},projectCreation:{title:"Project Creation",query:{type:"projects"},setOptions:function(){b.options.chart.yAxis.axisLabel="Projects"}},threadCreation:{title:"Thread Creation",query:{type:"threads"},setOptions:function(){b.options.chart.yAxis.axisLabel="Threads"}},postCreation:{title:"Post Creation",query:{type:"posts"},setOptions:function(){b.options.chart.yAxis.axisLabel="Posts"}},organisationCreation:{title:"Organisation Creation",query:{type:"organisations"},setOptions:function(){b.options.chart.yAxis.axisLabel="Organisations"}},creations:{title:"Creations",query:[{type:"organisations"},{type:"comments"},{type:"posts"},{type:"projects"},{type:"threads"},{type:"applications"}],setOptions:function(){b.options.chart.yAxis.axisLabel="Creations"}},projects:{title:"Projects",query:{type:"projects"},setOptions:function(){b.options.chart.yAxis.axisLabel="Projects"}},users:{title:"Users",query:{type:"users"},setOptions:function(){b.options.chart.yAxis.axisLabel="Users"}},threads:{title:"Threads",query:{type:"threads"},setOptions:function(){b.options.chart.yAxis.axisLabel="Threads"}},cumulativeThreads:{title:"Cumulative Threads",query:{type:"cumulative-threads"},setOptions:function(){b.options.chart.yAxis.axisLabel="Threads"}},cumulativeUsers:{title:"Cumulative Users",query:{type:"cumulative-users"},setOptions:function(){b.options.chart.yAxis.axisLabel="Users"}},cumulativeProjects:{title:"Cumulative Projects",query:{type:"cumulative-projects"},setOptions:function(){b.options.chart.yAxis.axisLabel="Projects"}},cumulativeJobs:{title:"Cumulative Jobs",query:{type:"cumulative-jobs"},setOptions:function(){b.options.chart.yAxis.axisLabel="Jobs"}},cumulativeOrganisations:{title:"Cumulative Organisations",query:{type:"cumulative-organisations"},setOptions:function(){b.options.chart.yAxis.axisLabel="Organisations"}}};return b.query.params.query=c[a].query,b.title=c[a].title,c[a]}function k(e){var f;f=Array.isArray(b.query.params.query)?b.query.params.query[e.data.series]:b.query.params.query,a({url:"api/v1/analytics/historical",method:"GET",params:{from:e.data[0],to:e.data[0]+b.query.params.timeResolution,user:b.userId,state:b.state,stateParams:b.stateParams,format:"events",query:f}}).then(function(a){console.log(a);var b;b=a.values?c.keyedArrayToObject(a.values,a.key):a,d.showEntity(null,b)})}function l(){b.loading=!0,a({url:b.query.url,method:"GET",params:b.query.params}).then(n)}function m(){b.query.params.timeResolution===c.resolutionToMs("hour")?b.query.params.from=o-3*c.resolutionToMs("day"):b.query.params.timeResolution===c.resolutionToMs("day")?b.query.params.from=o-c.resolutionToMs("month"):b.query.params.timeResolution===c.resolutionToMs("week")?b.query.params.from=o-6*c.resolutionToMs("month"):b.query.params.timeResolution===c.resolutionToMs("fortnight")?b.query.params.from=o-12*c.resolutionToMs("month"):b.query.params.timeResolution===c.resolutionToMs("month")&&(b.query.params.from=o-24*c.resolutionToMs("month"))}function n(a){b.loading=!1,a.constructor===Array?b.data=a:b.data=[a],b.percent&&_.forEach(b.data[0].values,function(a){a[1]=100*a[1]})}var o=(new Date).getTime();b.resolutionObject=c.getResolutionObject(),b.showChartsSelectModal=h,b.getData=l,b.getFromTime=m,b.chartStyle=b.chartStyle||"historicalBar",b.divisorOptions=e.getDivisorOptions(),b.divisorChange=i,g()}]}}]),angular.module("modules.charts",["modules.charts.charts-time-bar","modules.charts.charts-retention","modules.charts.charts-growth"]),angular.module("modules.charts").config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob):/)}]).directive("downloadChartData",["$compile",function(a){return{restrict:"A",replace:!0,template:'<a class="md-button" download="stemn-graph-data.csv" ng-href="{{ url }}"><ng-md-icon icon="file_download" style="fill: white"></ng-md-icon></a>',scope:{data:"="},link:function(a,b,c){function d(b){function c(a){var b=function(a){return"\n"+c(a.values)+d(a.values)+e(a.values)+a.key+","+f(a.values)},c=function(a){return"RawTime,"+a.map(function(a){return a[0]}).join(",")+"\n"},d=function(a){return"Date,"+a.map(function(a){return new Date(a[0])}).map(function(a){return a.getDate()+"/"+a.getMonth()+"/"+a.getFullYear()}).join(",")+"\n"},e=function(a){return"Time,"+a.map(function(a){return new Date(a[0])}).map(function(a){return a.getHours()+":"+a.getMinutes()}).join(",")+"\n"},f=function(a){return a.map(function(a){return a[1]}).join(",")+"\n"};return Array.isArray(a)?a.reduce(function(a,c){return a+b(c)},""):b(a)}var d=c(a.data),e=new Blob([d],{type:"text/plain"});return(window.URL||window.webkitURL).createObjectURL(e)}a.$watch("data",function(){a.data&&(a.url=d(a.data))})}}}]).service("ChartService",["$mdDialog","CoreLibrary",function(a,b){function c(){return{current:"",options:[{model:"timeOnSite",title:"Time On Site"},{model:"timeOnState",title:"Time On State"},{model:"statesVisited",title:"States Visited"},{model:"activeUsers",title:"Active Users"},{model:"visits",title:"Visits"},{model:"uniqueSiteVisits",title:"Unique Site Visits"},{model:"projects",title:"Projects"},{model:"threads",title:"Threads"},{model:"posts",title:"Posts"},{model:"comments",title:"Comments"},{model:"organisations",title:"Organisations"},{model:"cumulative-users",title:"Cumulative Users"}]}}function d(a,b){var c={multiBar:{chart:{type:"multiBarChart",clipEdge:!0,duration:500,stacked:!0,multibar:{dispatch:{elementClick:b}}}},historicalBar:{chart:{type:"historicalBarChart",showValues:!0,valueFormat:function(a){return d3.format(",.1f")(a)},transitionDuration:500,bars:{dispatch:{elementClick:b}},tooltip:{keyFormatter:function(a){return d3.time.format("%d %B")(new Date(a))}}}}},d=c[a],e={chart:{height:350,margin:{top:20,right:20,bottom:70,left:50},xAxis:{tickFormat:function(a){return d3.time.format("%d/%m/%Y")(new Date(a))},rotateLabels:50,showMaxMin:!1},yAxis:{axisLabelDistance:-10,tickFormat:function(a){return d3.format(",.2f")(a)}},x:function(a){return a[0]},y:function(a){return a[1]}}};return d=_.merge(d,e)}function e(b,c){return a.show({templateUrl:"app/modules/charts/tpls/charts-select-modal.html",controller:["$scope","$mdDialog","ChartService","CoreLibrary",function(a,b,d,e){a.resolutionObject=e.getResolutionObject(),a.selectedChartTime=angular.copy(c)||{},a.selectedChartOptions=angular.copy(c)||{},a.selectedChartTime.to=new Date(a.selectedChartTime.to),a.selectedChartTime.from=new Date(a.selectedChartTime.from),a.divisorOptions=d.getDivisorOptions(),a.cancel=function(){b.cancel()},a.save=function(){a.selectedChartOptions.from=a.selectedChartTime.from.getTime(),a.selectedChartOptions.to=a.selectedChartTime.to.getTime(),b.hide(a.selectedChartOptions)}}],targetEvent:b,clickOutsideToClose:!0})}this.getChartOptions=d,this.getDivisorOptions=c,this.selectModal=e}]),angular.module("modules.compile",[]),angular.module("modules.compile").directive("compileWatch",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compileWatch)},function(e){c.html(e),a(c.contents())(b.$eval(d.scope)||b)})}}]).directive("compile",["$compile",function(a){return function(b,c,d){var e=b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b),e()})}}]),angular.module("modules.confirm-click",[]),angular.module("modules.confirm-click").directive("confirmClick",["$mdDialog",function(a){return{priority:50,restrict:"A",link:{pre:function(b,c,d){var e={};e.confirmTitle=d.confirmTitle,e.confirmBody=d.confirmBody,e.confirmYes=d.confirmYes,e.confirmNo=d.confirmNo;var f=d.ngClick||d.href;c.bind("click touchstart",function(c){"false"!=d.confirm&&(c.stopImmediatePropagation(),c.preventDefault(),a.show({templateUrl:"app/modules/confirm-click/tpls/confirm-click-modal.html",controller:["data","$scope",function(b,c){c.data=b,c.cancel=function(){a.cancel()},c.confirm=function(){a.hide()}}],locals:{data:e},targetEvent:c}).then(function(){b.$eval(f)}))})}}}}]),angular.module("modules.core",[]),angular.module("modules.core").service("CoreService",["ProjectService","EntityService","ThreadService","OrganisationService","FieldService","PostService","CommentService","StatesService",function(a,b,c,d,e,f,g,h){var i=this;this.isEmptyObject=function(a){return _.every(a,function(a,b){return _.isArray(a)?_.every(a,i.isEmptyObject):"$$hashKey"===b?!0:_.isEmpty(a)})},this.getEntity=function(i,j){return"project"==j?a.getProject(i,"sm"):"user"==j?b.get("user",i,"sm"):"organisation"==j?d.getOrganisation(i,"sm"):"field"==j?e.getField(i,"sm"):"thread"==j||"general"==j||"question"==j||"blog"==j?c.getThread(i,"sm"):"post"==j?f.get(i):"comment"==j?g.get(i):"state"==j?h.get(i):"application"==j?b.get("application",i,"sm"):"job"==j?b.get("job",i,"sm"):void console.log(j)},this.getEntityUrl=function(a,b,c){var d,e="https://stemn.com";return"project"==b?d=e+"/projects/"+a:"user"==b?d="/users/"+a:"thread"==b||"general"==b||"question"==b?d=e+"/threads/"+a:"blog"==b?d=e+"/blogs/"+a:"field"==b?d=e+"/fields/"+a:"organisation"==b?d=e+"/org/"+a:"job"==b?d=e+"/jobs/"+a:"application"==b?d=e+"/applications/"+a:console.log("Type undefined"),c&&(d=d+"?publishcode="+c),d},this.getAdminEntityUrl=function(a,b,c){var d,e="https://stemn.com";return"project"==b?d=e+"/projects/"+a:"thread"==b||"general"==b||"question"==b?d=e+"/threads/"+a:"blog"==b?d=e+"/blogs/"+a:"field"==b?d=e+"/fields/"+a:"organisation"==b?d=e+"/org/"+a:"user"==b?d="/users/"+a:"state"==b?d="/states/"+a:console.log("Type undefined"),c&&(d=d+"?publishcode="+c),d},this.getAdminsIds=function(){return["54d6bc399b42758d7196977f","547db55af7f342380174e228","5498e258a7fbbfcc12c3fa15","5496bdb8104ad2c800020602"]},this.getFakesIds=function(){return["54d6bc399b42758d7196977f","547db55af7f342380174e228","5498e258a7fbbfcc12c3fa15","5496bdb8104ad2c800020602","558d27e7c9845c371fecc316","55963596423fe3ab0f034ded","558e72224bb4a80838f97fc2","55b8ca33f51196395e4ab725","5592166923cd38b21cab4905"]},this.isFakeUser=function(a){return-1===i.getFakesIds().indexOf(a)}}]).service("CoreLibrary",function(){var a=this;this.isObjectId=function(a){return/^[a-f0-9]{24}$/.test(a)},this.resolutionToMs=function(a){return"hour"==a?36e5:"day"==a?864e5:"week"==a?6048e5:"fortnight"==a?12096e5:"month"==a?2592e6:void 0},this.checkStateParents=function(b,c){return b.self[c]?b.self[c]:a.checkStateParents(b.parent,c)},this.getResolutionObject=function(){return[{name:"hour",value:36e5},{name:"day",value:864e5},{name:"week",value:6048e5},{name:"fortnight",value:12096e5},{name:"month",value:2592e6}]},this.getDateFromId=function(a){return new Date(1e3*parseInt(a.toString().substring(0,8),16))},this.keyedArrayToObject=function(a,b){var c=[];return _.forEach(a,function(a){var d={};_.forEach(b,function(b,c){d[b]=a[c]}),c.push(d)}),c}}).service("CoreModalService",["$mdDialog",function(a){function b(b,c){c.length>0&&a.show({templateUrl:"app/modules/core/tpls/core-entity-modal.html",controller:["data","$scope",function(b,c){c.enitities=b,c.cancel=function(){a.cancel()}}],targetEvent:b,clickOutsideToClose:!0,locals:{data:c}})}function c(b,c){console.log(c),a.show({templateUrl:"app/modules/core/tpls/core-show-applications-modal.html",controller:["$scope","HttpQuery","CoreLibrary",function(b,d,e){b.query=d({url:"/api/v1/search",params:{type:"application",size:20,sort:"_id",order:"dsc","select[]":["*"]},columns:[{status:!0,template:'<a ui-sref="app.users.user.info({\'stub\': item.child.stub})" class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.child.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',model:"child.picture",width:"40px",sort:!1},{status:!0,search:!0,name:"Applicant",template:'<a ui-sref="app.users.user.info({\'stub\': item.child.stub})" class="underlined">{{item.child.name}}</a>',model:"child.name",width:"150px"},{status:!0,search:!0,name:"Position",template:'<a href="https://stemn.com/applications/{{item._id}}" class="underlined">{{item.parent.name}}</a>',model:"parent.name"},{status:!0,name:"Status",model:"status",width:"140px",template:"<application-status entity='item' entities='query.results' selected-rows='selectedRows'></application-status>"}],filters:{columnOrder:{}},onSucess:function(a){return _.forEach(a,function(a){a.timestamp=e.getDateFromId(a._id)}),a}}),b.query.params=_.extend(b.query.params,c),b.query.more(),b.cancel=function(){a.cancel()}}],targetEvent:b,clickOutsideToClose:!0})}this.showEntity=b,this.showApplications=c}]).directive("clickShowEntities",["CoreModalService",function(a){return{restrict:"A",scope:{clickShowEntities:"="},link:function(b,c,d){c.bind("click",function(c){a.showEntity(c,b.clickShowEntities)})}}}]).directive("coreEntityAdminHref",["CoreService","$parse",function(a,b){return{restrict:"A",link:function(c,d,e){var f=b(e.entity)(c);d[0].setAttribute("href",a.getAdminEntityUrl(f.stub,f.type,f.id))}}}]).directive("coreEntityRow",["CoreService",function(a){return{restrict:"E",replace:!0,transclude:!0,scope:{entityType:"@",entityId:"@",entity:"=?"},templateUrl:"app/modules/core/tpls/core-entity-row.html",controller:["$scope","Authentication",function(b,c){b.entityId&&b.entityType&&a.getEntity(b.entityId,b.entityType).then(function(c){var d;b.entity=c,d=c[c.parentType]&&c[c.parentType].stub?c[c.parentType].stub:c.stub,b.entity.url=a.getEntityUrl(d,c.parentType||c.type||b.entityType,c._id)})}]}}]).directive("coreEntityPicture",["CoreService",function(a){return{restrict:"E",replace:!0,transclude:!0,scope:{entityType:"@",entityId:"@",entity:"=?"},templateUrl:"app/modules/core/tpls/core-entity-picture.html",controller:["$scope","Authentication",function(b,c){b.entityId&&b.entityType&&a.getEntity(b.entityId,b.entityType).then(function(c){var d;b.entity=c,d=c[c.parentType]&&c[c.parentType].stub?c[c.parentType].stub:c.stub,b.entity.url=a.getEntityUrl(d,c.parentType||c.type||b.entityType,c._id)})}]}}]).service("EntityService",["$rootScope","LocalCache","HttpService","$mdToast",function(a,b,c,d){function e(a,d,e){var f,g=j(a),h=["stub","name","picture","blurb"],i=["stub","name","picture","blurb","created","updated","fields","organisations","team","likes","numComments","location"],k=["stub","name","picture","blurb","profile.banner","followers","numProjects"],l=["*"];"sm"==e?f=h:"md"==e?f="users"==g?k:i:(f=l,e="lg");var m=function(a){return c({url:"/api/v1/"+g,method:"GET",params:{"select[]":f,"ids[]":a}})};return b.getPackaged(g+e,d,m)}function f(a,b){var d=j(a);return c({method:"POST",url:"api/v1/"+d,data:b})}function g(d,e){var f=j(d);return b.save(f+"lg",e),c({method:"PUT",url:"api/v1/"+f+"/"+e._id,data:e}).then(function(b){return a.$broadcast(f.slice(0,-1)+".save",b),b})}function h(a,b){var d=j(a);return c({method:"PATCH",url:"api/v1/"+d+"/"+b._id,data:b})}function i(a,b){var d=j(a);return c({url:"/api/v1/"+d+"/"+b,method:"DELETE"})}function j(a){var b;return"jobs"==a||"job"==a?b="jobs":"applications"==a||"application"==a?b="applications":"users"==a||"user"==a?b="users":"campaigns"==a||"campaign"==a?b="campaigns":"fields"==a||"field"==a?b="fields":"projects"==a||"ptoject"==a?b="projects":"threads"==a||"thread"==a?b="threads":"reminders"==a||"reminder"==a?b="reminders":"organisations"==a||"organisation"==a?b="organisations":console.error("Invalid Entity Type"),b}function k(){d.show(d.simple().content("Save Successful"))}function l(){d.show(d.simple().content("Delete Successful"))}this.get=e,this.create=f,this.update=g,this.patch=h,this.remove=i,this.updateSuccess=k,this.removeSuccess=l}]),angular.module("modules.d3.d3-bars",[]),angular.module("modules.d3.d3-bars").directive("d3Bars",["d3Service","$window","$timeout",function(a,b,c){return{restrict:"EA",scope:{data:"=",onClick:"&"},link:function(d,e,f){function g(a){j.selectAll("*").remove(),a&&(h&&c.cancel(h),h=c(function(){var b=i.select(e[0])[0][0].offsetWidth-k,c=d.data.length*(l+m),f=i.scale.category20b(),g=i.scale.linear().domain([0,i.max(a,function(a){return a.num})]).range([0,b]);j.attr("height",c),j.selectAll("rect").data(a).enter().append("rect").on("click",function(a,b){return d.onClick({item:a})}).attr("height",l).attr("width",140).attr("x",Math.round(k/2)).attr("y",function(a,b){return b*(l+m)}).attr("fill",function(a){return f(a.num)}).transition().duration(1e3).attr("width",function(a){return g(a.num)}),j.selectAll("text").data(a).enter().append("text").on("click",function(a,b){return d.onClick({item:a})}).attr("fill","#fff").attr("y",function(a,b){return b*(l+m)+15}).attr("x",15).text(function(a){return a.name+" ("+a.num+")"})},200))}var h,i=a.d3,j=i.select(e[0]).append("svg").style("width","100%"),k=parseInt(f.margin)||20,l=parseInt(f.barHeight)||20,m=parseInt(f.barPadding)||5;b.onresize=function(){d.$apply()},d.$watch(function(){return angular.element(b)[0].innerWidth},function(){g(d.data)}),d.$watch("data",function(){return g(d.data)},!0)}}}]),angular.module("modules.d3.d3-multi-line-chart",[]),angular.module("modules.d3.d3-multi-line-chart").directive("d3MultiLineChart",["d3Service","$window","$timeout",function(a,b,c){return{restrict:"EA",scope:{data:"=",timeRangeFn:"=?",legendSelectFn:"=?"},link:function(d,e,f){function g(a){l.selectAll("*").remove(),a&&(i&&c.cancel(i),i=c(function(){function b(b){b.visible=!b.visible,f=h(a),r.domain([0,f]),d.legendSelectFn(y.extent()),j.select(".y.axis").transition().call(v),A.select("path").transition().attr("d",function(a){return a.visible?w(a.values):null}),A.select("rect").transition().attr("fill",function(a){return a.visible?s(a.name):"#F1F1F2"})}function c(){p.domain(y.empty()?q.domain():y.extent()),j.select(".x.axis").transition().call(t),f=h(a),r.domain([0,f]),j.select(".y.axis").transition().call(v),A.select("path").transition().attr("d",function(a){return a.visible?w(a.values):null}),d.timeRangeFn(y.extent(),a)}var f,g={top:20,right:200,bottom:100,left:50},i={top:430,right:10,bottom:20,left:40},m=e[0].offsetWidth-g.left-g.right,n=500-g.top-g.bottom,o=500-i.top-i.bottom,p=(k.time.format("%Y%m%d").parse,k.bisector(function(a){return a.date}).left,k.time.scale().range([0,m])),q=k.time.scale().range([0,m]),r=k.scale.linear().range([n,0]),s=k.scale.ordinal().range(["#48A36D","#64B98C","#80CEAA","#7FC9BD","#7EC4CF","#7FB1CF","#809ECE","#8F90CD","#9E81CC","#B681BE","#CE80B0","#D76D8F","#E05A6D","#E26962","#E37756","#E39158","#E2AA59","#DFB95C","#DBC75F","#EAD67C"]),t=k.svg.axis().scale(p).orient("bottom"),u=k.svg.axis().scale(q).orient("bottom"),v=k.svg.axis().scale(r).orient("left"),w=k.svg.line().x(function(a){return p(a.date)}).y(function(a){return r(a.number)});j=l.attr("width",m+g.left+g.right).attr("height",n+g.top+g.bottom).append("g").attr("transform","translate("+g.left+","+g.top+")"),j.append("rect").attr("width",m).attr("height",n).attr("x",0).attr("y",0).attr("id","mouse-tracker").style("fill","white");
var x=j.append("g").attr("transform","translate(0,410)").attr("class","context");j.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",m).attr("height",n),s.domain(_.map(a,"name")),a[0].values[0].date instanceof Date||a.forEach(function(a){a.values.forEach(function(a){a.date=new Date(a.date)})}),p.domain([k.min(a,function(a){return k.min(a.values,function(a){return a.date})}),k.max(a,function(a){return k.max(a.values,function(a){return a.date})})]),r.domain([0,100]),q.domain(p.domain());var y=k.svg.brush().x(q).on("brush",c);x.append("g").attr("class","x axis1").attr("transform","translate(0,"+o+")").call(u);var z=k.svg.area().interpolate("monotone").x(function(a){return q(a.date)}).y0(o).y1(0);x.append("path").attr("class","area").attr("d",z(a[0].values)).attr("fill","#F1F1F2"),x.append("g").attr("class","x brush").call(y).selectAll("rect").attr("height",o).attr("fill","#E6E7E8"),j.append("g").attr("class","x axis").attr("transform","translate(0,"+n+")").call(t),j.append("g").attr("class","y axis").call(v).append("text").attr("transform","rotate(-90)").attr("y",6).attr("x",-10).attr("dy",".71em").style("text-anchor","end").text("Number");var A=j.selectAll(".issue").data(a).enter().append("g").attr("class","issue");A.append("path").attr("class","line").style("pointer-events","none").attr("id",function(a){return"line-"+a.name.replace(" ","").replace("/","")}).attr("d",function(a){return a.visible?w(a.values):null}).attr("clip-path","url(#clip)").style("stroke",function(a){return s(a.name)});var B=450/a.length;j.append("text").attr("x",m+g.right/3).attr("y",10).text("Click to Toggle All").on("click",function(){k.select(this),_.forEach(d.data,function(a){b(a)})}),A.append("rect").attr("width",10).attr("height",10).attr("x",m+g.right/3-15).attr("y",function(a,b){return B+b*B-8}).attr("fill",function(a){return a.visible?s(a.name):"#F1F1F2"}).attr("class","legend-box").on("click",function(a){b(a)}).on("mouseover",function(a){k.select(this).transition().attr("fill",function(a){return s(a.name)}),k.select("#line-"+a.name.replace(" ","").replace("/","")).transition().style("stroke-width",4.5)}).on("mouseout",function(a){k.select(this).transition().attr("fill",function(a){return a.visible?s(a.name):"#F1F1F2"}),k.select("#line-"+a.name.replace(" ","").replace("/","")).transition().style("stroke-width",1.5)}),A.append("text").attr("x",m+g.right/3).attr("y",function(a,b){return B+b*B}).text(function(a){return a.name}).on("click",function(a){b(a)});var C=j.append("g").attr("class","hover-line"),D=(C.append("line").attr("id","hover-line").attr("x1",10).attr("x2",10).attr("y1",0).attr("y2",n+10).style("pointer-events","none").style("opacity",1e-6),C.append("text").attr("class","hover-text").attr("y",n-(n-40)).attr("x",m-150).style("fill","#E6E7E8"),_.map(a,"name")),E=A.select("g").data(D).enter().append("g").attr("class","focus");E.append("text").attr("class","tooltip").attr("x",m+20).attr("y",function(a,b){return B+b*B}),c()},200))}function h(a){var b=a.map(function(a){return a.visible?k.max(a.values,function(a){return a.number}):void 0});return k.max(b)}var i,j,k=a.d3,l=k.select(e[0]).append("svg");b.onresize=function(){d.$apply()},d.$watch(function(){return angular.element(b)[0].innerWidth},function(){g(d.data)}),d.$watch("data",function(){return g(d.data)}),c(function(){g(d.data)},100)}}}]),angular.module("modules.d3",["modules.d3.d3-bars","modules.d3.d3-multi-line-chart"]),angular.module("modules.d3").service("d3Service",["$window",function(a){var b=a.d3;return{d3:b}}]),angular.module("modules.emails",["angular-medium-editor"]),angular.module("modules.emails").directive("recentEmails",function(){return{restrict:"E",scope:{parentId:"@"},templateUrl:"app/modules/emails/tpls/recent-emails.html",controller:["$scope","HttpQuery","CoreLibrary",function(a,b,c){a.query=b({url:"api/v1/emails",params:{criteria:{recipient:a.parentId}},onSuccess:function(a){return _.forEach(a,function(a){a.created=c.getDateFromId(a._id)}),a}}),a.query.more()}]}}).service("EmailService",["$http","$mdToast","$mdDialog","Authentication","EmailTemplates",function(a,b,c,d,e){function f(a,b){return c.show({templateUrl:"app/modules/emails/tpls/compose-email-modal.html",controller:["data","$scope",function(a,b){var f=d.userData,g=angular.copy(a.recipient);b.email={sender:{_id:f._id,name:f.name,email:f.email},recipient:{_id:g._id,name:g.name,email:g.profile.email},message:{html:"",subject:"",type:""}},b.templates=e.get(),b.messageType={model:"",onChange:function(){var a=_.find(b.templates,"name",b.messageType.model).getTemplate(g);b.email.message={type:b.messageType.model},_.extend(b.email.message,a)}},b.cancel=function(){c.cancel()},b.save=function(){b.email.message.html&&b.email.message.html.length>10&&c.hide(b.email)}}],targetEvent:a,locals:{data:b}})}function g(b){return a({method:"POST",url:"api/v1/emails/sendEmail",data:b})}this.sendEmail=g,this.composeEmail=f}]).service("EmailTemplates",["$http","$mdToast","$mdDialog","Authentication",function(a,b,c,d){function e(){return[{name:"Job Application - More work needed",getTemplate:function(a){return{subject:"Your STEMN job application is getting close...",html:"\n                        Hi "+a.profile.firstname+',<br><br>\n                        Our team has personally reviewed your applications, and we\'ve decided we aren\'t able to send them through, <b>yet</b>.<br><br>\n                        Your candidacy looks good on paper, and you would rank among the top 10 percentile for some roles. However we found the quality and content of your projects to be insufficient for what our partner companies are expecting.<br><br>\n                        Our partner companies require your technical, problem solving, and communication skills to be demonstrated through your projects, but your projects aren\'t quite there yet. Your projects should be structured according to the scientific method. It doesn\'t need to be as formal as a journal paper, but it does need to show your methodical approach to technical problems. Here are two good examples:<br><br>\n                        <a href="https://stemn.com/projects/holonomic-robot?ref=a7d1d8">Holonomic Robot</a><br>\n                        <a href="https://stemn.com/projects/interactive-data-glove-for-american-sign-language?ref=e1a6fe">Interactive Data Glove for American Sign Language</a><br><br>\n                        You can also read our guide on <a href="https://stemn.com/blogs/how-to-create-a-compelling-project-that-gets-you-hired?ref=a7d372">how to create a compelling project that gets you hired.</a><br><br>\n                        A standout application will take time to craft. If you’re serious about your career, we’re serious about doing everything we can to help you get there. How long do you think you’ll need?<br><br>\n                        Reply to this email with a date, and we’ll set aside a time to review your application with you over Skype and get it sent!<br><br>\n                        Let me know if you have any questions - I\'m always happy to help.<br><br>\n                        Speak soon,<br>\n                        '+g.name+"<br>\n                        Co-Founder, STEMN\n                    "}}},{name:"Job Application - Setup meeting",getTemplate:function(a){return{subject:"Time to talk about your STEMN job applications!",html:"\n                        Hey "+a.profile.firstname+",<br><br>\n                        Our team has personally reviewed your application, and we'd like to schedule a Skype call to give you feedback on how you can improve your portfolio before we send it through.<br><br>\n                        During this session, we'll be reviewing your portfolio with you from a hiring manager's perspective. We know exactly what the hiring managers are looking for, and we'll help you shape your portfolio to blow them away.<br><br>\n                        In addition, we'll also share particular insights about what specific companies are looking for, and, it'll give you an opportunity to sharpen those interviewing skills.<br><br>\n                        Are you available to chat in the next day or two? If so, here's my current availability. If those times don't work, let me know - we'll try schedule something at a time of your convenience.<br><br>\n                        <a href=\""+f+'">'+f+"</a><br><br>\n                        Thanks,<br>\n                        "+g.name+"<br>\n                        Co-Founder, STEMN\n                    "}}},{name:"Job Application - Meeting Notes",getTemplate:function(a){return{subject:"My notes from our Skype call",html:"\n                    Hey "+a.profile.firstname+",<br><br>\n                    I went back over your profile and made some notes. I also thought I'd include some of the points from our call for your reference.<br><br>\n                    On your STEMN profile page, the blurb under your name should contain your defining unique quality. What do you feel you posses that other's don't? Put that there.<br><br>\n                    In the My Education section, list all of the courses you completed as part of your degree. Everybody's course specializations are different, so use this as a chance to convey your educational experience.<br><br>\n                    The Skills and Knowledge section can be populated manually. However the skills with numbers are populated from your projects. This gives companies a chance to see how you demonstrated a skill in practice. I highly recommend adding as many relevant tags to your projects as possible. Finally, make sure to categorize these skills on your profile page into Skills and Technologies.<br><br>\n                    As mentioned, the average number of projects each applicant has is two. To stand out, try to make this number four or five. As soon as employers see more content, they are more impressed - it's only natural to be impressed by a larger body of work.<br><br>\n                    Lastly, and most importantly, the cover letter to each company should be mostly about the company. Do your research on the company, learn about their technology, where they've been, and where they're going. Search for interviews and press releases, watch YouTube videos, find anything you can. Then, use this to inform your cover letter and talk about why they inspire you, and what working with them would mean to you, relating your skills and aspirations to their work. This is possibly the single most important part of your application. Personally, I believe companies impressions are weighted 60/40 cover letter/portfolio. This will also bode well for you in the interview when you are informed about the company.<br><br>\n                    Do all of those things, and you'll blow them away. I promise.<br><br>\n                    After you finish your updates, reply to this email and I'll review your changes and we can progress to the next stage.<br><br>\n                    We're looking forward to taking your portfolio to our contacts at these companies, and we'll put in our absolute best to try and get you one of the jobs you applied to.<br><br>\n                    Talk soon,<br><br>\n                    "+g.name+"<br>\n                    Co-Founder, STEMN\n                "}}},{name:"Generic Email",getTemplate:function(a){return{subject:"",html:"\n                    Hey "+a.profile.firstname+",<br><br>\n                    Message.<br><br>\n                    "+g.name+"<br>\n                    Co-Founder, STEMN\n                "}}}]}var f,g=d.userData,h={"Jackson Delahunt":"https://calendly.com/stemn-jackson/15min","Jack Yeh":"https://calendly.com/jackyeh/30min","Denzil Khan":"https://calendly.com/denzil/30min"};f=h[g.name]||h["Jack Yeh"],this.get=e}]),angular.module("modules.error-handling",[]),angular.module("modules.error-handling").config(["$httpProvider",function(a){a.interceptors.push(["$q","$window","$injector",function(a,b,c){return{response:function(a){return a},responseError:function(b){var d,e=c.get("$mdToast");return b.data&&b.data.error&&(d=b.data.error),d&&(console.log(d),e.show(e.simple().theme("warn").content(d))),a.reject(b)}}}])}]).run(["$rootScope","$state","$timeout",function(a,b,c){a.$on("$stateChangeError",function(a,c,d,e,f,g){console.error("errored changing to "+c.name),console.error("stateChangeError:"),g.getStack&&console.error(g.getStack()),console.error(g),b.go("error",null,{location:!1})})}]),angular.module("modules.field",[]),angular.module("modules.field").service("FieldService",["LocalCache","$http","HttpService",function(a,b,c){function d(c,d){var e;"sm"==d?e=["stub","name","type","blurb","picture"]:(e=["*"],d="lg");var g=function(a){return b({url:"/api/v1/organisations",method:"GET",params:{"select[]":e,"ids[]":a}})};return a.getPackaged(f+d,c,g)}function e(a){return c({method:"PUT",url:"api/v1/fields/"+a._id,data:a})}this.getField=d,this.saveField=e;var f="threads"}]),angular.module("modules.filters",[]),angular.module("modules.filters").filter("capitaliseFirst",function(){return function(a){return a=a||"",a.substring(0,1).toUpperCase()+a.substring(1).toLowerCase()}}).filter("nospace",function(){return function(a){return a?a.replace(/ /g,""):""}}).filter("bytes",function(){return function(a,b){if(0===a||isNaN(parseFloat(a))||!isFinite(a))return"-";"undefined"==typeof b&&(b=1);var c=["bytes","kB","MB","GB","TB","PB"],d=Math.floor(Math.log(a)/Math.log(1024));return(a/Math.pow(1024,Math.floor(d))).toFixed(b)+" "+c[d]}}).filter("words",function(){return function(a,b){if(isNaN(b))return a;if(0>=b)return"";if(a){var c=a.split(/\s+/);c.length>b&&(a=c.slice(0,b).join(" ")+"…")}return a}}).filter("letters",function(){return function(a,b){return isNaN(b)?a:0>=b?"":(a&&a.length>b&&(a=a.slice(0,b)+"…"),a)}}).filter("orderObjectBy",function(){return function(a,b){if(!angular.isObject(a))return a;var c=[];for(var d in a)c.push(a[d]);return c.sort(function(a,c){return a=parseInt(a[b]),c=parseInt(c[b]),a-c}),c}}).filter("hasValue",function(){return function(a){return null===a?!1:""!==a}}).filter("firstWord",function(){return function(a){return a=a.split(" ")[0]}}).filter("lastWord",function(){return function(a){return a=a.split(" ").pop()}}).filter("isEmptyObject",["$filter",function(a){return function(b){return _.every(b,function(b,c){return _.isArray(b)?_.every(b,a("isEmptyObject")):"$$hashKey"===c?!0:_.isEmpty(b)})}}]).filter("consolelog",function(){return function(a){console.log(a)}}).filter("trueValues",function(){return function(a){var b=[];return _.each(a,function(a,c){if(a===!0){var d={};d[c]=a,b.push(d)}}),b}}).filter("values",function(){return function(a){var b=[];return _.each(a,function(a,c){var d={};d[c]=a,b.push(d)}),b}}).filter("toJSON",function(){return function(a){return JSON.stringify(a,null,4)}}).filter("stripHttp",function(){return function(a){return a.toString().replace("http://","").replace("https://","").replace("www.","").replace("http://www.","").replace("https://www.","")}}).filter("typeaheadHighlightMatch",function(){function a(a){return a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(b,c){return c?(""+b).replace(new RegExp("\\b"+a(c),"gi"),"<strong>$&</strong>"):b}}),angular.module("modules.galaxy",[]),angular.module("modules.galaxy").directive("galaxy",["CoreService",function(a){return{restrict:"E",template:'<canvas id="canv" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 0"></canvas>',link:function(a,b,c){function d(a){return Math.sin(a.y/45)/.3}function e(a){return Math.sin(a.x/45)/.3}function f(a){var b=o[p];b.x+=b.vx,b.y+=b.vy,b.x<0?b.x=l+b.x:b.x>=l&&(b.x-=l),b.y<0?b.y=m+b.y:b.y>=m&&(b.y-=m),b.vy=e(b),b.vx=d(b)}function g(a){var b=o[p],c="hsla("+p+",90%, 60%, 1)";k.beginPath(),k.fillStyle=c,k.globalAlpha=.1,k.arc(b.x,b.y,15/Math.max(b.vx*b.vx+b.vy*b.vy,.5),0,2*Math.PI,0),k.closePath(),k.fill(),k.beginPath(),k.globalAlpha=1,k.fillStyle=c,k.arc(b.x,b.y,8/Math.max(b.vx*b.vx+b.vy*b.vy,.8),0,2*Math.PI,0),k.closePath(),k.fill()}function h(){for(k.fillStyle="hsla(0,0%,0%,1)",k.fillRect(0,0,l,m),p=0;n>p;p++)f(p),g(p)}function i(){window.requestAnimationFrame(i),h()}var j=document.getElementById("canv"),k=j.getContext("2d"),l=j.width=window.innerWidth,m=j.height=window.innerHeight;window.addEventListener("resize",function(){j.width=l=window.innerWidth,j.height=m=window.innerHeight},!1);for(var n=l*m/810,o=[],p=0;o.length<n;)o.push({x:Math.random()*l|0,y:Math.random()*m|0,vx:0,vy:0});i()}}}]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};!function(){function a(a,b,c,d){function e(e,f){f&&"object"===("undefined"==typeof f?"undefined":_typeof(f))&&(f=d.isEmptyObject(f)?null:JSON.stringify(f)),a.current.reloadOnSearch=!1,b.search(e,f),c(function(){a.current.reloadOnSearch=void 0})}this.set=e}function b(a,b,c){return function(c){return a(c).then(function(a){return a.data})["catch"](function(a){return b.reject(a)})}}function c(a,b,c,d,e){var f=function(f){function g(){console.log("You must assign get function")}function h(b){s.get=function(){s.loading=!0,a({url:b,method:"GET",params:s.params}).then(s.success)}}function i(){s.params.page++,s.get()}function j(){0===s.params.page&&(s.params.page=1),s.get()}function k(){s.params.page=1,s.get()}function l(a){f.onSuccess&&(a=f.onSuccess(a)),1==s.params.page&&(s.notEnoughResults=a.length<s.params.size,s.results=[]),s.loading=!1,f.paginate?s.results=a:s.results=s.results.concat(a),s.noMoreResults=a.length<s.params.size}function m(a){var b=angular.copy(a);return _.forEach(f.urlParams,function(a){d[a]&&(b[a]=d[a])}),b}function n(){var a=s.params["select[]"]||s.params.select,b=_.map(f.columns,function(a){return a.model?a.model.split("[")[0]:void 0}),c=_.uniq(a.concat(b));s.params.select?s.params.select=c:s.params["select[]"]&&(s.params["select[]"]=c)}function o(){c.cancel(p),p=c(function(){_.forEach(f.urlParams,function(a){s.params[a]&&s.params[a]!=r[a]?b.set(a,s.params[a]):b.set(a,null)})},q)}var p,q=1e3,r=angular.copy(f.params),s={params:{}};return s.params.page=0,s.params.size=10,s.params.criteria={},s.params=_.merge(s.params,f.params),s.params=m(s.params),e.$on("$stateChangeStart",function(){c.cancel(p)}),s.loading=!1,s.columns=f.columns,s.filters=f.filters,s.get=g,s.setGet=h,s.more=i,s.init=j,s.refresh=k,s.success=l,s.updateQueryParams=o,s.determineSelect=n,f.url&&s.setGet(f.url),s};return f}angular.module("modules.http",[]),angular.module("modules.http").service("HttpService",b).service("HttpQuery",c).service("QueryParamsService",a),a.$inject=["$state","$location","$timeout","CoreService"],b.$inject=["$http","$q","$mdToast"],c.$inject=["HttpService","QueryParamsService","$timeout","$stateParams","$rootScope"]}(),angular.module("modules.image.search",[]),angular.module("modules.image.search").directive("imageSearch",function(){return{restrict:"E",templateUrl:"app/modules/image-search/tpls/image-search.html",scope:{name:"@",model:"=?",query:"=?",multiple:"=?"},controller:["$scope","$http",function(a,b){function c(c){a.currentImage=c,a.loading=!0,b({url:"/api/v1/download",method:"POST",data:{url:c}}).then(function(b){a.multiple?(a.model=a.model||[],a.model[0]={url:b.data.url}):a.model=b.data.url,e()})["catch"](e)}function d(a){return a=a.replace(/\s+/g,"+")}function e(){a.loading=!1}a.query=function(){return a.loading=!0,b({method:"GET",skipAuthorization:!0,url:"https://www.googleapis.com/customsearch/v1?q="+d(a.name)+"&cx=003785480854512233903%3Aagsyong4y2m&fileType=jpg&imgSize=large&imgType=photo&num=8&searchType=image&key=AIzaSyAjfpimM8OB_z1BvpPiSabAWcP-vmby-hs"}).then(function(b){e(),a.imageSearch=b.data})["catch"](e)},a.selectedImage=c}]}}),angular.module("modules.jobs",[]),angular.module("modules.jobs").directive("jobRows",function(){return{restrict:"E",scope:{parentType:"@",parentId:"@"},controller:["$scope","HttpQuery",function(a,b){a.query=b({url:"/api/v1/search",params:{type:"job",size:20,sort:"date",order:"dsc",parentType:a.parentType,parentId:a.parentId,select:["name","stub","numApplications"]},onSuccess:function(a){return console.log(a),a}}),a.query.more()}],templateUrl:"app/modules/jobs/tpls/job-rows.html"}}),angular.module("modules.keyboard-navigation",[]),angular.module("modules.keyboard-navigation").directive("keyboardNavigationTabs",["SearchService",function(a){return{restrict:"A",scope:{enable:"=",tabs:"="},controller:["$scope","$timeout","$document","KeyboardNavigationService","$state",function(a,b,c,d,e){function f(b){b.keyCode==d.keyCodes.LEFTARROW?(b.preventDefault(),i=h(),i--,-1==i&&(i=a.tabs.length-1),j=i%a.tabs.length,e.go(a.tabs[j].sref)):b.keyCode==d.keyCodes.RIGHTARROW&&(b.preventDefault(),i=h(),i++,j=i%a.tabs.length,e.go(a.tabs[j].sref))}function g(){c.off("keydown",f)}function h(){return _.findIndex(a.tabs,function(a){return e.includes(a.sref)})}var i,j=0;a.$watch("enable",function(){a.enable?c.on("keydown",f):c.off("keydown",f)}),a.$on("$destroy",g)}]}}]).service("KeyboardNavigationService",function(){this.keyCodes={BACKSPACE:8,TABKEY:9,RETURNKEY:13,ESCAPE:27,SPACEBAR:32,LEFTARROW:37,UPARROW:38,RIGHTARROW:39,DOWNARROW:40}}),angular.module("modules.loading",[]),angular.module("modules.loading").directive("loadingOverlay",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{determinate:"=?"},template:'<div class="loading-overlay" layout="column" layout-align="center center"><md-progress-circular style="margin: 5px 0;" ng-if="!determinate" class="md-accent" md-mode="indeterminate"></md-progress-circular><md-progress-circular style="margin: 5px 0;" ng-if="determinate"  class="md-accent" md-mode="determinate" value="{{determinate}}"></md-progress-circular><div class="text-lightgrey" ng-transclude></div></div>'}}),angular.module("modules.local-cache",[]),angular.module("modules.local-cache").service("LocalCache",["$timeout","$q","CoreLibrary",function(a,b,c){function d(d,e,k,l){j.requestCache[d]=j.requestCache[d]||{},j.requestCache[d].cache=j.requestCache[d].cache||{},j.requestCache[d].index=j.requestCache[d].index||{},j.requestCache[d].stubCache=j.requestCache[d].stubCache||{};var m=b.defer(),n=f(d,e);return n&&!l?n.promise||b.when(n):(j.requestCache[d].packagePromise?i(d,e):(h(d,k,e),j.requestCache[d].packagePromise=a(function(){return j.requestCache[d].packagePromise=void 0,g(d)},10)),c.isObjectId(e)?j.requestCache[d].cache[e]=m:j.requestCache[d].stubCache[e]=m,m.promise)}function e(a,b){j.requestCache[a]&&(b.stub&&(j.requestCache[a].index[b.stub]=b._id),b._id&&(j.requestCache[a].cache[b._id]=b))}function f(a,b){var c;return j.requestCache[a]&&(j.requestCache[a].cache||j.requestCache[a].stubCache)?j.requestCache[a].cache[b]?(c=j.requestCache[a].cache[b],c.error?!1:c):j.requestCache[a].cache[j.requestCache[a].index[b]]?(c=j.requestCache[a].cache[j.requestCache[a].index[b]],c.error?!1:c):j.requestCache[a].stubCache[b]?(c=j.requestCache[a].stubCache[b],c.error?!1:c):!1:!1}function g(a){return j.requestCache[a].request(j.requestCache[a]["package"]).then(function(b){_.forEach(b,function(b){b.error?(j.requestCache[a].cache[b._id]&&j.requestCache[a].cache[b._id].reject&&j.requestCache[a].cache[b._id].reject(b),j.requestCache[a].stubCache[b.stub]&&j.requestCache[a].stubCache[b.stub].reject&&j.requestCache[a].stubCache[b.stub].reject(b)):(j.requestCache[a].cache[b._id]&&j.requestCache[a].cache[b._id].resolve&&j.requestCache[a].cache[b._id].resolve(b),j.requestCache[a].stubCache[b.stub]&&j.requestCache[a].stubCache[b.stub].resolve&&j.requestCache[a].stubCache[b.stub].resolve(b)),e(a,b)})})["catch"](function(b){_.forEach(j.requestCache[a]["package"],function(c){j.requestCache[a].cache[c]&&j.requestCache[a].cache[c].reject&&j.requestCache[a].cache[c].reject(b),j.requestCache[a].stubCache[c]&&j.requestCache[a].stubCache[c].reject&&j.requestCache[a].stubCache[c].reject(b)})})}function h(a,b,c){j.requestCache[a]["package"]=[c],j.requestCache[a].request=b}function i(a,b){j.requestCache[a]["package"].push(b)}var j=this;this.getPackaged=d,this.save=e,this.requestCache={}}]),angular.module("modules.logs",[]),angular.module("modules.logs").service("LogService",["Restangular","$http",function(a,b){this.getLogs=function(a){return b({url:"api/v1/logs",method:"GET",params:a})},this.getStateHistory=function(a){return b({url:"api/v1/analytics/stateHistory",method:"GET",params:a})}}]).directive("displayLogs",["CoreService",function(a){return{restrict:"E",scope:{entityId:"@"},templateUrl:"app/modules/logs/tpls/display-logs.html",controller:["$scope","LogService","$http","CoreLibrary",function(a,b,c,d){function e(){a.noMoreResults||(a.loading=!0,b.getLogs({fields:{requestUser:a.entityId,event:{$nin:["get-notifications","feed-all","search"]}},exists:{event:!0},select:["parentType","parentId","entityType","entityId","event","requestUser"],page:f,size:10}).then(function(b){b=b.data,0===b.length&&(a.noMoreResults=!0),a.logs=a.logs.concat(b),a.loading=!1,f++}))}var f=1;a.logs=[],a.getLogs=e,a.getLogs()}]}}]).directive("displayStateHistory",["CoreService",function(a){return{restrict:"E",scope:{entityId:"@"},templateUrl:"app/modules/logs/tpls/display-state-history.html",controller:["$scope","LogService","$http","CoreLibrary",function(a,b,c,d){function e(){a.noMoreResults||(a.loading=!0,b.getStateHistory({user:a.entityId,page:f,size:10}).then(function(b){_.forEach(b.data,function(a){a.date=d.getDateFromId(a._id)}),0===b.data.length&&(a.noMoreResults=!0),a.logs=a.logs.concat(b.data),a.loading=!1,f++}))}var f=((new Date).getTime(),1);a.logs=[],a.getLogs=e,a.getLogs()}]}}]),angular.module("modules.material",[]),angular.module("modules.material").config(["$mdThemingProvider",function(a){a.theme("warn").primaryPalette("red")}]),angular.module("modules.moment",["angularMoment"]),angular.module("modules.moment").run(["moment",function(a){}]),angular.module("modules.organisation",[]),angular.module("modules.organisation").service("OrganisationService",["LocalCache","$http",function(a,b){function c(c,d){var f;"sm"==d?f=["stub","name","type","blurb","picture"]:(f=["*"],d="lg");var g=function(a){return b({url:"/api/v1/organisations",method:"GET",params:{"select[]":f,"ids[]":a}})};return a.getPackaged(e+d,c,g)}function d(c){return a.save(e+"lg",c),b({url:"/api/v1/organisations/"+c._id,method:"PUT",data:c})}this.getOrganisation=c,this.updateOrganisation=d;var e="organisation"}]).service("OrganisationModalService",["$mdDialog",function(a){this.organisationNewModal=function(b,c){return a.show({templateUrl:"app/modules/organisation/tpls/organisation-new-modal.html",controller:"OrganisationNewModalCtrl",clickOutsideToClose:!0,targetEvent:b,locals:{data:c}})}}]).controller("OrganisationNewModalCtrl",["data","$scope","$mdDialog","SearchService","EntityService","CoreLibrary",function(a,b,c,d,e,f){b.data=angular.copy(a),b.checkOrganisationExists=function(a){a&&(b.stub=f.stubify(a),d.search({type:"organisation",key:"stub",value:b.stub,match:"insensitive"}).then(function(a){0===a.data.length?b.NewOrganisationForm.name.$setValidity("exists",!0):b.NewOrganisationForm.name.$setValidity("exists",!1)}))},b.cancel=function(){c.cancel()},b.save=function(){e.create("organisation",b.data).then(function(a){e.updateSuccess(),c.hide(a)})}}]),angular.module("modules.page-loading-overlay",[]),angular.module("modules.page-loading-overlay").directive("pageLoadingOverlay",["$timeout",function(a){return{restrict:"E",link:function(b,c,d){angular.element(document).ready(function(){a(function(){c.addClass("animate")},100),a(function(){c.addClass("ng-hide")},300)})}}}]),angular.module("modules.posts",[]),angular.module("modules.posts").service("PostService",["LocalCache","$http",function(a,b){function c(c,e){var f;"sm"==e?f=["stub","name","type","blurb"]:(f=["*"],e="lg");var g=function(a){return b({url:"/api/v1/posts",method:"GET",params:{"select[]":f,"ids[]":a}})};return a.getPackaged(d+e,c,g)}this.get=c;var d="post"}]).service("CommentService",["LocalCache","$http",function(a,b){function c(c,e){var f;"sm"==e?f=["stub","name","type","blurb"]:(f=["*"],e="lg");var g=function(a){return b({url:"/api/v1/comments",method:"GET",params:{"select[]":f,"ids[]":a}})};return a.getPackaged(d+e,c,g)}this.get=c;var d="comment"}]),angular.module("modules.projects",[]),angular.module("modules.projects").service("ProjectService",["$http","LocalCache",function(a,b){function c(c,e){var f;"sm"==e?f=["stub","name","type","blurb","picture"]:(f=["*"],e="lg");var g=function(b){return a({url:"/api/v1/"+d,method:"GET",params:{"select[]":f,"ids[]":b}})};return b.getPackaged(d+e,c,g)}this.getProject=c;var d="projects"}]),angular.module("modules.reminders",[]),angular.module("modules.reminders").service("ReminderService",["$mdDialog",function(a){function b(b){a.show({templateUrl:"app/modules/reminders/tpls/new-reminder-modal.html",controller:["$scope","EntityService",function(b,c){b.reminder={reminderDate:Date.now(),user:"56448bd3e2bcb34ab7afb073",notes:"test"},b.cancel=function(){a.cancel()},b.confirm=function(){c.create("reminder",b.reminder).then(function(){c.updateSuccess(),a.hide()})}}],targetEvent:b,clickOutsideToClose:!0})}this.newReminderModal=b}]).directive("reminderStatus",function(){return{restrict:"E",scope:{entity:"=",selectedRows:"=?",entities:"=?",ratingType:"@?"},template:'\n        <md-checkbox ng-model="entity.complete" aria-label="Complete" style="margin: 0" ng-change="save()"></md-checkbox>\n        ',controller:["$scope","LogService","$http","CoreLibrary","EntityService",function(a,b,c,d,e){a.save=function(){console.log("save"),a.selectedRows&&a.selectedRows.length>1?_.forEach(a.entities,function(b){-1!=a.selectedRows.indexOf(b._id)&&e.patch("reminder",{complete:a.entity.complete}).then(e.updateSuccess)}):e.patch("reminder",a.entity).then(e.updateSuccess)}}]}}).directive("reminderRowActions",function(){return{restrict:"E",scope:{entity:"=",query:"="},template:'\n             <div layout="row">\n                <md-button aria-label="edit" class="md-icon-button md-sm" ng-click="edit($event, entity)">\n                    <ng-md-icon icon="edit"></ng-md-icon>\n                </md-button>\n                <md-button aria-label="delete" class="md-icon-button md-sm" ng-click="remove(entity._id)">\n                    <ng-md-icon icon="close"></ng-md-icon>\n                </md-button>\n            </div>\n        ',controller:["$scope","HttpService","$mdDialog","$mdToast","EntityService",function(a,b,c,d,e){function f(b){confirm("Are you sure you want to delete this?")&&e.remove("reminder",b).then(function(b){e.removeSuccess(),a.query.refresh()})}function g(b,d){c.show({templateUrl:"app/views/campaigns/tpls/new-campaign-modal.html",controller:["data","$scope",function(a,b){b.campaign=a,b.modalTitle="Edit Campaign - Ref: "+a.ref.ref,b.confirmTitle="Save Campaign",b.cancel=function(){c.cancel()},b.confirm=function(){e.update("campaign",b.campaign).then(function(){e.updateSuccess(),c.hide()})}}],locals:{data:d},targetEvent:b,clickOutsideToClose:!0}).then(function(){a.query.refresh()})}a.remove=f,a.edit=g}]}}),angular.module("modules.restangular",["restangular"]),angular.module("modules.restangular").run(["Restangular","$mdToast","Authentication",function(a,b,c){a.setErrorInterceptor(function(a,d,e){if(401===a.status)"/api/v1/notifications"===a.config.url?c.currentUser.logout():b.show(b.simple().content("Unauthorized... "+a.data.error||"You're not authorized to do that!").theme("warn")),b.show(b.simple().content("Unauthorized... "+a.data.error||"You're not authorized to do that!").theme("warn"));else if(404===a.status)b.show(b.simple().content("Not found... "+a.data.error||"You know that thing you tried to access? We couldn't find it...").theme("warn"));else if(480===a.status)b.show(b.simple().content("Error... "+a.data.error).theme("warn"));else{if(422!==a.status)return!1;b.show(b.simple().content("Oops... "+a.data.error).theme("warn"))}})}]).config(["RestangularProvider",function(a){
a.setBaseUrl("/api/v1"),a.setRestangularFields({id:"_id"}),a.addResponseInterceptor(function(a,b,c,d,e,f){return"false"===a?a=!1:"true"===a?a=!0:"null"===a&&(a=null),a})}]),angular.module("modules.search-wiki",[]),angular.module("modules.search-wiki").directive("clickSearchWiki",["$http","$mdToast",function(a,b){return{restrict:"A",scope:{name:"@",model:"=?"},link:function(c,d,e){d.bind("click",function(d){a.jsonp("http://en.wikipedia.org/w/api.php",{params:{action:"opensearch",search:c.name,limit:1,namespace:0,format:"json",callback:"JSON_CALLBACK"}}).then(function(a){a.data[2][0].length>5?(c.model=a.data[2][0],b.show(b.simple().content("Results for: "+a.data[1]))):b.show(b.simple().content("No Results for: "+c.name).theme("warn"))})})}}}]),angular.module("modules.search.organisation",[]),angular.module("modules.search.organisation").directive("organisationSearch",function(){return{restrict:"E",replace:!0,scope:{data:"=",single:"=?",noArray:"=?",placeholder:"@?",searchText:"=?",focus:"=?",organisationType:"@?"},templateUrl:"app/modules/search/organisation-search/tpls/organisation-search.html",controller:["$scope","$http","OrganisationModalService",function(a,b,c){a.data=a.data||[],a.noArray&&a.data&&a.data.name?a.searchText=a.data.name:a.single&&a.data[0]&&a.data[0].name&&(a.searchText=a.data[0].name,a.linked=!0),a.search=function(c){return b({url:"/api/v1/search",params:{type:"organisation",key:"name",value:c,match:"regex"}}).then(function(b){var d=b.data.filter(function(b){return!_.any(a.existing,{_id:b._id})});return d.push({addNew:!0,name:(0===d.length?"Organisation not found. Create ":"None of these? Create ")+c,searchText:c}),d})},a.processResult=function(b){b&&(b.addNew?(a.create(null,b.searchText),a.searchText=""):a.noArray?a.data=b:a.single?(a.data[0]=b,a.searchText=b.name,a.linked=!0):(a.data.push(b),a.data=_.uniq(a.data,"_id"),a.searchText=""))},a.create=function(b,d){var e={name:d,organisationType:a.organisationType};c.organisationNewModal(b,e).then(function(b){a.processResult(b)})}}]}}),angular.module("modules.search",["modules.search.organisation"]),angular.module("modules.search").directive("checkboxFilter",function(){return{restrict:"E",scope:{filter:"=",showCount:"="},templateUrl:"app/modules/search/tpls/checkbox-filter.html"}}).directive("searchFilter",function(){return{restrict:"E",scope:{filter:"="},templateUrl:"app/modules/search/tpls/search-filter.html"}}).service("SearchService",["$http","$stateParams","$timeout",function(a,b,c){this.newFilter=function(a){var b={searchTimeout:"",searchTimeoutTime:a.searchTimeoutTime||300,query:a.query,title:a.title,type:a.type,model:a.model,key:a.key,current:a.current,options:a.options,onChange:function(){if("search"==a.type)"string"==typeof a.query.params.criteria&&(a.query.params.criteria=JSON.parse(a.query.params.criteria)),_.forEach(this.options,function(b){delete a.query.params.criteria[b.model]}),a.query.params.criteria[this.key]=this.model?"/"+this.model+"/i":"";else{this.current=_.map(_.filter(this.options,"status"),"model");var b=this.model.split(".");if("criteria"==b[0]&&b.length>1){var d=this.model.replace("criteria.","");a.query.params.criteria[d]=this.current}else a.query.params[b[0]]=this.current}c.cancel(this.searchTimeout),this.searchTimeout=c(function(){a.query.updateQueryParams(),a.query.refresh()},this.searchTimeoutTime)},parseParams:function(a){var b=Object.keys(a),c=_.find(this.options,function(a){return-1!=b.indexOf(a.model)});c&&(this.key=c.model,this.model=a[this.key])}};return b},this.assignChecklistModel=function(a,b){a.current=b,_.forEach(a.options,function(a){a.status=b.indexOf(a.model)>-1})},this.assignSortModel=function(a){b.sort&&(a.model=b.sort),a.order=b.order?"asc"==b.order:"asc"},this.search=function(b){return a({url:"/api/v1/search",method:"GET",params:{type:b.type,"types[]":b.types,key:b.key,value:b.value,match:b.match||"regex",order:b.order,sort:b.sort,size:b.size,page:b.page,"select[]":b.select,location:b.location,populate:b.populate,published:b.published}})}}]),angular.module("modules.states",[]),angular.module("modules.states").service("StatesService",["$q",function(a){this.get=function(b){var c={name:b,type:"state",stub:b};return a.when(c)}}]).directive("nestedView",["CoreService","RecursionHelper","$http",function(a,b,c){return{restrict:"E",templateUrl:"app/modules/states/nested-view.html",scope:{data:"=",evaluate:"=",groupByParams:"="},compile:function(a){return b.compile(a)},controller:["$scope",function(a){function b(){var b=20;a.data.showChildren=!a.data.showChildren,c({url:"/api/v1/analytics/nextAppState",method:"GET",params:{state:a.data.name,size:a.page*b,groupByParams:a.groupByParams}}).then(function(b){_.forEach(b.data.children,function(a){a.percentage=(a.number/b.data.total*100).toFixed(2)}),a.page++,_.extend(a.data,b.data)})}a.toggleShowChildren=b,a.page=1,a.evaluate&&a.toggleShowChildren()}]}}]).factory("RecursionHelper",["$compile",function(a){return{compile:function(b,c){angular.isFunction(c)&&(c={post:c});var d,e=b.contents().remove();return{pre:c&&c.pre?c.pre:null,post:function(b,f){d||(d=a(e)),d(b,function(a){f.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]),angular.module("modules.tables",[]),angular.module("modules.tables").directive("filterColumnOrder",["$parse","$stateParams",function(a,b){return{restrict:"A",scope:{filterObject:"=",filterModel:"@",filterReverse:"=?",filterQuery:"=?",filterEnabled:"@?"},link:function(a,b,c){"false"!=a.filterEnabled&&(b.addClass("filter-column-order"),b.bind("click",function(b){a.filterObject.model==a.filterModel&&a.filterReverse?a.filterObject.reverse=!a.filterObject.reverse:(a.filterObject.model=a.filterModel,a.filterObject.reverse=!1),a.filterObject.onChange&&a.filterObject.onChange({model:a.filterObject.model,reverse:a.filterObject.reverse});var c=a.filterObject.query||a.filterQuery;c&&(c.params.sort=a.filterObject.model,c.params.order=a.filterObject.reverse?"asc":"dsc",c.updateQueryParams(),c.refresh()),a.$apply()}),a.$watch("filterObject",function(){a.filterObject.model==a.filterModel?a.filterObject.reverse===!0?(b.addClass("up"),b.removeClass("down")):a.filterObject.reverse===!1&&(b.addClass("down"),b.removeClass("up")):(b.removeClass("down"),b.removeClass("up"))},!0))}}}]).directive("modularTable",["$mdDialog",function(a){return{restrict:"E",scope:{columns:"=",query:"=",select:"=?",selectedRows:"=?",scrollLoad:"=?"},templateUrl:"app/modules/tables/tpls/modular-table.html",link:function(a,b,c){a.select&&(a._selectedRows={},"select-checkbox"!=a.query.columns[0].model&&a.query.columns.unshift({status:!0,sort:!1,model:"select-checkbox",width:"20px",headerTemplate:'<md-checkbox ng-model="selectedAllRowsModel" ng-change="selectedAllRows(selectedAllRowsModel)" aria-label="Select" style="margin: 0"></md-checkbox>',template:'\n                            <md-checkbox ng-model="_selectedRows[item._id]" aria-label="Select" style="margin: 0"></md-checkbox>\n                        '}),a.$watch("_selectedRows",function(){a.selectedRows=[],_.forEach(a._selectedRows,function(b,c){b&&a.selectedRows.push(c)})},!0),a.selectedAllRows=function(b){_.forEach(a.query.results,function(c){a._selectedRows[c._id]=b})})}}}]).directive("selectedRowsOverlay",["$mdDialog",function(a){return{restrict:"E",scope:{selectedRowsObject:"=",selectedRowsArray:"="},templateUrl:"app/modules/tables/tpls/selected-rows-overlay.html",controller:["$scope",function(a){a.deselect=function(){console.log(a.selectedRowsObject),_.forEach(Object.keys(a.selectedRowsObject),function(b){a.selectedRowsObject[b]=!1})}}]}}]).directive("setAttrs",["$parse",function(a){return{restrict:"A",link:function(b,c,d){var e=a(d.setAttrs)(b);e&&c[0].setAttribute(e,"")}}}]).directive("displayTableColumnSelect",["$mdDialog",function(a){return{restrict:"A",scope:{columns:"="},link:function(b,c,d){function e(b,c){a.show({templateUrl:"app/modules/tables/tpls/table-column-select-modal.html",controller:["data","$scope",function(b,c){c.data=b,c.cancel=function(){a.cancel()}}],targetEvent:b,clickOutsideToClose:!0,locals:{data:c}})}c.bind("click",function(a){e(a,b.columns)})}}}]),angular.module("modules.tabs",[]),angular.module("modules.tabs").directive("tabs",["$timeout",function(a){return{restrict:"E",transclude:!0,template:'<div flex layout="row" class="tabs-inner" ng-transclude></div>',link:function(b,c,d){function e(){f[0].scrollLeft+f[0].offsetWidth+g>f[0].scrollWidth?c.addClass("isEnded"):c.removeClass("isEnded")}var f=angular.element(c.children()[0]),g=10;a(e,1),f.bind("scroll",e)}}}]),angular.module("modules.threads",[]),angular.module("modules.threads").service("ThreadService",["LocalCache","$http",function(a,b){function c(c,e){var f;"sm"==e?f=["stub","name","type","blurb","picture"]:(f=["*"],e="lg");var g=function(a){return b({url:"/api/v1/"+d,method:"GET",params:{"select[]":f,"ids[]":a}})};return a.getPackaged(d+e,c,g)}this.getThread=c;var d="threads"}]),angular.module("modules.timeline",[]),angular.module("modules.timeline").directive("timeline",["$rootScope",function(a){return{restrict:"E",scope:{user:"@"},templateUrl:"app/modules/timeline/tpls/timeline.html",controller:["$scope","$http",function(a,b){b({method:"GET",url:"api/v1/analytics/signupActionHistory",params:{user:a.user}}).then(function(b){var c=b.data[0],d=new Date(c.start).getTime(),e=new Date(c.end).getTime(),f=e-d;a.items=_.map(c.entities,function(a){var b=new Date(a.created).getTime();return{_id:a._id,created:a.created,entityType:a.entityType,xPosition:(b-d)/f*100}})})}]}}]),angular.module("modules.toggle-menu",[]),angular.module("modules.toggle-menu").directive("toggleMenu",["$timeout","$state",function(a,b){return{scope:{section:"="},templateUrl:"app/modules/toggle-menu/toggle-menu.html",controller:["$scope","$rootScope",function(a,c){function d(){var c=_.find(a.section.pages,"sref",b.current.name);a.section.isActive=!!c,a.section.isOpen=!!c}a.toggle=function(){a.section.isOpen=!a.section.isOpen},d(),c.$on("$stateChangeSuccess",d)}]}}]),angular.module("modules.transition-overlay",[]),angular.module("modules.transition-overlay").directive("transitionOverlay",["$rootScope",function(a){return{restrict:"E",scope:{},replace:!0,template:'<div class="transition-overlay" ng-show="showOverlay"></div>',controller:["$scope","$rootScope",function(a,b){b.$on("$stateChangeStart",function(){a.showOverlay=!0}),b.$on("$stateChangeSuccess",function(){a.showOverlay=!1}),b.$on("$stateChangeError",function(){a.showOverlay=!1})}]}}]),angular.module("modules.users",["modules.compile"]),angular.module("modules.users").directive("userRow",function(){return{restrict:"E",replace:!0,transclude:!0,scope:{entityId:"@?",text:"@?"},templateUrl:"app/modules/users/tpls/user-row.html",controller:["$scope","Authentication","EntityService",function(a,b,c){c.get("user",a.entityId).then(function(b){a.user=b})}]}}).directive("userCrm",function(){return{restrict:"E",scope:{entity:"=?",data:"=",saveFn:"&"},templateUrl:"app/modules/users/tpls/user-crm.html",controller:["$scope","$mdDialog","EmailService","$mdToast","Authentication",function(a,b,c,d,e){function f(b){a.data.splice(b,1),a.saveFn()}function g(b){a.data.push({date:Date.now(),contactedBy:e.userData.name}),i(b,a.data[a.data.length-1])}function h(b){var f;c.composeEmail(b,{recipient:a.entity}).then(function(b){f=b,c.sendEmail(b).then(function(){d.show(d.simple().content("Email successfully sent")),a.data.push({date:Date.now(),contactedBy:e.userData.name,notes:"Email Sent: "+f.message.type}),a.saveFn()})})}function i(c,d){b.show({templateUrl:"app/modules/users/tpls/user-crm-modal.html",controller:["$scope",function(a){a.item=d,a.item.date=new Date(a.item.date),a.cancel=function(){b.cancel()},a.save=function(){b.hide()}}],targetEvent:c,clickOutsideToClose:!0}).then(function(){a.saveFn()})}a.data=a.data||[],a.data[0]&&a.data[0].date&&(a.data[0].date=new Date(a.data[0].date)),a.remove=f,a.newItem=g,a.edit=i,a.sendEmail=h}]}}).directive("displayUsersModal",["$mdDialog","UserModalService",function(a,b){return{restrict:"A",scope:{displayUsersModal:"="},link:function(a,c,d){c.bind("click",function(c){a.displayUsersModal.length>0&&b.showUserModal(c,a.displayUsersModal)})}}}]).directive("displayUserLogModal",["$mdDialog",function(a){return{restrict:"A",scope:{displayUserLogModal:"="},link:function(b,c,d){function e(c,d){a.show({templateUrl:"app/modules/users/tpls/user-log-modal.html",controller:["data","$scope","LogService",function(c,d,e){function f(){b.noMoreResults||(d.loading=!0,e.getLogs({fields:{requestUser:c,event:{$nin:["get-notifications","feed-all","search"]}},exists:{event:!0},select:"parentType parentId entityType entityId event requestUser",page:g,size:10}).then(function(a){0===a.length&&(b.noMoreResults=!0),d.logs=d.logs.concat(a),d.loading=!1,g++}))}var g=1;d.logs=[],d.getLogs=f,d.getLogs(),d.cancel=a.cancel}],targetEvent:c,clickOutsideToClose:!0,locals:{data:d}})}c.bind("click",function(a){e(a,b.displayUserLogModal)})}}}]).service("UserModalService",["$mdDialog",function(a){function b(b,c){a.show({templateUrl:"app/modules/users/tpls/users-modal.html",controller:["data","$scope",function(b,c){console.log(b),c.users=b,c.cancel=function(){a.cancel()}}],targetEvent:b,clickOutsideToClose:!0,locals:{data:c}})}this.showUserModal=b}]),angular.module("views.app").controller("AppViewCtrl",["userdata","$scope","Authentication","$mdSidenav","$state",function(a,b,c,d,e){b.Authentication=c,b.menu=[{name:"Analytics",pages:[{name:"Dashboard",sref:"app.usage"},{name:"Growth Accounting",sref:"app.growth"},{name:"Most Popular",sref:"app.popular"}]},{name:"Entities",pages:[{name:"Users",sref:"app.users"},{name:"Fields",sref:"app.fields"},{name:"Organisations",sref:"app.organisations"},{name:"Projects",sref:"app.projects"},{name:"Threads",sref:"app.threads"},{name:"Jobs",sref:"app.jobs"}]},{name:"Job Manager",pages:[{name:"Applications",sref:"app.job-manager.applications"},{name:"Applicants",sref:"app.job-manager.applicants"},{name:"Companies",sref:"app.job-manager.organisations"}]},{name:"CRM",pages:[{name:"Emails",sref:"app.emails"},{name:"CRM",sref:"app.crm"},{name:"Reminders",sref:"app.reminders"}]},{name:"Referrals",pages:[{name:"Referrals",sref:"app.referrals"}]},{name:"Channel Tools",pages:[{name:"Github",sref:"app.github"}]}],b.menuIcon="menu",b.toggleSidenav=function(){d("left").open()},b.$watch(function(){b.menuIcon=d("left").isOpen()?"close":"menu"}),b.$state=e}]),angular.module("views.campaigns",["modules.search"]),angular.module("views.campaigns").config(["$stateProvider",function(a){a.state("app.campaigns",{url:"/campaigns?criteria&sort&order",templateUrl:"app/views/campaigns/campaigns.html",controller:"CampaignsViewCtrl"})}]).controller("CampaignsViewCtrl",["$scope","$http","$stateParams","SearchService","HttpService","$mdDialog","$mdToast","EntityService","HttpQuery","CoreModalService","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){function l(a,b){confirm("Are you sure you want to delete these?")&&(_.forEach(a,function(a){h.remove("campaign",a)}),_.forEachRight(b,function(c,d){-1!==a.indexOf(c._id)&&b.splice(d,1)}))}function m(b,c){f.show({templateUrl:"app/views/campaigns/tpls/new-campaign-modal.html",controller:["$scope",function(a){a.campaign={},a.modalTitle="Clone Overwrites",a.confirmTitle="Clone",a.cancel=function(){f.cancel()},a.confirm=function(){f.hide(a.campaign)}}],targetEvent:null,clickOutsideToClose:!0}).then(function(d){var e;_.forEach(b,function(b){var f=_.clone(_.find(c,"_id",b));f=_.extend(f,d),delete f.ref,delete f.timestamp,delete f.date,h.create("campaign",f).then(function(){k.cancel(e),e=k(function(){h.updateSuccess(),a.campaignQuery.refresh()},500)})})})}function n(b,c){f.show({templateUrl:"app/views/campaigns/tpls/new-campaign-modal.html",controller:["$scope",function(a){a.campaign={},a.modalTitle="Multi Edit Overwrites",a.confirmTitle="Save",a.cancel=function(){f.cancel()},a.confirm=function(){f.hide(a.campaign)}}],targetEvent:null,clickOutsideToClose:!0}).then(function(d){var e;_.forEach(b,function(b){var f=_.clone(_.find(c,"_id",b));f=_.extend(f,d),h.update("campaign",f).then(function(){k.cancel(e),e=k(function(){h.updateSuccess(),a.campaignQuery.refresh()},500)})})})}function o(b){f.show({templateUrl:"app/views/campaigns/tpls/new-campaign-modal.html",controller:["$scope",function(a){a.modalTitle="New Campaign",a.confirmTitle="Create Campaign",a.campaign={channel:"",page:"",url:"",content:"",date:Date.now(),edited:!1},a.cancel=function(){f.cancel()},a.confirm=function(){h.create("campaign",a.campaign).then(function(){h.updateSuccess(),f.hide()})}}],targetEvent:b,clickOutsideToClose:!0}).then(function(){a.campaignQuery.refresh()})}a.campaignQuery=i({url:"/api/v1/search",params:{type:"campaign",size:20,sort:"date",order:"dsc","select[]":["*","owner"],populate:!1},onSuccess:function(a){return _.forEach(a,function(a){a.ref.signups=_.map(a.ref.signups,function(a){return{type:"user",id:a.user}})}),a},columns:[{status:!0,sort:!1,name:"User",model:"owner",width:"40px",template:'\n                    <core-entity-picture entity-type="user" entity-id="{{item.owner}}"></core-entity-picture>\n                '},{status:!0,name:"Date",model:"date",width:"80px","class":"hide-xs",template:"\n                    <span ng-class=\"{'bold':item.edited}\">\n                        {{item.date | amDateFormat:'DD/MM/YYYY'}}\n                    </span>\n                "},{status:!0,name:"Ref Code",model:"ref.ref","class":"hide show-gt-md",width:"80px",template:"\n                    {{item.ref.ref}}\n                "},{status:!0,name:"Channel",model:"channel","class":"hide-xs",width:"120px"},{status:!0,name:"Page",model:"page",width:"200px",template:"\n                    {{item.page | words : 6}}\n                "},{status:!0,name:"Content",model:"content","class":"hide show-gt-lg",template:"\n                    {{item.content | words : 10}}\n                "},{status:!0,name:"Url",model:"url",width:"200px","class":"hide show-gt-lg",template:'\n                    <a ng-href="{{item.url}}" target="_blank">\n                        {{item.url | stripHttp | letters: 15}}\n                    </a>\n                '},{status:!0,name:"Clicks",model:"numHits",width:"100px",template:"\n                    {{item.ref.numHits || '0'}}\n                "},{status:!0,name:"Signups",model:"numSignups",width:"100px",template:"\n                    <a click-show-entities=\"item.ref.signups\">{{item.ref.signups.length || '0'}}</a>\n                "},{status:!0,name:"Actions",model:"temp",width:"80px",template:'<entity-row-actions entity="item" query="query"></entity-row-actions>'}],filters:{columnOrder:{}}}),a.typeFilter=d.newFilter({title:"Campaign Type",model:"criteria.channel",options:[{model:"/linkedin/i",name:"LinkedIn"},{model:"/email/i",name:"Email"},{model:"Twitter",name:"Twitter"},{model:"/facebook/i",name:"Facebook"},{model:"Private Message",name:"Private Message"},{model:"Reddit",name:"Reddit"},{model:"University Job Board",name:"University Job Board"},{model:"Facebook Ad",name:"Facebook Ad"}],query:a.campaignQuery}),a.ownerFilter=d.newFilter({title:"User Type",model:"criteria.owner",options:[{model:"5498e258a7fbbfcc12c3fa15",name:"Jackson"},{model:"55c0cb75dca1a7e5444c13f7",name:"Denzil"},{model:"5496bdb8104ad2c800020602",name:"Jack"},{model:"547db55af7f342380174e228",name:"David"},{model:"565f9406ca3491aff9b9ad4a",name:"Anthony Tan"},{model:"55e92c8142be6dba0b4c05e9",name:"Toy"},{model:"56cfd32276dbc2072fc17a09",name:"Email Templater"},{model:"56e14e058c106e6711b76ed7",name:"Upwork"}],query:a.campaignQuery}),a.campaignQuery.more(),a.newCampaignModal=o,a.multiDelete=l,a.multiClone=m,a.multiEdit=n,a.searchFilter=d.newFilter({type:"search",query:a.campaignQuery,key:"ref",options:[{model:"ref",name:"Ref"},{model:"page",name:"Page"},{model:"content",name:"Content"},{model:"Channel",name:"Channel"}]})}]).directive("entityRowActions",function(){return{restrict:"E",scope:{entity:"=",query:"="},template:'\n             <div layout="row">\n                <md-button aria-label="edit" class="md-icon-button md-sm" ng-click="edit($event, entity)">\n                    <ng-md-icon icon="edit"></ng-md-icon>\n                </md-button>\n                <md-button aria-label="clone" class="md-icon-button md-sm" ng-click="clone($event, entity)">\n                    <ng-md-icon icon="content_copy"></ng-md-icon>\n                </md-button>\n                <md-button aria-label="delete" class="md-icon-button md-sm" ng-click="remove(entity._id)">\n                    <ng-md-icon icon="close"></ng-md-icon>\n                </md-button>\n            </div>\n        ',controller:["$scope","HttpService","$mdDialog","$mdToast","EntityService",function(a,b,c,d,e){function f(b){confirm("Are you sure you want to delete this?")&&e.remove("campaign",b).then(function(b){e.removeSuccess(),a.query.refresh()})}function g(b,d){c.show({templateUrl:"app/views/campaigns/tpls/new-campaign-modal.html",controller:["data","$scope",function(a,b){b.campaign=a,b.modalTitle="Edit Campaign - Ref: "+a.ref.ref,b.confirmTitle="Save Campaign",b.cancel=function(){c.cancel()},b.confirm=function(){e.update("campaign",b.campaign).then(function(){e.updateSuccess(),c.hide()})}}],locals:{data:d},targetEvent:b,clickOutsideToClose:!0}).then(function(){a.query.refresh()})}function h(b,d){c.show({templateUrl:"app/views/campaigns/tpls/new-campaign-modal.html",controller:["data","$scope",function(a,b){b.campaign=angular.copy(a),delete b.campaign.ref,delete b.campaign.timestamp,delete b.campaign.date,console.log(b.campaign),b.modalTitle="Clone Campaign",b.confirmTitle="Create Campaign",b.cancel=function(){c.cancel()},b.confirm=function(){e.create("campaign",b.campaign).then(function(){e.updateSuccess(),c.hide()})}}],locals:{data:d},targetEvent:b,clickOutsideToClose:!0}).then(function(){a.query.refresh()})}a.remove=f,a.edit=g,a.clone=h}]}}),angular.module("views.crm",[]),angular.module("views.crm").config(["$stateProvider",function(a){a.state("app.crm",{url:"/crm?page&criteria",templateUrl:"app/views/crm/crm.html",controller:"CrmViewCtrl"})}]).controller("CrmViewCtrl",["$scope","$timeout","SearchService","HttpQuery","$http","$stateParams",function(a,b,c,d,e,f){a.usersQuery=d({url:"/api/v1/analytics/contactedButNotUpdated",params:{type:"user",sort:"signedup",size:30,select:["stub"],page:0},columns:[{status:!0,name:"",template:'<a ui-sref="app.users.user.info({\'stub\': item.stub})" class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',model:"picture",width:"40px",sort:!1},{status:!0,search:!0,name:"Name",template:'<a ui-sref="app.users.user.info({\'stub\': item.stub})" class="underlined">{{item.name}}</a>',model:"name"},{status:!0,name:"# Projects",model:"numProjects",width:"85px"},{status:!1,name:"# Threads",model:"numThreads",width:"85px"},{status:!1,name:"# Posts",model:"numPosts",width:"85px"},{status:!1,name:"# Comments",model:"numComments",width:"100px"},{status:!0,name:"# Applications",model:"numApplications",template:'<div click-show-applications parent-type="user" parent-id="{{item._id}}">{{item.numApplications}}</div>',width:"120px"},{status:!0,name:"Followers",model:"followers",width:"85px"},{status:!0,name:"Contacted By",template:"{{item.adminData.contacted[0].contactedBy}}",model:"adminData.contacted[0].contactedBy",width:"120px"},{status:!1,name:"Contacted Date",template:"{{item.adminData.contacted[0].date | amTimeAgo}}",model:"adminData.contacted[0].date",width:"85px"},{status:!0,name:"Signed up Date",template:"{{item.signedup | amTimeAgo}}",model:"signedup",width:"85px"},{status:!0,name:"Education",template:'<user-organisation-encode entity="item" type="education"></user-organisation-encode>',model:"profile.profileDetails",width:"300px"},{status:!1,name:"Experience",template:'<user-organisation-encode entity="item" type="experience"></user-organisation-encode>',model:"profile.profileDetails",width:"300px"},{status:!0,name:"Rating",model:"adminData.rating",width:"140px",template:"<user-rating entity='item' entities='query.results' selected-rows='selectedRows' rating-type='rating'></user-rating>"},{status:!0,name:"Potential Rating",model:"adminData.potentialRating",width:"140px",template:"<user-rating entity='item' entities='query.results' selected-rows='selectedRows' rating-type='potentialRating'></user-rating>"},{status:!0,name:"Email",model:"profile.email",width:"100px",template:"{{item.profile.email}}"}],filters:{columnOrder:{}}}),a.usersQuery.determineSelect(),a.usersQuery.init()}]),angular.module("views.emails",["modules.search"]),angular.module("views.emails").config(["$stateProvider",function(a){a.state("app.emails",{url:"/emails",templateUrl:"app/views/emails/emails.html",controller:["$scope","HttpQuery","CoreLibrary","SearchService","EmailTemplates",function(a,b,c,d,e){a.query=b({url:"api/v1/emails",params:{criteria:{},size:20},onSuccess:function(a){return _.forEach(a,function(a){a.created=c.getDateFromId(a._id)}),a},columns:[{status:!0,sort:!1,name:"Recipient",template:'<core-entity-picture entity-type="user" entity-id="{{item.recipient}}" entity="entity"></core-entity-picture>',width:"50px"},{status:!0,sort:!1,name:"Time",template:"{{item.created | amTimeAgo}}",width:"100px"},{status:!0,sort:!1,name:"Details",template:'<div>{{item.subject}}</div><div class="text-lightgrey">{{item.notificationType}}</div>'},{status:!0,sort:!1,name:"Actioner",template:'<core-entity-picture entity-type="user" entity-id="{{item.actioner}}" entity="entity"></core-entity-picture>',width:"50px"}],filters:{columnOrder:{}}}),a.query.more(),a.ownerFilter=d.newFilter({title:"Actioner",model:"criteria.actioner",options:[{model:"5498e258a7fbbfcc12c3fa15",name:"Jackson"},{model:"55c0cb75dca1a7e5444c13f7",name:"Denzil"},{model:"5496bdb8104ad2c800020602",name:"Jack"},{model:"547db55af7f342380174e228",name:"David"},{model:"565f9406ca3491aff9b9ad4a",name:"Anthony Tan"},{model:"55e92c8142be6dba0b4c05e9",name:"Toy"},{model:"56cfd32276dbc2072fc17a09",name:"Email Templater"},{model:"56e14e058c106e6711b76ed7",name:"Upwork"}],query:a.query}),a.typeFilter=d.newFilter({title:"Email Type",model:"criteria.notificationType",options:[],query:a.query});var f=["invite-to-stemn-by-email","mailchimp-member-is-following-you","new-thread-on-entity","new-follow","verify-email","beta-signup-receipt","beta-signup-receipt-social","mailchimp-member-commented-on-project","thread-new-post-on-thread","stemn-jobs-announcement","new-mention","add-to-organisation","mailchimp-member-invited-to-project","password-reset","password-reset-social"];a.typeFilter.options=a.typeFilter.options.concat(_.map(f,function(a){return{model:a,name:a}})),a.typeFilter.options=a.typeFilter.options.concat(_.map(e.get(),function(a){return{model:a.name,name:a.name}}))}]})}]),angular.module("views.error",[]),angular.module("views.error").config(["$stateProvider",function(a){a.state("error",{url:"/error",templateUrl:"app/views/error/error.html",controller:"ErrorViewCtrl"})}]).controller("ErrorViewCtrl",["$scope","$http",function(a,b){}]),angular.module("views.fields",["modules.image.search"]),angular.module("views.fields").config(["$stateProvider",function(a){a.state("app.fields",{url:"/fields",templateUrl:"app/views/fields/fields.html",controller:"FieldsViewCtrl"})}]).controller("FieldsViewCtrl",["$scope","HttpQuery","$mdDialog","$mdToast","FieldService","$http",function(a,b,c,d,e,f){a.query=b({url:"/api/v1/search",params:{type:"field",size:20,select:["stub","adminData","banner"],criteria:{}},columns:[{status:!0,name:"",template:'<a ui-sref="app.users.user.info({\'stub\': item.stub})" class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.banner.url || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',model:"picture",width:"40px",sort:!1},{status:!0,search:!0,name:"Name",template:'<a ui-sref="app.users.user.info({\'stub\': item.stub})" class="underlined">{{item.name}}</a>',model:"name"},{status:!0,name:"Blurb",template:"{{item.blurb | words: 15}}",model:"blurb"},{status:!0,name:"# Projects",model:"numProjects",width:"140px"},{status:!0,name:"# Threads",model:"numThreads",width:"140px"},{status:!0,name:"# Jobs",model:"numJobs",width:"140px"},{status:!0,name:"Actions",model:"temp",width:"100px",template:'<field-row-actions entity="item" query="query"></field-row-actions>'}],filters:{columnOrder:{}}}),a.searchFilter={model:"",key:"name",options:[{model:"name",name:"Name"},{model:"blurb",name:"Blurb"}],onChange:function(){a.query.params.criteria={},a.searchFilter.model&&(a.query.params.criteria[a.searchFilter.key]="/"+a.searchFilter.model+"/i"),a.query.refresh()}},a.query.determineSelect(),a.query.more()}]).directive("fieldRowActions",function(){return{restrict:"E",scope:{entity:"=",query:"="},template:'\n             <div layout="row">\n                <md-button aria-label="edit" class="md-icon-button" ng-click="edit($event, entity)">\n                    <ng-md-icon icon="edit"></ng-md-icon>\n                </md-button>\n                <md-button aria-label="delete" class="md-icon-button" ng-click="remove(entity._id)">\n                    <ng-md-icon icon="close"></ng-md-icon>\n                </md-button>\n            </div>\n        ',controller:["$scope","HttpService","$mdDialog","$mdToast","EntityService",function(a,b,c,d,e){function f(b){confirm("Are you sure you want to delete this?")&&e.remove("field",b).then(function(b){e.removeSuccess(),a.query.refresh()})}function g(a,b){c.show({templateUrl:"app/views/fields/tpls/edit-field-modal.html",controller:["data","$scope",function(a,b){b.item=a,b.itemName=b.item.name,b.blurbQuery=b.item.name,b.cancel=function(){c.cancel()},b.save=function(){e.update("field",b.item).then(function(){e.updateSuccess(),c.hide()})}}],locals:{data:b},targetEvent:a,clickOutsideToClose:!0})}a.remove=f,a.edit=g}]}}),angular.module("views.github",[]),angular.module("views.github").config(["$stateProvider",function(a){a.state("app.github",{url:"/github",templateUrl:"app/views/github/github.html",controller:"GithubViewCtrl"})}]).controller("GithubViewCtrl",["$scope","$http","$mdToast",function(a,b,c){function d(){a.projectQuery.loading=!0,b({method:"GET",url:"https://api.github.com/search/repositories",skipAuthorization:!0,params:{q:a.projectQuery.queryString,sort:"stars",order:"desc",page:a.projectQuery.page,per_page:100}}).then(function(b){a.projectQuery.loading=!1,a.projects=b.data.items})["catch"](h)}function e(){var c=40;b({method:"GET",url:"https://api.github.com/repos/"+a.repoEventsQuery.params.full_name+"/events",skipAuthorization:!0,params:{page:a.repoEventsQuery.params.page,per_page:c}}).then(function(b){a.repoEventsQuery.results=b.data,console.log(a.repoEventsQuery.results)})["catch"](h)}function f(a,c){var d=40;return c=c||1,b({method:"GET",url:"https://api.github.com/users/"+a+"/events/public",params:{page:c,per_page:d},skipAuthorization:!0}).then(function(b){var e=_.find(b.data,"type","PushEvent");return e||b.data.length!=d?e?(console.log(e),e.payload.commits[0].author.email):"Unknown - P"+c:(c++,f(a,c))})["catch"](h)}function g(){b({method:"GET",url:"https://api.github.com/search/code",skipAuthorization:!0,params:{q:"repo:"+a.fileQuery.repoName+" "+a.fileQuery.fileTypes,sort:"stars",order:"desc"}}).then(function(b){a.files=_.map(b.data.items,function(a){return{previewUrl:"http://embed.stemn.com/preview-github?path="+a.html_url.replace("/blob","").replace("github.com","raw.githubusercontent.com"),name:a.name}})})["catch"](h)}function h(a){a.data.message&&c.show(c.simple().content(a.data.message).theme("warn"))}a.projectQueryString="fork:true language:eagle language:kicad",a.getFiles=g,a.projectQuery={loading:!1,get:d,page:1,queryString:"fork:true language:eagle language:kicad"},a.fileQuery={loading:!1,get:g,repoName:"",fileTypes:"extension:kicad_pcb extension:pcb extension:brd"},a.repoEventsQuery={loading:!1,get:e,params:{
page:1,full_name:""}},a.getUserEmail=function(a){f(a.login).then(function(b){a.email=b})},a.projectQuery.get()}]),angular.module("views.growth-accounting",[]),angular.module("views.growth-accounting").config(["$stateProvider",function(a){a.state("app.growth",{url:"/growth",templateUrl:"app/views/growth-accounting/growth-accounting.html"})}]),angular.module("views.home",[]),angular.module("views.home").config(["$stateProvider",function(a){a.state("app.home",{url:"/home",templateUrl:"app/views/home/home.html",controller:"HomeViewCtrl"})}]).controller("HomeViewCtrl",["userdata","$scope","$http","CoreService","Restangular",function(a,b,c,d,e){function f(){var a={},c=new Date((new Date).getTime()),d=c-r.day,e=c-r.week,f=c-2*r.week,g=c-3*r.week;o({from:d,to:c}).then(function(b){a.signups1D=b}),o({from:e,to:c}).then(function(b){a.signups1W=b}),o({from:f,to:e}).then(function(b){a.signups2W=b}),o({from:g,to:f}).then(function(b){a.signups3W=b}),p({from:d,to:c}).then(function(b){a.activeUsers1D=b}),p({from:e,to:c}).then(function(b){a.activeUsers1W=b}),p({from:f,to:e}).then(function(b){a.activeUsers2W=b}),p({from:g,to:f}).then(function(b){a.activeUsers3W=b}),b.keyMetrics=a}function g(){return c({url:"/api/v1/logs",method:"GET",params:{fields:{event:{$in:q}}}}).success(function(a){s=m(a),console.log(s),_.forEach(s,function(a,b){_.forEach(a,function(a){a.date=new Date(a.date).getTime()})}),b.multiSeriesData=j(s,r.day)})}function h(a,c){var d={},e=[],f=0;_.forEach(s,function(b,g){c[g]&&(d[g]=n(b,a),e[f]={name:g,num:d[g].length},f++)}),b.timeRangeData=d,b.barData=e}function i(a){var b={};return _.forEach(a,function(a){b[a.name]=a.visible}),b}function j(a,b){var c=[],d=0;return _.forEach(a,function(a,e){c[d]={name:e,values:k(a,b),visible:!0},d++}),c}function k(a,b){var c=l(a,b),d=[];return _.forEach(a,function(a){var e=parseInt(Math.ceil((a.date-c)/b));d[e]?d[e].events.push(a):d[e]={date:Math.ceil(a.date/b)*b,events:[a]}}),_.forEach(d,function(a,e){a?a.number=a.events.length:d[e]={date:c+e*b,number:0}}),d}function l(a,b){return a[0].date>a[a.length-1].date?Math.ceil(a[a.length-1].date/b)*b:Math.ceil(a[0].date/b)*b}function m(a){var b={};return _.forEach(a,function(a){b[a.event]?b[a.event].push(a):b[a.event]=[a]}),b}function n(a,b){return _.filter(a,function(a){return a.date>=b[0]&&a.date<=b[1]})}function o(a){return e.all("analytics").all("signups").getList({from:a.from,to:a.to})}function p(a){return e.all("analytics").all("activeUsers").getList({from:a.from,to:a.to})}var q=["project-create","project-update","thread-create","thread-update","post-create","comment-create","user-update","user-follow","user-like","user-vote","auth-local-signup","auth-linkedin-signup","auth-facebook-signup"],r={week:6048e5,day:864e5,hour:36e5,min:6e4,sec:1e3};b.times=r,b.getKeyMetrics=f,b.getKeyMetrics();var s;b.getLogData=g,b.getLogData(),b.changeTimeCoarsness=function(a){b.multiSeriesData=j(s,a)},b.timeRangeChange=function(a){b.timeRange=a;var c=i(b.multiSeriesData);h(b.timeRange,c),b.$apply()},b.legendSelectChange=function(a){b.timeRange=a;var c=i(b.multiSeriesData);h(b.timeRange,c),b.$apply()}}]),angular.module("views.job-applications",["modules.jobs"]),angular.module("views.job-applications").config(["$stateProvider",function(a){a.state("app.job-manager",{url:"/job-applications",templateUrl:"app/views/job-applications/job-applications.html","abstract":!0,controller:["$scope",function(a){a.tabs=[{label:"Applications",sref:"app.job-manager.applications"},{label:"Applicants",sref:"app.job-manager.applicants"},{label:"Companies",sref:"app.job-manager.organisations"}]}]}).state("app.job-manager.applications",{url:"",sticky:!0,views:{applications:{templateUrl:"app/views/job-applications/job-applications.applications.html",controller:"JobManagerApplicationsCtrl"}}}).state("app.job-manager.applicants",{url:"/applicants",sticky:!0,views:{applicants:{templateUrl:"app/views/job-applications/job-applications.applicants.html",controller:"JobManagerApplicantsCtrl"}}}).state("app.job-manager.organisations",{url:"/organisations",sticky:!0,views:{organisations:{templateUrl:"app/views/job-applications/job-applications.organisations.html",controller:"JobManagerOrganisationsCtrl"}}})}]).controller("JobManagerApplicationsCtrl",["$scope","HttpQuery","CoreLibrary","SearchService","ApplicationStatusService",function(a,b,c,d,e){a.applicationsQuery=b({url:"/api/v1/search",params:{type:"application",size:20,sort:"_id",order:"dsc",criteria:{},"select[]":["*"]},columns:[{status:!0,template:'<a ui-sref="app.users.user.info({\'stub\': item.child.stub})" class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.child.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',model:"child.picture",width:"40px",sort:!1},{status:!0,search:!0,name:"Applicant",template:'<a ui-sref="app.users.user.info({\'stub\': item.child.stub})" class="underlined">{{item.child.name}}</a>',model:"child.name",width:"150px"},{status:!0,search:!0,name:"Position",template:'<a href="https://stemn.com/applications/{{item._id}}" class="underlined">{{item.parent.name}}</a>',model:"parent.name"},{status:!0,search:!0,name:"Company",template:'<a href="https://stemn.com/org/{{item.organisations[0].stub}}" class="underlined">{{item.organisations[0].name}}</a>',model:"item.organisations[0].name",width:"200px"},{status:!0,name:"Time",model:"_id",template:"{{item.timestamp | amTimeAgo}}",width:"140px"},{status:!0,name:"Status",model:"status",width:"140px",template:"<application-status entity='item' entities='query.results' selected-rows='selectedRows'></application-status>"}],filters:{columnOrder:{}},onSucess:function(a){return _.forEach(a,function(a){a.timestamp=c.getDateFromId(a._id)}),a}}),a.statusFilter=d.newFilter({title:"Application Status",model:"criteria.status.state",options:e.getStatuses(),query:a.applicationsQuery}),a.applicationsQuery.determineSelect(),a.applicationsQuery.more()}]).controller("JobManagerApplicantsCtrl",["$scope","HttpQuery","CoreLibrary","SearchService",function(a,b,c,d){a.applicantsQuery=b({url:"/api/v1/search",params:{type:"user",size:15,sort:"date",order:"dsc",select:["stub","adminData"],criteria:{numApplications:";>0"}},columns:[{status:!0,name:"",template:'<a ui-sref="app.users.user.info({\'stub\': item.stub})" class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',model:"picture",width:"40px",sort:!1},{status:!0,search:!0,name:"Name",template:'<a ui-sref="app.users.user.info({\'stub\': item.stub})" class="underlined">{{item.name}}</a>',model:"name"},{status:!0,name:"# Projects",model:"numProjects",width:"140px"},{status:!0,name:"# Applications",model:"numApplications",template:'<div click-show-applications parent-type="user" parent-id="{{item._id}}">{{item.numApplications}}</div>',width:"140px"},{status:!0,name:"Last Application",model:"lastApplication",template:"{{item.lastApplication | amTimeAgo}}",width:"140px"},{status:!0,name:"Contacted By",template:"{{item.adminData.contacted[0].contactedBy}}",model:"adminData.contacted[0]"},{status:!0,name:"Contacted Date",template:"{{item.adminData.contacted[0].date | amTimeAgo}}",model:"adminData.contacted[0].date"},{status:!0,name:"Rating",model:"adminData.rating",width:"140px",template:"<user-rating entity='item' entities='query.results' selected-rows='selectedRows' rating-type='rating'></user-rating>"},{status:!0,name:"Potential Rating",model:"adminData.potentialRating",width:"140px",template:"<user-rating entity='item' entities='query.results' selected-rows='selectedRows' rating-type='potentialRating'></user-rating>"},{status:!1,name:"Rating Inaccurate",model:"updated",width:"140px",template:"\n                    <span style='color: green' ng-show='item.adminData.ratingTime'>No</span>\n                    <span style='color: red' ng-hide='item.adminData.ratingTime'>Yes</span>\n                "}],filters:{columnOrder:{}}}),a.applicantsQuery.determineSelect(),a.applicantsQuery.more(),a.searchFilterApplicants=d.newFilter({type:"search",query:a.applicantsQuery,key:"name",options:[{model:"name",name:"Name"}]})}]).controller("JobManagerOrganisationsCtrl",["$scope","HttpQuery","CoreLibrary","SearchService",function(a,b,c,d){a.organisationsQuery=b({url:"/api/v1/search",params:{type:"organisation",size:15,sort:"date",order:"dsc",criteria:{numJobs:";>0",numApplications:";>0"},select:["stub"]},columns:[{status:!0,name:"",template:'<a ui-sref="app.organisation({\'stub\': item.stub})" class="avatar-square-contain block" style="background-image: url(\'https://stemn.com{{item.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',model:"picture",width:"40px",sort:!1},{status:!0,search:!0,name:"Name",template:'<a ui-sref="app.organisation({\'stub\': item.stub})" class="underlined">{{item.name}}</a>',model:"name"},{status:!0,name:"# Applications",model:"numApplications",width:"120px",template:'<a click-show-applications parent-type="organisation" parent-id="{{item._id}}">{{item.numApplications}}</a>'},{status:!0,name:"# Jobs",model:"numJobs",width:"60px"},{status:!0,name:"Contacted By",model:"adminData.contacted[0].contactedBy",template:"{{item.adminData.contacted[0].contactedBy}}"},{status:!1,name:"Contacted Date",template:"{{item.adminData.contacted[0].date | amTimeAgo}}",model:"item.adminData.contacted[0].date"},{status:!0,width:"60px",name:"Pending Review",model:"numPendingReview",template:'<div click-show-applications parent-type="organisation" parent-id="{{item._id}}" status="pendingReview">{{item.numPendingReview}}</div>'},{status:!0,width:"60px",name:"Under Review",model:"numUnderReview",template:'<div click-show-applications parent-type="organisation" parent-id="{{item._id}}" status="underReview">{{item.numUnderReview}}</div>'},{status:!0,width:"60px",name:"Awaiting Update",model:"numAwaitingUpdate",template:'<div click-show-applications parent-type="organisation" parent-id="{{item._id}}" status="awaitingUpdate">{{item.numAwaitingUpdate}}</div>'},{status:!0,width:"80px",name:"Ready to Submit",model:"numReadyToSubmit",template:'<div click-show-applications parent-type="organisation" parent-id="{{item._id}}" status="readyToSubmit">{{item.numReadyToSubmit}}</div>'},{status:!0,width:"60px",name:"Submitted",model:"numSubmittedToCompany",template:'<div click-show-applications parent-type="organisation" parent-id="{{item._id}}" status="submittedToCompany">{{item.numSubmittedToCompany}}</div>'},{status:!0,width:"60px",name:"Hired",model:"numHired",template:'<div click-show-applications parent-type="organisation" parent-id="{{item._id}}" status="hired">{{item.numHired}}</div>'},{status:!0,width:"60px",name:"Rejected",model:"numRejected",template:'<div click-show-applications parent-type="organisation" parent-id="{{item._id}}" status="rejected">{{item.numRejected}}</div>'}],filters:{columnOrder:{}}}),a.organisationsQuery.determineSelect(),a.organisationsQuery.more(),a.searchFilterOrganisations=d.newFilter({type:"search",query:a.organisationsQuery,key:"name",options:[{model:"name",name:"Name"}]})}]).directive("clickShowApplications",["CoreModalService","$http","HttpQuery",function(a,b,c){return{restrict:"A",scope:{parentType:"@",parentId:"@",status:"@"},link:function(b,c,d){c.bind("click",function(c){a.showApplications(c,{parentType:b.parentType,parentId:b.parentId,criteria:{"status.state":b.status},size:100})})}}}]).directive("applicationStatus",function(){return{restrict:"E",scope:{entity:"=",selectedRows:"=?",entities:"=?"},template:'\n        <div layout="row" layout-align="start center">\n            <md-input-container flex>\n                <md-select class="md-accent" ng-model="entity.status.state" ng-change="saveApplication()" placeholder="Application Status">\n                    <md-option ng-repeat="item in applicationStatuses" value="{{item.model}}">\n                        {{item.name}}\n                    </md-option>\n                </md-select>\n            </md-input-container>\n            <div style="margin-left: 5px;">\n                <md-checkbox ng-model="entity.status.notify" aria-label="Notify" style="margin-bottom: 0px;" ng-change="saveApplication()"></md-checkbox>\n                <md-tooltip>Notify</md-tooltip>\n            </div>\n        </div>\n        ',controller:["$scope","LogService","$http","CoreLibrary","EntityService","ApplicationStatusService",function(a,b,c,d,e,f){a.entity.status=a.entity.status||{},a.saveApplication=function(){a.selectedRows.length>1?_.forEach(a.entities,function(b){-1!=a.selectedRows.indexOf(b._id)&&(b.status.state=a.entity.status.state,b.status.notify=a.entity.status.notify,e.update("application",b).then(e.updateSuccess))}):e.update("application",a.entity).then(e.updateSuccess),a.applicationStatuses=f.getContrainedStatuses(a.entity.status.state)},a.applicationStatuses=f.getContrainedStatuses(a.entity.status.state)}]}}).service("ApplicationStatusService",function(){function a(a){var b=c.getStatuses(),d=b[a]||b.pendingReview;return _.map(d.nextSteps,function(a){return b[a]})}function b(){return{pendingReview:{model:"pendingReview",name:"Pending Review",nextSteps:["pendingReview","underReview","awaitingUpdate","readyToSubmit","archived","processLater"]},underReview:{model:"underReview",name:"Under Review",nextSteps:["underReview","awaitingUpdate","readyToSubmit","archived","processLater"]},awaitingUpdate:{model:"awaitingUpdate",name:"Awaiting Profile Update",nextSteps:["awaitingUpdate","pendingReview","archived"]},readyToSubmit:{model:"readyToSubmit",name:"Ready to Submit",nextSteps:["readyToSubmit","submittedToCompany","archived"]},submittedToCompany:{model:"submittedToCompany",name:"Submitted",nextSteps:["submittedToCompany","rejected","hired","archived"]},rejected:{model:"rejected",name:"Rejected",nextSteps:["rejected","archived"]},hired:{model:"hired",name:"Hired",nextSteps:["hired","archived"]},archived:{model:"archived",name:"Archived",nextSteps:["archived"]},processLater:{model:"processLater",name:"Process Later",nextSteps:["processLater","pendingReview"]}}}var c=this;this.getStatuses=b,this.getContrainedStatuses=a}).directive("userRating",function(){return{restrict:"E",scope:{entity:"=",selectedRows:"=?",entities:"=?",ratingType:"@?"},template:'\n        <md-input-container>\n            <md-select class="md-accent" ng-model="entity.adminData[ratingType]" ng-change="saveUser()" placeholder="Rating">\n                <md-option ng-repeat="item in ratings" value="{{item}}">\n                    {{item}}\n                </md-option>\n            </md-select>\n        </md-input-container>\n        ',controller:["$scope","LogService","$http","CoreLibrary","EntityService",function(a,b,c,d,e){a.ratingType=a.ratingType||"rating",a.saveUser=function(){a.selectedRows&&a.selectedRows.length>1?_.forEach(a.entities,function(b){-1!=a.selectedRows.indexOf(b._id)&&(b.adminData.ratingTime=Date.now(),b.adminData[a.ratingType]=a.entity.adminData[a.ratingType],e.patch("user",{_id:b._id,adminData:b.adminData}).then(e.updateSuccess))}):(a.entity.adminData.ratingTime=Date.now(),e.patch("user",{_id:a.entity._id,adminData:a.entity.adminData}).then(e.updateSuccess))},a.ratings=[0,1,2,3,4,5]}]}}),angular.module("views.jobs",["modules.jobs"]),angular.module("views.jobs").config(["$stateProvider",function(a){a.state("app.jobs",{url:"/jobs",templateUrl:"app/views/jobs/jobs.html",controller:"JobsViewCtrl"})}]).controller("JobsViewCtrl",["$scope","HttpQuery","CoreLibrary","$http","SearchService",function(a,b,c,d,e){a.query=b({url:"api/v1/search",params:{type:"job",select:["stub"],criteria:{},size:20},columns:[{status:!0,sort:!1,model:"picture",template:'<a class="avatar-square-contain block" style="background-image: url(\'https://stemn.com{{item.picture || \'/assets/images/default/org.png\'}}?size=thumb\')")"></a>',width:"50px"},{status:!0,sort:!0,name:"Organisation",model:"organisations[0].name",template:'<a target="_blank" ng-href="https://stemn.com/org/{{item.organisations[0].stub}}/jobs" class="underlined">{{item.organisations[0].name}}</a>',width:"200px"},{status:!0,sort:!0,name:"Name",model:"name",template:'<a target="_blank" ng-href="https://stemn.com/jobs/{{item.stub}}" class="underlined">{{item.name}}</a>'},{status:!0,sort:!0,name:"# Applications",model:"numApplications",width:"110px"},{status:!0,sort:!0,name:"# Fields",model:"numFields",width:"100px"},{status:!0,sort:!0,name:"Owner",model:"owners",template:'<core-entity-picture entity-type="user" entity-id="{{item.owners[0]}}" entity="entity"></core-entity-picture>',width:"50px"}],filters:{columnOrder:{}}}),a.query.determineSelect(),a.query.more()}]),angular.module("views.live",[]),angular.module("views.live").config(["$stateProvider",function(a){a.state("app.live",{url:"/live",templateUrl:"app/views/live/live.html",controller:"LiveViewCtrl"})}]).controller("LiveViewCtrl",["$scope","LogService","CoreService",function(a,b,c){function d(a){var b=[];return _.forEach(a,function(a){a.status&&b.push(a.name)}),b}function e(e){a.loading=!0,b.getLogs({fields:{event:{$in:d(a.filter.events)}},exists:{event:!0},select:"parentType parentId entityType entityId event requestUser timestamp",page:e,size:30}).then(function(b){1==e&&(a.logs=[]),b.length==f&&(a.loading=!1,a.page++),a.filter.noFakes.status&&(b=_.filter(b,function(a){return c.isFakeUser(a.requestUser)})),a.logs=a.logs.concat(b)})}a.getLogs=e,a.page=1,a.filter={events:[{name:"thread-create",status:!0},{name:"project-create",status:!0},{name:"organisation-create",status:!0},{name:"post-create",status:!0},{name:"comment-create",status:!0}],noFakes:{name:"Filter Fake Accounts",status:!0}},a.$watch("filter",function(){e(1)},!0);var f=30}]),angular.module("views.login",["modules.galaxy"]),angular.module("views.login").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/views/login/login.html",controller:"LoginViewCtrl",data:{pageTitle:"Login",viewClass:"login"}})}]).controller("LoginViewCtrl",["$scope","$auth",function(a,b){}]),angular.module("views.marketing",[]),angular.module("views.marketing").config(["$stateProvider",function(a){a.state("app.marketing",{url:"/marketing",templateUrl:"app/views/marketing/marketing.html",controller:"MarketingViewCtrl"})}]).controller("MarketingViewCtrl",["$scope","$filter","ngTableParams",function(a,b,c){var d=[{pic:"http://i.imgur.com/oe2nNu4.png",name:"Moroni",age:50},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Tiancum",age:43},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Jacob",age:27},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Nephi",age:29},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Enos",age:34},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Tiancum",age:43},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Jacob",age:27},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Nephi",age:29},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Enos",age:34},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Tiancum",age:43},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Jacob",age:27},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Nephi",age:29},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Enos",age:34},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Tiancum",age:43},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Jacob",age:27},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Nephi",age:29},{pic:"http://i.imgur.com/oe2nNu4.png",name:"Enos",age:34}];a.tableParams=new c({page:1,count:10,sorting:{name:"asc"}},{total:d.length,getData:function(a,c){var e=c.sorting()?b("orderBy")(d,c.orderBy()):d;a.resolve(e.slice((c.page()-1)*c.count(),c.page()*c.count()))}});var e=[{arg:10,y1:-12,y2:10,y3:32},{arg:20,y1:-32,y2:30,y3:12},{arg:40,y1:-20,y2:20,y3:30},{arg:50,y1:-39,y2:50,y3:19},{arg:60,y1:-10,y2:10,y3:15},{arg:75,y1:10,y2:10,y3:15},{arg:80,y1:30,y2:100,y3:130},{arg:90,y1:40,y2:110,y3:140},{arg:100,y1:50,y2:90,y3:90},{arg:105,y1:40,y2:145,y3:120},{arg:110,y1:-12,y2:10,y3:32},{arg:120,y1:-32,y2:30,y3:12},{arg:130,y1:-20,y2:20,y3:30}],f=[{argumentField:"arg",valueField:"y1"},{argumentField:"arg",valueField:"y2"},{argumentField:"arg",valueField:"y3"}];a.zoom={},a.zoom.start=1,a.zoom.end=130,a.zoomChart={dataSource:e,argumentAxis:{indentFromMin:.02,indentFromMax:.02},selectedRange:{startValue:a.zoom.start,endValue:a.zoom.end},legend:{visible:!1},series:f,adjustOnZoom:!0},a.range={size:{height:120},margin:{left:10},scale:{divisionValue:1,minRange:2},selectedRange:{startValue:a.zoom.start,endValue:a.zoom.end},dataSource:e,chart:{series:f},behavior:{callSelectedRangeChanged:"onMoving"},onSelectedRangeChanged:function(b){a.zoom.start=b.startValue,a.zoom.end=b.endValue}};var e=[{country:"USA",medals:110},{country:"China",medals:100},{country:"Russia",medals:72},{country:"Britain",medals:47},{country:"Australia",medals:46},{country:"Germany",medals:41},{country:"France",medals:40},{country:"South Korea",medals:31}];a.channelPie={dataSource:e,legend:{orientation:"horizontal",itemTextPosition:"right",horizontalAlignment:"right",verticalAlignment:"bottom",rowCount:2},series:[{argumentField:"country",valueField:"medals",label:{visible:!0,font:{size:16},connector:{visible:!0,width:.5},position:"columns",customizeText:function(a){return a.valueText+" ( "+a.percentText+")"}}}]};var e=[{state:"Facebook",year1998:423.721,year2001:476.851,year2004:528.904},{state:"Twitter",year1998:178.719,year2001:195.769,year2004:227.271},{state:"LinkedIn",year1998:308.845,year2001:335.793,year2004:372.576},{state:"Other",year1998:348.555,year2001:374.771,year2004:418.258}];a.channelConvChart={dataSource:e,commonSeriesSettings:{argumentField:"state",type:"bar",hoverMode:"allArgumentPoints",selectionMode:"allArgumentPoints",label:{visible:!0,format:"fixedPoint",precision:0}},series:[{valueField:"year2004",name:"Reach (/conv rate)"},{valueField:"year2001",name:"Ref Hits (/active user %)"},{valueField:"year1998",name:"Sign Ups"}],legend:{verticalAlignment:"bottom",horizontalAlignment:"center"},onPointClick:function(a){a.target.select()}}}]),angular.module("views.organisation",[]),angular.module("views.organisation").config(["$stateProvider",function(a){a.state("app.organisation",{url:"/org/:stub",templateUrl:"app/views/organisation/organisation.html",controller:"OrganisationViewCtrl",resolve:{entity:["EntityService","$stateParams",function(a,b){return a.get("organisation",b.stub,"lg")}]}})}]).controller("OrganisationViewCtrl",["entity","$scope","$stateParams","$http","CoreLibrary","EntityService","$mdToast","HttpQuery",function(a,b,c,d,e,f,g,h){function i(){f.update("organisation",b.entity).then(f.updateSuccess)}b.entity=a,b.saveEntity=i,b.applicationsQuery=h({url:"/api/v1/search",params:{type:"application",parentType:"organisation",parentId:b.entity._id,size:100,sort:"_id",order:"dsc","select[]":["*"]},columns:[{status:!0,template:'<a ui-sref="app.users.user({\'stub\': item.child.stub})" class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.child.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',model:"child.picture",width:"40px",sort:!1},{status:!0,search:!0,name:"Position",template:'<a href="https://stemn.com/applications/{{item._id}}" class="underlined">{{item.parent.name}}</a>',model:"child.name"},{status:!0,name:"Cover Letter",model:"coverLetter",template:"{{item.coverLetter | letters: 100}}"},{status:!0,search:!0,name:"Company",template:'<a href="https://stemn.com/org/{{item.organisations[0].stub}}" class="underlined">{{item.organisations[0].name}}</a>',model:"child.name",width:"200px"},{status:!0,name:"Time",model:"_id",template:"{{item.timestamp | amTimeAgo}}",width:"140px"},{status:!0,name:"Status",model:"status",width:"140px",template:"<application-status entity='item' entities='query.results' selected-rows='selectedRows'></application-status>"}],filters:{columnOrder:{}},onSucess:function(a){return _.forEach(a,function(a){a.timestamp=e.getDateFromId(a._id)}),a}}),b.applicationsQuery.determineSelect(),b.applicationsQuery.more()}]),angular.module("views.organisations",["modules.search-wiki"]),angular.module("views.organisations").config(["$stateProvider",function(a){a.state("app.organisations",{url:"/organisations",templateUrl:"app/views/organisations/organisations.html",controller:"OrganisationsViewCtrl"})}]).controller("OrganisationsViewCtrl",["$scope","HttpQuery",function(a,b){a.query=b({url:"/api/v1/search",params:{type:"organisation",size:20,select:["stub","adminData","logo"],criteria:{}},columns:[{status:!0,name:"",template:'<a ui-sref="app.organisation({\'stub\': item.stub})" class="avatar-square-contain block" style="background-image: url(\'https://stemn.com{{item.logo.url || \'/assets/images/default/org.png\'}}?size=thumb\')")"></a>',model:"logo.url",width:"40px",sort:!1},{status:!0,search:!0,name:"Name",template:'<a ui-sref="app.organisation({\'stub\': item.stub})" class="underlined">{{item.name}}</a>',model:"name"},{status:!0,name:"Blurb",template:"{{item.blurb | words: 15}}",model:"blurb"},{status:!0,name:"# Projects",model:"numProjects",width:"140px"},{status:!0,name:"# Threads",model:"numThreads",width:"140px"},{status:!0,name:"# Jobs",model:"numJobs",width:"140px"},{status:!0,name:"Type",model:"organisationType",width:"140px",template:'<organisation-type entity="item"</organisation-type>'},{status:!0,name:"Actions",model:"temp",width:"100px",template:'<organisation-row-actions entity="item" query="query"></organisation-row-actions>'}],filters:{columnOrder:{}}}),a.searchFilter={model:"",key:"name",options:[{model:"name",name:"Name"},{model:"blurb",name:"Blurb"}],onChange:function(){a.query.params.criteria={},a.searchFilter.model&&(a.query.params.criteria[a.searchFilter.key]="/"+a.searchFilter.model+"/i"),a.query.refresh()}},a.query.determineSelect(),a.query.more()}]).directive("organisationRowActions",function(){return{restrict:"E",scope:{entity:"=",query:"="},template:'\n             <div layout="row">\n                <md-button aria-label="edit" class="md-icon-button" ng-click="edit($event, entity)">\n                    <ng-md-icon icon="edit"></ng-md-icon>\n                </md-button>\n                <md-button aria-label="delete" class="md-icon-button" ng-click="remove(entity._id)">\n                    <ng-md-icon icon="close"></ng-md-icon>\n                </md-button>\n            </div>\n        ',controller:["$scope","HttpService","$mdDialog","$mdToast","EntityService",function(a,b,c,d,e){function f(b){confirm("Are you sure you want to delete this?")&&e.remove("organisation",b).then(function(b){e.removeSuccess(),a.query.refresh()})}function g(a,b){c.show({templateUrl:"app/views/organisations/tpls/edit-organisation-modal.html",controller:["data","$scope","$http",function(a,b,d){b.item=a,b.itemName=b.item.name+" logo",b.blurbQuery=b.item.name,b.imagesQuery=b.item.name,b.cancel=function(){c.cancel()},b.save=function(){e.update("organisation",b.item).then(function(){e.updateSuccess(),c.hide()})}}],locals:{data:b},targetEvent:a,clickOutsideToClose:!0})}a.remove=f,a.edit=g}]}}).directive("organisationType",function(){return{restrict:"E",scope:{entity:"="},template:'\n        <md-input-container class="m-0">\n            <md-select class="md-accent" ng-model="entity.organisationType" ng-change="save()" placeholder="Type">\n                <md-option ng-repeat="item in types" value="{{item.model}}">\n                    {{item.name}}\n                </md-option>\n            </md-select>\n        </md-input-container>\n        ',controller:["$scope","LogService","$http","CoreLibrary","EntityService",function(a,b,c,d,e){a.save=function(){var b={_id:a.entity._id,organisationType:a.entity.organisationType};e.patch("organisation",b).then(e.updateSuccess)},a.types=[{model:"",name:"None"},{model:"school",name:"School"},{model:"company",name:"Company"}]}]}}),angular.module("views.popular",["modules.search"]),angular.module("views.popular").config(["$stateProvider",function(a){a.state("app.popular",{url:"/popular",templateUrl:"app/views/popular/popular.html",controller:"PopularViewCtrl"})}]).controller("PopularViewCtrl",["$scope","HttpQuery","CoreLibrary","SelectService","CoreModalService",function(a,b,c,d,e){function f(a){return _.map(a,function(a){return{id:a,type:"user"}})}function g(){a.popularQuery.params.type=a.config[2].current,a.popularQuery.refresh()}var h=(new Date).getTime();a.orderFilter={},a.typeChange=g,a.popularQuery=b({url:"/api/v1/analytics/mostViewed",params:{from:h-c.resolutionToMs("month"),to:h,type:"",size:20},onSuccess:function(a){return a=c.keyedArrayToObject(a.values,a.key),_.forEach(a,function(a){a.requestUsers=f(a.requestUsers)}),a}}),a.$watch("orderFilter",function(){a.orderFilter.model&&(a.popularQuery.params.sort=a.orderFilter.model,a.popularQuery.params.order=a.orderFilter.reverse?"asc":"dsc",a.popularQuery.refresh())},!0),a.showDetailsModal=e.showEntity,a.typeOptions={current:"",options:[{model:"project",title:"Projects"},{model:"thread",title:"Threads"},{model:"",title:"All"}]},a.periodOptions={current:"month",options:[{model:"day",title:"Day"},{model:"week",title:"Week"},{model:"fortnight",title:"Fortnight"},{model:"month",title:"Month"}]},a.config=[{type:"date",model:"from",current:a.popularQuery.params.from,title:"From"},{type:"date",model:"to",current:a.popularQuery.params.to,title:"To"},{type:"select",options:a.typeOptions.options,current:a.popularQuery.params.type,model:"type",title:"Type",placeholder:"Select"},{type:"select",options:a.periodOptions.options,current:a.periodOptions.current,model:"period",title:"Period",placeholder:"Select"}],a.popularQuery.more(),a.select=function(b){d.showModal(b,a.config).then(function(b){_.forEach(b,function(b){a.popularQuery.params[b.model]=b.current}),a.popularQuery.params.from=a.popularQuery.params.to-c.resolutionToMs(b[3].current),a.config=b,a.config[0].current=a.popularQuery.params.from,a.popularQuery.refresh()})}}]).service("SelectService",["$mdDialog",function(a){function b(b,c){return a.show({templateUrl:"app/views/popular/table-popular-modal.html",controller:["$mdDialog","$scope","CoreLibrary",function(a,b,d){b.data=angular.copy(c)||{},console.log(b.data),_.forEach(b.data,function(a){"date"===a.type&&(a.current=new Date(a.current))}),b.cancel=function(){a.cancel()},b.save=function(){a.hide(b.data)}}],targetEvent:b,clickOutsideToClose:!0})}this.showModal=b}]),angular.module("views.projects",[]),angular.module("views.projects").config(["$stateProvider",function(a){a.state("app.projects",{url:"/projects?page&criteria",templateUrl:"app/views/projects/projects.html",controller:"ProjectsViewCtrl"})}]).controller("ProjectsViewCtrl",["$scope","$timeout","SearchService","HttpQuery","$http","$stateParams",function(a,b,c,d,e,f){var g=f.criteria?JSON.parse(f.criteria):{};a.query=d({url:"/api/v1/search",urlParams:["page","criteria"],params:{type:"project",sort:"signedup",size:30,select:["stub"],page:f.page||0,criteria:g},columns:[{status:!0,name:"",template:'<a class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',model:"picture",width:"40px",sort:!1},{status:!0,search:!0,name:"Name",template:'<a ng-href="https://stemn.com/projects/{{item.stub}}" target="blank">{{item.name}}</a>',model:"name"},{status:!0,name:"Followers",model:"followers",width:"85px"},{status:!0,name:"Comments",model:"numComments",width:"85px"},{status:!0,name:"Updated",model:"updated",width:"85px"},{status:!0,name:"Connected",model:"remote",template:'<span style="text-transform: capitalize">{{item.remote.provider}}</span>',width:"85px"},{status:!0,name:"Private",model:"permissions",template:"<span>{{item.permissions.projectType == 'private' ? 'Yes' : ''}}</span>",width:"85px"}],filters:{columnOrder:{}}}),a.query.determineSelect(),a.query.init(),a.searchFilter=c.newFilter({type:"search",query:a.query,key:"name",options:[{model:"name",name:"Name"}]}),a.searchFilter.parseParams(g)}]),angular.module("views.referrals",[]),
angular.module("views.referrals").config(["$stateProvider",function(a){a.state("app.referrals",{url:"/referrals",templateUrl:"app/views/referrals/referrals.html",controller:"ReferralsViewCtrl"})}]).controller("ReferralsViewCtrl",["$scope","HttpQuery","EntityService","ReminderService","SearchService",function(a,b,c,d,e){a.query=b({url:"/api/v1/search",urlParams:["page","criteria"],params:{type:"referral",size:30,order:"dsc",sort:"date",populate:!1,"select[]":["*","owner"]},columns:[{status:!0,sort:!1,name:"User",template:'<core-entity-picture entity-type="user" entity-id="{{item._id}}" entity="item.user"></core-entity-picture>',width:"50px"},{status:!0,sort:!1,name:"Name",template:"{{item.user.name}}"},{status:!0,name:"Hits",model:"numHits",width:"80px"},{status:!0,name:"Signups",model:"numSignups",template:'\n                    <a click-show-entities="item.signups">{{item.numSignups}}</a>\n                ',width:"80px"},{status:!0,sort:!0,name:"Code",model:"ref",width:"50px"}],filters:{columnOrder:{}},onSuccess:function(a){return _.forEach(a,function(a){a.signups=_.map(a.signups,function(a){return{type:"user",id:a.user}})}),a}}),a.query.init(),a.newReminder=d.newReminderModal,a.ownerFilter=e.newFilter({title:"User Type",model:"criteria.owner",options:[{model:"5498e258a7fbbfcc12c3fa15",name:"Jackson"},{model:"55c0cb75dca1a7e5444c13f7",name:"Denzil"},{model:"5496bdb8104ad2c800020602",name:"Jack"},{model:"547db55af7f342380174e228",name:"David"},{model:"565f9406ca3491aff9b9ad4a",name:"Anthony Tan"},{model:"55e92c8142be6dba0b4c05e9",name:"Toy"},{model:"56cfd32276dbc2072fc17a09",name:"Email Templater"},{model:"56e14e058c106e6711b76ed7",name:"Upwork"}],query:a.query})}]),angular.module("views.reminders",["modules.reminders"]),angular.module("views.reminders").config(["$stateProvider",function(a){a.state("app.reminders",{url:"/reminders",templateUrl:"app/views/reminders/reminders.html",controller:"RemindersViewCtrl"})}]).controller("RemindersViewCtrl",["$scope","HttpQuery","EntityService","ReminderService","SearchService",function(a,b,c,d,e){a.query=b({url:"/api/v1/search",urlParams:["page","criteria"],params:{criteria:{complete:!1},type:"reminder",size:30,"select[]":["*"]},columns:[{status:!0,sort:!1,name:"User",template:'<a ui-sref="app.users.user.info({\'stub\': item.user.stub})" class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.user.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',width:"50px"},{status:!0,name:"Notes",model:"notes"},{status:!0,name:"Date",model:"reminderDate",width:"200px",template:"{{item.reminderDate | amCalendar}}"},{status:!0,name:"Complete",model:"status",width:"50px",template:"<reminder-status entity='item' entities='query.results' selected-rows='selectedRows'></reminder-status>"},{status:!0,sort:!0,name:"Owner",model:"owner",template:'<a ui-sref="app.users.user.info({\'stub\': item.owner.stub})" class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.owner.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',width:"50px"},{status:!0,sort:!1,name:"Actions",model:"temp",width:"50px",template:'<reminder-row-actions entity="item" query="query"></reminder-row-actions>'}],filters:{columnOrder:{}}}),a.query.init(),a.newReminder=d.newReminderModal,a.ownerFilter=e.newFilter({title:"User Type",model:"criteria.owner",options:[{model:"5498e258a7fbbfcc12c3fa15",name:"Jackson"},{model:"55c0cb75dca1a7e5444c13f7",name:"Denzil"},{model:"5496bdb8104ad2c800020602",name:"Jack"},{model:"547db55af7f342380174e228",name:"David"},{model:"565f9406ca3491aff9b9ad4a",name:"Anthony Tan"},{model:"55e92c8142be6dba0b4c05e9",name:"Toy"},{model:"56cfd32276dbc2072fc17a09",name:"Email Templater"},{model:"56e14e058c106e6711b76ed7",name:"Upwork"}],query:a.query})}]),angular.module("views.state",["modules.charts","modules.states"]),angular.module("views.state").config(["$stateProvider",function(a){a.state("app.state",{url:"/states/:state?stub",templateUrl:"app/views/state/state.html",controller:"StateViewCtrl"})}]).controller("StateViewCtrl",["$scope","$stateParams",function(a,b){a.state=b.state,a.params={stub:b.stub},a.stateDataGeneral={name:b.state,params:a.params},a.stateDataSpecific={name:b.state,params:a.params}}]),angular.module("views.states",["modules.charts","modules.states"]),angular.module("views.states").config(["$stateProvider",function(a){a.state("app.states",{url:"/states",templateUrl:"app/views/states/states.html",controller:"StatesViewCtrl"})}]).controller("StatesViewCtrl",["$scope","$http",function(a,b){a.stateDataGeneral={name:"app.home"},a.stateDataSpecific={name:"app.home"},b({url:"/api/v1/analytics/appStates",method:"GET"}).then(function(b){var c=0;_.forEach(b.data,function(a){a.name=a.state,c+=a.number}),_.forEach(b.data,function(a){a.percentage=(a.number/c*100).toFixed(2)}),a.popularStatesGeneral=b.data,a.popularStatesSpecific=angular.copy(b.data)})}]),angular.module("views.threads",[]),angular.module("views.threads").config(["$stateProvider",function(a){a.state("app.threads",{url:"/threads?page&criteria",templateUrl:"app/views/threads/threads.html",controller:"ThreadsViewCtrl"})}]).controller("ThreadsViewCtrl",["$scope","$timeout","SearchService","HttpQuery","$http","$stateParams",function(a,b,c,d,e,f){var g=f.criteria?JSON.parse(f.criteria):{};a.query=d({url:"/api/v1/search",urlParams:["page","criteria"],params:{type:"thread",sort:"signedup",size:30,select:["stub"],page:f.page||0,criteria:g},paginate:!0,columns:[{status:!0,name:"",template:'<a class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',model:"picture",width:"40px",sort:!1},{status:!0,search:!0,name:"Name",model:"name"},{status:!0,name:"Followers",model:"followers",width:"85px"},{status:!0,name:"Comments",model:"numPosts",width:"85px"},{status:!0,name:"Updated",model:"updated",width:"85px"},{status:!0,name:"Type",model:"type",width:"85px"}],filters:{columnOrder:{}}}),a.query.determineSelect(),a.query.init(),a.searchFilter=c.newFilter({type:"search",query:a.query,key:"name",options:[{model:"name",name:"Name"}]}),a.searchFilter.parseParams(g)}]),angular.module("views.usage",[]),angular.module("views.usage").config(["$stateProvider",function(a){a.state("app.usage",{url:"/",templateUrl:"app/views/usage/usage.html",controller:"UsageViewCtrl"})}]).controller("UsageViewCtrl",["userdata","$scope",function(a,b){}]),angular.module("views.user",["modules.emails"]),angular.module("views.user").config(["$stateProvider",function(a){a.state("app.users.user",{url:"/:stub","abstract":!0,templateUrl:"app/views/user/user.html",controller:"UserViewCtrl",resolve:{user:["EntityService","$stateParams",function(a,b){return a.get("user",b.stub,"lg")}]}}).state("app.users.user.analytics",{url:"/analytics",sticky:!0,views:{analytics:{templateUrl:"app/views/user/tpls/user-analytics.html"}}}).state("app.users.user.info",{url:"",sticky:!0,views:{info:{templateUrl:"app/views/user/tpls/user-info.html"}}}).state("app.users.user.applications",{url:"/applications",sticky:!0,views:{applications:{templateUrl:"app/views/user/tpls/user-applications.html"}}}).state("app.users.user.crm",{url:"/crm",sticky:!0,views:{crm:{templateUrl:"app/views/user/tpls/user-crm.html",controller:["$scope","$http",function(a,b){b({method:"GET",url:"api/v1/analytics/contactedButNotUpdated",params:{user:a.entity._id}}).then(function(a){})}]}}})}]).controller("UserViewCtrl",["user","$scope","$stateParams","$http","CoreLibrary","$mdToast","EntityService","HttpQuery","EmailService",function(a,b,c,d,e,f,g,h,i){function j(){g.update("user",b.entity).then(g.updateSuccess)}b.entity=a,b.saveEntity=j,b.applicationsQuery=h({url:"/api/v1/search",params:{type:"application",parentType:"user",parentId:b.entity._id,size:100,sort:"_id",order:"dsc","select[]":["*"]},columns:[{status:!0,template:'<a ui-sref="app.users.user({\'stub\': item.child.stub})" class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.child.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',model:"child.picture",width:"40px",sort:!1},{status:!0,search:!0,name:"Position",template:'<a href="https://stemn.com/applications/{{item._id}}" class="underlined">{{item.parent.name}}</a>',model:"child.name"},{status:!0,name:"Cover Letter",model:"coverLetter",template:"{{item.coverLetter | letters: 100}}"},{status:!0,search:!0,name:"Company",template:'<a href="https://stemn.com/org/{{item.organisations[0].stub}}" class="underlined">{{item.organisations[0].name}}</a>',model:"child.name",width:"200px"},{status:!0,name:"Time",model:"_id",template:"{{item.timestamp | amTimeAgo}}",width:"140px"},{status:!0,name:"Status",model:"status",width:"140px",template:"<application-status entity='item' entities='query.results' selected-rows='selectedRows'></application-status>"}],filters:{columnOrder:{}},onSucess:function(a){return _.forEach(a,function(a){a.timestamp=e.getDateFromId(a._id)}),a}}),b.applicationsQuery.determineSelect(),b.applicationsQuery.more(),b.tabs=[{label:"Info",sref:"app.users.user.info"},{label:"CRM",sref:"app.users.user.crm"},{label:"Analytics",sref:"app.users.user.analytics"},{label:"Applications",sref:"app.users.user.applications"}],d({url:"api/v1/users/"+a._id+"/campaign",method:"GET"}).then(function(a){b.campaign=a.data}),d({url:"api/v1/analytics/userDevices",method:"GET",params:{user:a._id}}).then(function(a){_.forEach(a.data,function(a){a.date=e.getDateFromId(a._id)}),b.devices=a.data})}]),angular.module("views.users",["modules.search","modules.tables"]),angular.module("views.users").config(["$stateProvider",function(a){a.state("app.users",{url:"/users?page&criteria",templateUrl:"app/views/users/users.html",controller:"UsersViewCtrl"})}]).controller("UsersViewCtrl",["$scope","$timeout","SearchService","HttpQuery","$http","$stateParams",function(a,b,c,d,e,f){var g=f.criteria?JSON.parse(f.criteria):{};a.usersQuery=d({url:"/api/v1/search",urlParams:["page","criteria"],params:{type:"user",sort:"signedup",size:30,select:["stub"],page:f.page||0,criteria:g},paginate:!0,columns:[{status:!0,name:"",template:'<a ui-sref="app.users.user.info({\'stub\': item.stub})" class="avatar-circle block" style="background-image: url(\'https://stemn.com{{item.picture || \'/assets/images/default/org.png\'}}?size=thumb&crop=true\')")"></a>',model:"picture",width:"40px",sort:!1},{status:!0,search:!0,name:"Name",template:'<a ui-sref="app.users.user.info({\'stub\': item.stub})" class="underlined">{{item.name}}</a>',model:"name"},{status:!0,name:"# Projects",model:"numProjects",width:"85px"},{status:!1,name:"# Threads",model:"numThreads",width:"85px"},{status:!1,name:"# Posts",model:"numPosts",width:"85px"},{status:!1,name:"# Comments",model:"numComments",width:"100px"},{status:!0,name:"# Applications",model:"numApplications",template:'<div click-show-applications parent-type="user" parent-id="{{item._id}}">{{item.numApplications}}</div>',width:"120px"},{status:!0,name:"Followers",model:"followers",width:"85px"},{status:!0,name:"Contacted By",template:"{{item.adminData.contacted[0].contactedBy}}",model:"adminData.contacted[0].contactedBy",width:"120px"},{status:!1,name:"Contacted Date",template:"{{item.adminData.contacted[0].date | amTimeAgo}}",model:"adminData.contacted[0].date",width:"85px"},{status:!0,name:"Signed up Date",template:"{{item.signedup | amTimeAgo}}",model:"signedup",width:"85px"},{status:!0,name:"Education",template:'<user-organisation-encode entity="item" type="education"></user-organisation-encode>',model:"profile.profileDetails",width:"300px"},{status:!1,name:"Experience",template:'<user-organisation-encode entity="item" type="experience"></user-organisation-encode>',model:"profile.profileDetails",width:"300px"},{status:!0,name:"Rating",model:"adminData.rating",width:"140px",template:"<user-rating entity='item' entities='query.results' selected-rows='selectedRows' rating-type='rating'></user-rating>"},{status:!0,name:"Potential Rating",model:"adminData.potentialRating",width:"140px",template:"<user-rating entity='item' entities='query.results' selected-rows='selectedRows' rating-type='potentialRating'></user-rating>"},{status:!0,name:"Email",model:"profile.email",width:"100px",template:"{{item.profile.email}}"}],filters:{columnOrder:{}}}),a.usersQuery.determineSelect(),a.usersQuery.init(),a.searchFilter=c.newFilter({type:"search",query:a.usersQuery,key:"name",options:[{model:"name",name:"Name"},{model:"blurb",name:"Blurb"},{model:"profile.profileDetails.education.school",name:"School"},{model:"profile.profileDetails.experience.company",name:"Company"},{model:"profile.email",name:"Email"}]}),a.searchFilter.parseParams(g)}]).directive("userOrganisationEncode",function(){return{restrict:"E",scope:{entity:"=",type:"@"},template:'\n        <div ng-repeat="item in entity.profile.profileDetails[type]" layout="row" layout-align="start center">\n            <organisation-search class="typeahead-compact" search-text="item[subKey]" data="item.organisations" single="true" organisation-type="{{subKey}}" style="padding-bottom: 15px"></organisation-search>\n        </div>\n        <md-button class="md-raised md-accent m-0" ng-click="saveUser()">Save</md-button>\n        ',controller:["$scope","LogService","$http","CoreLibrary","EntityService",function(a,b,c,d,e){a.subKey="education"==a.type?"school":"company",a.saveUser=function(){var b={_id:a.entity._id,profile:{profileDetails:{}}};b.profile.profileDetails[a.type]=a.entity.profile.profileDetails[a.type],e.patch("user",b).then(e.updateSuccess)}}]}});