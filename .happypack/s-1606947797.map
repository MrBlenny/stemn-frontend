{"version":3,"sources":["app\\renderer\\assets\\other\\gerber\\js\\parse\\kicad_pcb_parser.js"],"names":[],"mappings":"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","file":"kicad_pcb_parser.js","sourceRoot":"C:/Users/david/repositories/stemn-electron-2","sourcesContent":["(function (root, factory) {\n\tif(typeof define === \"function\" && define.amd) {\n\t\tdefine(function(){\n\t\t\treturn factory();\n\t\t});\n\t} else if(typeof module === \"object\" && module.exports) {\n\t\tmodule.exports = factory();\n\t} else {\n\t\troot.KicadNewParser = factory();\n\t}\n}(this, function () {\n\nfunction KicadNewParser (board) {\n    board = board || {};\n\tthis.context = [];\n\tthis.chunk = \"\"; // TODO: use a node compatible Buffers\n\n\tthis.cmd = null;\n\tthis.context = [];\n\tthis.args = false;\n\tthis.stringContext = false;\n\tthis.token = \"\";\n\n\tthis.netByNumber = {};\n\tthis.netByName   = {};\n\tthis.netClass    = {};\n\n\t// store by eagle name\n\tboard.eagleLayersByName = {};\n\t// store by eagle number\n\tboard.layersByNumber = {};\n\n\tboard.elements = {};\n\n\tboard.signalItems = {};\n\n\tboard.packagesByName = {};\n\n\tboard.plainWires = {};\n\tboard.plainTexts = {};\n\n\tboard.coordYFlip = true;\n\n\tthis.board = board;\n}\n\nKicadNewParser.supports = function (text) {\n\tif (text.match (/\\(kicad_pcb/)) return true;\n}\n\nKicadNewParser.name = \"kicad kicad_pcb\";\n\n\nvar layerMaps = {\n\t\"Front\": \"Top\",\n\t\"Back\": \"Bottom\",\n\t\"F.Cu\": \"Top\",\n\t\"B.Cu\": \"Bottom\",\n//\t\"Inner1.Cu\": \"Inner1\",\n//\t\"Inner2.Cu\": \"Inner2\",\n\t\"B.Adhes\": \"bGlue\",\n\t\"F.Adhes\": \"tGlue\",\n\t\"B.Paste\": \"bCream\",\n\t\"F.Paste\": \"tCream\",\n\t\"B.SilkS\": \"bNames\",\n\t\"F.SilkS\": \"tNames\",\n\t\"B.Mask\": \"bStop\",\n\t\"F.Mask\": \"tStop\",\n\t\"F.CrtYd\": \"tKeepout\",\n\t\"B.CrtYd\": \"bKeepout\",\n\t\"F.Fab\": \"tPlace\",\n\t\"B.Fab\": \"bPlace\",\n\t\"Dwgs.User\": \"tValues\",\n\t//(41 Cmts.User user)\n\t//(42 Eco1.User user)\n\t//(43 Eco2.User user)\n\t\"Edge.Cuts\": \"Dimension\"\n};\n\nvar eagleLayers = {\n\t\"Top\":     { \"name\": \"Top\",     \"number\": 1, \"color\": 4 },\n\t\"Inner1\":  { \"name\": \"Inner1\",  \"number\": 2, \"color\": 16 },\n\t\"Inner2\":  { \"name\": \"Inner2\",  \"number\": 3, \"color\": 16 },\n\t\"Inner3\":  { \"name\": \"Inner3\",  \"number\": 4, \"color\": 16 },\n\t\"Inner4\":  { \"name\": \"Inner4\",  \"number\": 5, \"color\": 16 },\n\t\"Inner5\":  { \"name\": \"Inner5\",  \"number\": 6, \"color\": 16 },\n\t\"Inner6\":  { \"name\": \"Inner6\",  \"number\": 7, \"color\": 16 },\n\t\"Inner7\":  { \"name\": \"Inner7\",  \"number\": 8, \"color\": 16 },\n\t\"Inner8\":  { \"name\": \"Inner8\",  \"number\": 9, \"color\": 16 },\n\t\"Inner9\":  { \"name\": \"Inner9\",  \"number\": 10, \"color\": 16 },\n\t\"Inner10\": { \"name\": \"Inner10\", \"number\": 11, \"color\": 16 },\n\t\"Inner11\": { \"name\": \"Inner11\", \"number\": 12, \"color\": 16 },\n\t\"Inner12\": { \"name\": \"Inner12\", \"number\": 13, \"color\": 16 },\n\t\"Inner13\": { \"name\": \"Inner13\", \"number\": 14, \"color\": 16 },\n\t\"Inner14\": { \"name\": \"Inner14\", \"number\": 15, \"color\": 16 },\n\t\"Bottom\":  { \"name\": \"Bottom\", \"number\": 16, \"color\": 1 },\n\t\"Pads\": { \"name\": \"Pads\", \"number\": 17, \"color\": 2 },\n\t\"Vias\": { \"name\": \"Vias\", \"number\": 18, \"color\": 2 },\n\t\"Unrouted\": { \"name\": \"Unrouted\", \"number\": 19, \"color\": 6 },\n\t\"Dimension\": { \"name\": \"Dimension\", \"number\": 20, \"color\": 15 },\n\t\"tPlace\": { \"name\": \"tPlace\", \"number\": 21, \"color\": 7 },\n\t\"bPlace\": { \"name\": \"bPlace\", \"number\": 22, \"color\": 7 },\n\t\"tOrigins\": { \"name\": \"tOrigins\", \"number\": 23, \"color\": 15 },\n\t\"bOrigins\": { \"name\": \"bOrigins\", \"number\": 24, \"color\": 15 },\n\t\"tNames\": { \"name\": \"tNames\", \"number\": 25, \"color\": 7 },\n\t\"bNames\": { \"name\": \"bNames\", \"number\": 26, \"color\": 7 },\n\t\"tValues\": { \"name\": \"tValues\", \"number\": 27, \"color\": 7 },\n\t\"bValues\": { \"name\": \"bValues\", \"number\": 28, \"color\": 7 },\n\t\"tStop\": { \"name\": \"tStop\", \"number\": 29, \"color\": 7 },\n\t\"bStop\": { \"name\": \"bStop\", \"number\": 30, \"color\": 7 },\n\t\"tCream\": { \"name\": \"tCream\", \"number\": 31, \"color\": 7 },\n\t\"bCream\": { \"name\": \"bCream\", \"number\": 32, \"color\": 7 },\n\t\"tFinish\": { \"name\": \"tFinish\", \"number\": 33, \"color\": 6 },\n\t\"bFinish\": { \"name\": \"bFinish\", \"number\": 34, \"color\": 6 },\n\t\"tGlue\": { \"name\": \"tGlue\", \"number\": 35, \"color\": 7 },\n\t\"bGlue\": { \"name\": \"bGlue\", \"number\": 36, \"color\": 7 },\n\t\"tTest\": { \"name\": \"tTest\", \"number\": 37, \"color\": 7 },\n\t\"bTest\": { \"name\": \"bTest\", \"number\": 38, \"color\": 7 },\n\t\"tKeepout\": { \"name\": \"tKeepout\", \"number\": 39, \"color\": 4 },\n\t\"bKeepout\": { \"name\": \"bKeepout\", \"number\": 40, \"color\": 1 },\n\t\"tRestrict\": { \"name\": \"tRestrict\", \"number\": 41, \"color\": 4 },\n\t\"bRestrict\": { \"name\": \"bRestrict\", \"number\": 42, \"color\": 1 },\n\t\"vRestrict\": { \"name\": \"vRestrict\", \"number\": 43, \"color\": 2 },\n\t\"Drills\": { \"name\": \"Drills\", \"number\": 44, \"color\": 7 },\n\t\"Holes\": { \"name\": \"Holes\", \"number\": 45, \"color\": 7 },\n\t\"Milling\": { \"name\": \"Milling\", \"number\": 46, \"color\": 3 },\n\t\"Measures\": { \"name\": \"Measures\", \"number\": 47, \"color\": 7 },\n\t\"Document\": { \"name\": \"Document\", \"number\": 48, \"color\": 7 },\n\t\"Reference\": { \"name\": \"Reference\", \"number\": 49, \"color\": 7 },\n\t\"dxf\": { \"name\": \"dxf\", \"number\": 50, \"color\": 7 },\n\t\"tDocu\": { \"name\": \"tDocu\", \"number\": 51, \"color\": 7 },\n\t\"bDocu\": { \"name\": \"bDocu\", \"number\": 52, \"color\": 7 },\n\t\"tGND_GNDA\": { \"name\": \"tGND_GNDA\", \"number\": 53, \"color\": 7 },\n\t\"bGND_GNDA\": { \"name\": \"bGND_GNDA\", \"number\": 54, \"color\": 1 },\n\t\"wert\": { \"name\": \"wert\", \"number\": 56, \"color\": 7 },\n\t\"Nets\": { \"name\": \"Nets\", \"number\": 91, \"color\": 2 },\n\t\"Busses\": { \"name\": \"Busses\", \"number\": 92, \"color\": 1 },\n\t\"Pins\": { \"name\": \"Pins\", \"number\": 93, \"color\": 2 },\n\t\"Symbols\": { \"name\": \"Symbols\", \"number\": 94, \"color\": 4 },\n\t\"Names\": { \"name\": \"Names\", \"number\": 95, \"color\": 7 },\n\t\"Values\": { \"name\": \"Values\", \"number\": 96, \"color\": 7 },\n\t\"Info\": { \"name\": \"Info\", \"number\": 97, \"color\": 7 },\n\t\"Guide\": { \"name\": \"Guide\", \"number\": 98, \"color\": 6 },\n\t\"Muster\": { \"name\": \"Muster\", \"number\": 100, \"color\": 7 },\n\t\"Patch_Top\": { \"name\": \"Patch_Top\", \"number\": 101, \"color\": 12 },\n\t\"Vscore\": { \"name\": \"Vscore\", \"number\": 102, \"color\": 7 },\n\t\"fp3\": { \"name\": \"fp3\", \"number\": 103, \"color\": 7 },\n\t\"Name\": { \"name\": \"Name\", \"number\": 104, \"color\": 7 },\n\t\"Beschreib\": { \"name\": \"Beschreib\", \"number\": 105, \"color\": 9 },\n\t\"BGA-Top\": { \"name\": \"BGA-Top\", \"number\": 106, \"color\": 4 },\n\t\"BD-Top\": { \"name\": \"BD-Top\", \"number\": 107, \"color\": 5 },\n\t\"fp8\": { \"name\": \"fp8\", \"number\": 108, \"color\": 7 },\n\t\"fp9\": { \"name\": \"fp9\", \"number\": 109, \"color\": 7 },\n\t\"fp0\": { \"name\": \"fp0\", \"number\": 110, \"color\": 7 },\n\t\"Patch_BOT\": { \"name\": \"Patch_BOT\", \"number\": 116, \"color\": 9 },\n\t\"_tsilk\": { \"name\": \"_tsilk\", \"number\": 121, \"color\": 7 },\n\t\"_bsilk\": { \"name\": \"_bsilk\", \"number\": 122, \"color\": 7 },\n\t\"tTestmark\": { \"name\": \"tTestmark\", \"number\": 123, \"color\": 7 },\n\t\"bTestmark\": { \"name\": \"bTestmark\", \"number\": 124, \"color\": 7 },\n\t\"tAdjust\": { \"name\": \"tAdjust\", \"number\": 131, \"color\": 7 },\n\t\"bAdjust\": { \"name\": \"bAdjust\", \"number\": 132, \"color\": 7 },\n\t\"HeatSink\": { \"name\": \"HeatSink\", \"number\": 151, \"color\": 7 },\n\t\"200bmp\": { \"name\": \"200bmp\", \"number\": 200, \"color\": 1 },\n\t\"201bmp\": { \"name\": \"201bmp\", \"number\": 201, \"color\": 2 },\n\t\"202bmp\": { \"name\": \"202bmp\", \"number\": 202, \"color\": 3 },\n\t\"203bmp\": { \"name\": \"203bmp\", \"number\": 203, \"color\": 4 },\n\t\"204bmp\": { \"name\": \"204bmp\", \"number\": 204, \"color\": 5 },\n\t\"205bmp\": { \"name\": \"205bmp\", \"number\": 205, \"color\": 6 },\n\t\"206bmp\": { \"name\": \"206bmp\", \"number\": 206, \"color\": 7 },\n\t\"207bmp\": { \"name\": \"207bmp\", \"number\": 207, \"color\": 8 },\n\t\"208bmp\": { \"name\": \"208bmp\", \"number\": 208, \"color\": 9 },\n\t\"209bmp\": { \"name\": \"209bmp\", \"number\": 209, \"color\": 7 },\n\t\"210bmp\": { \"name\": \"210bmp\", \"number\": 210, \"color\": 7 },\n\t\"Descript\": { \"name\": \"Descript\", \"number\": 250, \"color\": 3 },\n\t\"SMDround\": { \"name\": \"SMDround\", \"number\": 251, \"color\": 12 },\n\t\"cooling\": { \"name\": \"cooling\", \"number\": 254, \"color\": 7 }\n};\n\nKicadNewParser.prototype.eagleLayer = function (layerName) {\n\t// eagle draw will replace layer info accordingly\n\tif (layerName === \"*.Cu\") layerName = \"Front\";\n\tif (layerName === \"*.Mask\") layerName = \"F.Mask\";\n\tif (!layerMaps[layerName]) {\n\t\tconsole.warn ('Unknown layer %s, skipping', layerName);\n\t\treturn {};\n\t}\n\treturn eagleLayers [layerMaps[layerName]];\n}\n\nKicadNewParser.prototype.parse = function (text) {\n\n\ttext = text.toString();\n\n\ttext.split(/[\\r\\n]+/g).forEach (this.parseChunk, this);\n\n\tthis.cmdCb = function (cmd, context) {\n\n\t}\n}\n\nKicadNewParser.prototype.parseChunk = function (chunk) {\n\tthis.chunk += chunk;\n\n\tthis.chunk.split (/[\\s]/).forEach (function (token) {\n\t\t//if ()\n\t}, this);\n}\n\nKicadNewParser.prototype.parseChunk = function (chunk) {\n\tvar str = chunk.toString();\n\tvar l = str.length;\n\n\tfor (var i = 0; i<l; i++) {\n\t\tvar c = str[i];\n\n\t\tif (c === '\"') {\n\t\t\tthis.stringContext = !this.stringContext;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (this.stringContext) {\n\t\t\tthis.token += c;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (c === '(') {\n\t\t\tthis.args = false;\n\n\t\t\tif (!this.cmd) {\n\t\t\t\tthis.cmd = {name: \"\", args: []};\n\t\t\t} else {\n\t\t\t\tvar newCmd = {name: \"\", args: []};\n\t\t\t\tthis.cmd.args.push (newCmd);\n\t\t\t\tthis.cmd = newCmd;\n\t\t\t}\n\n\t\t\tthis.context.push(this.cmd);\n\t\t} else if (c === ')') {\n\n\t\t\tthis.handleToken();\n\n\t\t\tif (this.context.length === 1) {\n\t\t\t\t// TODO: this.parseCompleted ();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.context.pop();\n\n\t\t\tthis.cmdDone (this.cmd);\n\n\t\t\tthis.cmd = this.context[this.context.length-1];\n\n\t\t} else if (c === ' ') {\n\t\t\tthis.handleToken();\n\t\t} else {\n\t\t\tthis.token += c;\n\t\t}\n\t}\n}\n\nKicadNewParser.prototype.handleToken = function () {\n\tvar trimmed = this.token.trim();\n\n\tif (!this.args) {\n\t\tthis.args = true;\n\t\tthis.cmd.name = this.token;\n\t} else if (trimmed) {\n\t\tthis.cmd.args.push (trimmed);\n\t}\n\tthis.token = \"\";\n}\n\nvar alwaysArray = \"fp_text fp_circle fp_line pad\".split (\" \");\n\nKicadNewParser.prototype.extractAttrs = function (args) {\n\tvar attrs = {};\n\tvar attrCount = {};\n\targs.forEach (function (arg) {\n\t\tif (!arg.name) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (arg.name in attrs) {\n\t\t\tif (attrCount[arg.name] === 1) {\n\t\t\t\tattrs[arg.name] = [attrs[arg.name], arg.args];\n\t\t\t\tattrCount[arg.name] = 2;\n\t\t\t} else {\n\t\t\t\tattrs[arg.name].push (arg.args);\n\t\t\t}\n\t\t} else if (alwaysArray.indexOf (arg.name) > -1) {\n\t\t\tattrs[arg.name] = [arg.args];\n\t\t\tattrCount[arg.name] = 2;\n\t\t} else {\n\t\t\tattrs[arg.name] = arg.args;\n\t\t\tattrCount[arg.name] = 1;\n\t\t}\n\n\t}, this);\n\treturn attrs;\n}\n\nKicadNewParser.prototype.spliceArgs = function (args) {\n\tvar spliced = [];\n\targs.forEach (function (arg) {\n\t\tif (!arg.name) {\n\t\t\tspliced.push (arg);\n\t\t}\n\t}, this);\n\treturn spliced;\n}\n\nKicadNewParser.prototype.parseLine = function (cmd) {\n\tcmd.attrs = this.extractAttrs (cmd.args);\n\tcmd.args  = this.spliceArgs   (cmd.args);\n\tvar line = {\n\t\tx1: parseFloat (cmd.attrs.start[0]),\n\t\ty1: parseFloat (cmd.attrs.start[1]),\n\t\tx2: parseFloat (cmd.attrs.end[0]),\n\t\ty2: parseFloat (cmd.attrs.end[1]),\n\t\twidth: parseFloat (cmd.attrs.width[0]),\n\t\tlayer: cmd.attrs.layer[0]\n\t};\n\tif (cmd.name === \"gr_arc\") {\n\t\tvar angle = parseFloat (cmd.attrs.angle[0])/180 * Math.PI;\n\t\tvar dx = line.x1 - line.x2,\n\t\t\tdy = line.y1 - line.y2;\n\t\tvar arc = {\n\t\t\tx: line.x1,\n\t\t\ty: line.y1,\n\t\t\twidth: line.width,\n\t\t\tlayer: line.layer,\n\t\t\tcurve: angle,\n\t\t\tangle: angle,\n\t\t\tradius: Math.sqrt (dx * dx + dy * dy),\n\t\t\t// TODO: why to add Math.PI?\n\t\t\tstart: Math.PI + Math.atan2 (dy, dx)\n\t\t};\n\t\treturn arc;\n\t}\n\treturn line;\n}\n\nKicadNewParser.prototype.parseText = function (cmd, angle) {\n\tcmd.attrs = this.extractAttrs (cmd.args);\n\tcmd.args  = this.spliceArgs   (cmd.args);\n\n\t// semantics, oh my: font size contained in effects/font/size\n\tvar effects = cmd.attrs.effects;\n\tcmd.attrs.effects = {};\n\teffects.forEach (function (eff) {\n\t\tif (eff.name === \"font\") {\n\t\t\tcmd.attrs.effects[eff.name] = this.extractAttrs (eff.args);\n\t\t} else {\n\t\t\tcmd.attrs.effects[eff.name] = eff.args;\n\t\t}\n\t}, this);\n\tvar text = {\n\t\tx: parseFloat (cmd.attrs.at[0]),\n\t\ty: parseFloat (cmd.attrs.at[1]),\n\t\tfont: \"vector\",\n\t\tlayer: cmd.attrs.layer[0],\n\t\tcontent: cmd.name === \"gr_text\" ? cmd.args[0] : cmd.args[1]\n\t};\n\n\ttext.content = text.content.replace (/\\\\n/g, \"\\n\");\n\n\ttext.size = 1;\n\t// TODO: size has two children, do something if those don't match\n\tif (cmd.attrs.effects.font && cmd.attrs.effects.font.size)\n\t\ttext.size = parseFloat (cmd.attrs.effects.font.size[0]);\n\n\tvar rotate = parseFloat (cmd.attrs.at[2]) || 0;\n\t// TODO:\n\t//text.rot = \"R\" + (rotate - (angle || 0));\n\ttext.rot = \"R\" + rotate;\n\tif (rotate >= 90 && rotate <= 270) {\n\t\ttext.flipText = true;\n\t}\n\n\tif (cmd.args.indexOf (\"hide\") > -1)\n\t\ttext.display = \"off\";\n\n\tvar justify = {};\n\t(cmd.attrs.effects.justify || []).forEach (function (justKey) {\n\t\tjustify[justKey] = true;\n\t});\n\tif (justify.mirror)\n\t\ttext.rot = \"M\"+text.rot;\n\tif (justify.right) {\n\t\ttext.align = \"right\"\n\t} else if (justify.left) {\n\t\ttext.align = \"left\";\n\t} else {\n\t\ttext.align = \"center\";\n\t}\n\n\ttext.valign = \"middle\";\n\n\t// TODO: effects.attrs.thickness\n\t// TODO: rotated text?\n\n\treturn text;\n}\n\nKicadNewParser.prototype.parseVia = function (cmd) {\n\tcmd.attrs = this.extractAttrs (cmd.args);\n\tcmd.args  = this.spliceArgs   (cmd.args);\n\tvar net = cmd.attrs.net[0];\n\tvar viaDrill = this.netClass[this.netByNumber[net].className].via_drill;\n\tvar via = {\n\t\tx: parseFloat (cmd.attrs.at[0]),\n\t\ty: parseFloat (cmd.attrs.at[1]),\n\t\tdrill: viaDrill,\n\t\t//drill: parseFloat (cmd.attrs.size[0]),\n\t\tlayers: cmd.attrs.layers\n\t\t// shape?\n\t};\n\treturn via;\n}\n\nKicadNewParser.prototype.parseCircle = function (cmd) {\n\tcmd.attrs = this.extractAttrs (cmd.args);\n\tcmd.args  = this.spliceArgs   (cmd.args);\n\n\tvar x   = parseFloat (cmd.attrs.center[0]);\n\tvar y   = parseFloat (cmd.attrs.center[1]);\n\tvar x1  = parseFloat (cmd.attrs.end[0]);\n\tvar y1  = parseFloat (cmd.attrs.end[1]);\n\n\tvar dx = x1 - x,\n\t\tdy = y1 - y,\n\t\tradius = Math.sqrt (dx * dx + dy * dy);\n\n\tvar circle = {\n\t\tx: x,\n\t\ty: y,\n\t\tradius: radius,\n\t\tstart: 0,\n\t\tangle: 2*Math.PI,\n\t\tcurve: 360,\n\t\twidth: cmd.attrs.width[0],\n\t\tlayer: cmd.attrs.layer[0]\n\t};\n\treturn circle;\n}\n\n\nKicadNewParser.prototype.parsePad = function (cmd, angle) {\n\tcmd.attrs = this.extractAttrs (cmd.args);\n\tcmd.args  = this.spliceArgs   (cmd.args);\n\tvar net;\n\tif (cmd.attrs.net) net = cmd.attrs.net[0];\n\tvar x   = parseFloat (cmd.attrs.at[0]);\n\tvar y   = parseFloat (cmd.attrs.at[1]);\n\t// what the f*** ???\n\tvar rot = \"R\" + ((parseFloat (cmd.attrs.at[2]) || 0) - (angle || 0));\n\tvar w   = parseFloat (cmd.attrs.size[0]);\n\tvar h   = parseFloat (cmd.attrs.size[1]);\n\n\tvar name  = cmd.args[0];\n\tvar type  = cmd.args[1];\n\tvar shape = cmd.args[2];\n\tif (name === \"np_thru_hole\" || name === \"smd\") {\n\t\tshape = cmd.args[1];\n\t\ttype  = cmd.args[0];\n\t\tname  = undefined;\n\t}\n\n\tif (type === \"smd\") {return {\n\t\tx1: x - w/2,\n\t\ty1: y - h/2,\n\t\tx2: x + w/2,\n\t\ty2: y + h/2,\n\t\trot: rot,\n\t\t//rot: \"R0\", // those seems already rotated\n\t\tname: name,\n\t\ttype: type,\n\t\tshape: shape,\n\t\tlayers: cmd.attrs.layers,\n\t\tnet: net\n\t}} else if (type === \"thru_hole\" || type === \"np_thru_hole\") {return {\n\t\tx: x,\n\t\ty: y,\n\t\tname: name,\n\t\ttype: type,\n\t\tshape: shape === 'rect' ? 'square' : shape,\n\t\tlayers: cmd.attrs.layers,\n\t\tnet: net,\n\t\t// drill can be ['<drill>'], or ['<shape=oval?>', '<drill>', '<drill-length>']\n\t\tdrill: cmd.attrs.drill ? (parseFloat(cmd.attrs.drill[0]) || parseFloat(cmd.attrs.drill[1])) : w,\n\t\tdiameter: w,\n\t\tdrillLength: cmd.attrs.drill ? parseFloat(cmd.attrs.drill[2]) : null,\n\t}}\n\n\tconsole.warn ('pad type %s is not supported', type, cmd);\n\treturn {};\n}\n\nKicadNewParser.prototype.parseModule = function (cmd) {\n\tcmd.attrs = this.extractAttrs (cmd.args);\n\tcmd.args  = this.spliceArgs   (cmd.args);\n\n\tvar pkg = {\n\t\tsmds: [],\n\t\twires: [],\n\t\ttexts: [],\n\t\t// bbox\n\t\tpads: [],\n\t\t// description\n\t\tpolys: [],\n\t\tholes: []\n\t};\n\n\tvar el = {\n\t\t'x'         : parseFloat (cmd.attrs.at[0]),\n\t\t'y'         : parseFloat (cmd.attrs.at[1]),\n\t\t'pkg'       : pkg,\n//\t\t'matrix'    : elemMatrix,\n//\t\t'mirror'    : elemRot.indexOf('M') == 0,\n//\t\t'smashed'   : elem.getAttribute('smashed') && (elem.getAttribute('smashed').toUpperCase() == 'YES'),\n\t\t'smashed': true,\n\t\t'absText': false,\n\t\t'attributes': {},\n\t\t'padSignals': {}\t\t\t//to be filled later\n\t};\n\n\tif (\"descr\" in cmd.attrs) {\n\t\tpkg.description = cmd.attrs.descr[0];\n\t}\n\n\tvar rotate = parseFloat (cmd.attrs.at[2]) || 0;\n\tel.rot = \"R\" + (-rotate); // WHY?\n\n\tcmd.attrs.fp_text.forEach (function (txtCmd) {\n\t\tvar txt = this.parseText ({name: \"fp_text\", args: txtCmd}, rotate);\n\t\ttxt.type = txtCmd[0];\n\t\ttxt.layer = this.eagleLayer (txt.layer).number;\n\t\tif (txt.type === \"reference\") {\n\t\t\ttxt.name = \"NAME\";\n\t\t\tel.name = txt.content;\n\t\t\tel.attributes.name = txt;\n\t\t\ttxt.font = \"vector\";\n\t\t} else if (txt.type === \"value\") {\n\t\t\ttxt.name = \"VALUE\";\n\t\t\tel.value = txt.content;\n\t\t\tel.attributes.value = txt;\n\t\t\ttxt.font = \"vector\";\n\t\t} else {\n\t\t\tconsole.warn (\"text type '%s' not processed:\", txt.type, txt);\n\t\t}\n\t}, this);\n\n\tif (cmd.attrs.fp_line) cmd.attrs.fp_line.forEach (function (lineCmd) {\n\t\tvar line = this.parseLine ({name: \"fp_line\", args: lineCmd});\n\t\tline.layer = this.eagleLayer (line.layer).number;\n\t\tpkg.wires.push (line);\n\t}, this);\n\n\tvar bbox = this.board.calcBBox (pkg.wires);\n\tpkg.bbox = bbox;\n\n\tif (cmd.attrs.fp_circle) cmd.attrs.fp_circle.forEach (function (arcCmd) {\n\t\tvar line = this.parseCircle ({name: \"fp_circle\", args: arcCmd});\n\t\tline.layer = this.eagleLayer (line.layer).number;\n\t\tpkg.wires.push (line);\n\t}, this);\n\n\tif (cmd.attrs.pad) cmd.attrs.pad.forEach (function (padCmd) {\n\t\tvar pad = this.parsePad ({name: \"pad\", args: padCmd}, rotate);\n\n\t\tpad.layer = this.eagleLayer (pad.layers ? pad.layers[0] : cmd.attrs.layer[0]).number;\n\n\t\tif (pad.type === \"smd\") {\n\t\t\tpkg.smds.push (pad);\n\t\t} else if (pad.type === \"thru_hole\") {\n\t\t\t// TODO: support shapes\n\t\t\tpkg.pads.push (pad);\n\t\t} else if (pad.type === \"np_thru_hole\") {\n\t\t\t// TODO: support shapes\n\t\t\tpkg.pads.push (pad);\n\t\t} else {\n\t\t\tconsole.warn (\"pad not processed:\", pad);\n\t\t}\n\t}, this);\n\n\n\t// TODO: recheck\n\tif (cmd.attrs.layer[0] === \"Back\" || cmd.attrs.layer[0] === \"B.Cu\") {\n\t\t// el.rot = \"M\"+el.rot;\n\t}\n\n\tel.matrix = this.board.matrixForRot (el.rot);\n\n\treturn el;\n\n\tvar net = cmd.attrs.net[0];\n\tvar viaDrill = this.netClass[this.netByNumber[net].className].via_drill;\n\tvar via = {\n\t\tx: parseFloat (cmd.attrs.at[0]),\n\t\ty: parseFloat (cmd.attrs.at[1]),\n\t\tdrill: viaDrill,\n\t\t//drill: parseFloat (cmd.attrs.size[0]),\n\t\tlayers: cmd.attrs.layers\n\t\t// shape?\n\t};\n\treturn via;\n}\n\n\nKicadNewParser.prototype.cmdDone = function () {\n\tvar contextPath = this.context.map (function (cmd) {return cmd.name}).join (\">\");\n\t// console.log (contextPath, this.cmd);\n\n\tif (contextPath !== \"kicad_pcb\") {\n\t\treturn;\n\t}\n\n\t// layers\n\tif (this.cmd.name === \"layers\") {\n\n\t\tvar signalLayers = [];\n\t\tthis.cmd.args.forEach (function (layer) {\n\t\t\tvar layerId = parseInt (layer.name);\n\t\t\tif (layer.args[1] === 'signal')\n\t\t\t\tsignalLayers[layerId] = true;\n\t\t});\n\n\t\tvar maxSignalLayer = signalLayers.length - 1;\n\n\t\tthis.cmd.args.forEach (function (layer) {\n\n\t\t\t// Layer names can be changed\n\t\t\t//console.log (layer);\n\t\t\tvar layerId = parseInt (layer.name);\n\t\t\tvar layerName = layer.args[0]; // F.Cu, B.Cu and so on\n\t\t\tvar layerType = layer.args[1]; // user, signal, mixed\n\t\t\tvar layerShow = layer.args[2] === 'hide' ? false : true; // 'hide' or nothin\n\n\t\t\tvar eagleLayer = this.eagleLayer (layerName);\n\n\t\t\tif (!eagleLayer && layerId >= 0 && layerId <= 31) {\n\t\t\t\tif (layerId === 0) {\n\t\t\t\t\tlayerMaps[layerName] = \"Top\";\n\t\t\t\t\teagleLayer = this.eagleLayer (\"Front\");\n\t\t\t\t} else if (layerId === maxSignalLayer) {\n\t\t\t\t\tlayerMaps[layerName] = \"Bottom\";\n\t\t\t\t\teagleLayer = this.eagleLayer (\"Back\");\n\t\t\t\t} else if (layerId > 0 && layerId < maxSignalLayer) {\n\t\t\t\t\tlayerMaps[layerName] = \"Inner\" + (layerId + 1);\n\t\t\t\t\teagleLayer = this.eagleLayer (\"Inner\" + (layerId + 1));\n\t\t\t\t} else if (!eagleLayer) {\n\t\t\t\t\tconsole.warn (\"(Maybe unknown layer) We currently not supporting parsing files with more than 16 signal layers, but found layer with id = %d\", layerId, layer.args[0]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!eagleLayer) return;\n\n\t\t\t// TODO: make a parser interface for this\n\t\t\tthis.board.eagleLayersByName[eagleLayer.name] = eagleLayer;\n\t\t\tthis.board.layersByNumber[eagleLayer.number]  = eagleLayer;\n\t\t}, this);\n\t\t// console.log (this.cmd, line);\n\t}\n\n\t// nets\n\tif (this.cmd.name === \"net\") {\n\t\tvar net = {number: this.cmd.args[0], name: this.cmd.args[1]};\n\t\tthis.netByName[net.name] = this.netByNumber[net.number] = {name: net.name};\n\t}\n\n\tif (this.cmd.name === \"net_class\") {\n\t\tvar className = this.cmd.args[0],\n\t\t\tclassDesc = this.cmd.args[1];\n\n\t\tvar netClass = {\n\t\t\tclassName: className,\n\t\t\tclassDesc: classDesc\n\t\t};\n\n\t\tfor (var i = 2; i < this.cmd.args.length; i++) {\n\t\t\tvar netCmd = this.cmd.args[i];\n\t\t\tif (netCmd.name.match (/u?via_(?:dia|drill)/)) {\n\t\t\t\tnetClass[netCmd.name] = parseFloat (netCmd.args[0]);\n\t\t\t} else if (netCmd.name === \"add_net\") {\n\t\t\t\tthis.netByName[netCmd.args[0]].className = className;\n\t\t\t}\n\t\t}\n\n\t\tthis.netClass[className] = netClass;\n\t}\n\n\n\t// regular wires\n\tif (this.cmd.name === \"gr_line\" || this.cmd.name === \"gr_arc\") {\n\t\tvar line = this.parseLine (this.cmd);\n\t\t// console.log (this.cmd, line);\n\t\tvar eagleLayerNumber = this.eagleLayer (line.layer).number;\n\t\tif (!this.board.plainWires[eagleLayerNumber]) this.board.plainWires[eagleLayerNumber] = [];\n\t\tthis.board.plainWires[eagleLayerNumber].push (line);\n\t}\n\n\t// signal wires\n\tif (this.cmd.name === \"segment\" || this.cmd.name === \"via\") {\n\t\tvar entity;\n\t\tvar entType;\n\t\tif (this.cmd.name === \"segment\") {\n\t\t\tentity = this.parseLine (this.cmd);\n\t\t\tentType = \"wires\";\n\t\t} else {\n\t\t\tentity = this.parseVia (this.cmd);\n\t\t\tentType = \"vias\";\n\t\t}\n\t\tvar netNum = this.cmd.attrs.net;\n\t\tvar netName = this.netByNumber[netNum].name;\n\t\t// console.log (this.cmd, line, netName);\n\t\tif (!this.board.signalItems[netName]) this.board.signalItems[netName] = {};\n\t\tvar signalLayerItems = this.board.signalItems[netName];\n\t\tvar eagleLayerNumber;\n\t\tif (entity.layers) {\n\t\t\teagleLayerNumber = entity.layers.map (function (layer) {\n\t\t\t\treturn this.eagleLayer (layer).number;\n\t\t\t}, this).join (\"-\");\n\t\t} else {\n\t\t\teagleLayerNumber = this.eagleLayer (entity.layer).number;\n\t\t}\n\n\t\tif (netNum) {\n\t\t\tif (!signalLayerItems[eagleLayerNumber])\n\t\t\t\tsignalLayerItems[eagleLayerNumber] = {wires: [], vias: []};\n\t\t\tsignalLayerItems[eagleLayerNumber][entType].push (entity);\n\t\t} else {\n\t\t\tif (!this.board.plainWires[eagleLayerNumber])\n\t\t\t\tthis.board.plainWires[eagleLayerNumber] = [];\n\t\t\tthis.board.plainWires[eagleLayerNumber].push (entity);\n\t\t}\n\n\t}\n\n\tif (this.cmd.name === \"gr_circle\") {\n\t\tvar circle = this.parseCircle (this.cmd);\n\t\tvar eagleLayerNumber = this.eagleLayer (circle.layer).number;\n\t\t// console.log (this.cmd, text, this.cmd.attrs.effects, eagleLayerNumber);\n\t\tif (!this.board.plainWires[eagleLayerNumber]) this.board.plainWires[eagleLayerNumber] = [];\n\t\tthis.board.plainWires[eagleLayerNumber].push (circle);\n\t}\n\n\tif (this.cmd.name === \"gr_text\") {\n\t\tvar text = this.parseText (this.cmd);\n\t\tvar eagleLayerNumber = this.eagleLayer (text.layer).number;\n\t\t// console.log (this.cmd, text, this.cmd.attrs.effects, eagleLayerNumber);\n\t\tif (!this.board.plainTexts[eagleLayerNumber]) this.board.plainTexts[eagleLayerNumber] = [];\n\t\tthis.board.plainTexts[eagleLayerNumber].push (text);\n\t}\n\n\n\tif (this.cmd.name === \"module\") {\n\t\tvar el = this.parseModule (this.cmd);\n\t\tthis.board.elements[Object.keys (this.board.elements).length] = el;\n\t\t// var eagleLayerNumber = this.eagleLayer (text.layer).number;\n\t\t// console.log (this.cmd, text, this.cmd.attrs.effects, eagleLayerNumber);\n\t\t// if (!this.board.plainTexts[eagleLayerNumber]) this.board.plainTexts[eagleLayerNumber] = [];\n\t\t// this.board.plainTexts[eagleLayerNumber].push (text);\n\t}\n\n\treturn;\n\n\tif (contextPath === \"kicad_pcb>segment\") {\n\n\t}\n\tif (contextPath === \"kicad_pcb>module\") {\n\n\t}\n\tif (contextPath === \"kicad_pcb>zone\") {\n\n\t}\n}\n\n\n//if (typeof process !== \"undefined\") {\n//\tvar kp = new KicadNewParser ();\n//\tvar fs = require (\"fs\");\n//\tkp.parse (fs.readFileSync (process.argv[2]));\n//}\n\nreturn KicadNewParser;\n\n}));\n"]}