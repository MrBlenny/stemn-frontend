'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _axios = require('axios');

var _axios2 = _interopRequireDefault(_axios);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var library = {
  authenticate: authenticate,
  getViewStatus: getViewStatus,
  isWebGlSupported: isWebGlSupported,
  render: render
};

exports.default = library;

////////////////////////////////////////////

function render(_ref) {
  var projectId = _ref.projectId;
  var fileId = _ref.fileId;
  var revisionId = _ref.revisionId;

  return (0, _axios2.default)({
    method: 'GET',
    url: '/api/v1/remote/render/' + projectId + '/' + fileId,
    params: {
      revisionId: revisionId
    }
  });
}

function authenticate() {
  return (0, _axios2.default)({
    method: 'POST',
    url: '/api/v1/auth/autodesk'
  }).then(function (response) {
    library.accessToken = response.data.token;
    return response;
  });
}

function getViewStatus(urn64) {
  return (0, _axios2.default)({
    method: 'GET',
    url: 'https://developer.api.autodesk.com/viewingservice/v1/' + urn64 + '/status',
    headers: {
      Authorization: 'Bearer ' + library.accessToken
    }
  });
}

function isWebGlSupported(return_context) {
  if (!!window.WebGLRenderingContext) {
    var canvas = document.createElement("canvas"),
        names = ["webgl", "experimental-webgl", "moz-webgl", "webkit-3d"],
        context = false;

    for (var i = 0; i < 4; i++) {
      try {
        context = canvas.getContext(names[i]);
        if (context && typeof context.getParameter == "function") {
          // WebGL is enabled
          if (return_context) {
            // return WebGL object if the function's argument is present
            return { name: names[i], gl: context };
          }
          // else, return just true
          return true;
        }
      } catch (e) {}
    }
    // WebGL is supported, but disabled
    return false;
  }
  // WebGL not supported
  return false;
}
module.exports = exports['default'];