{"version":3,"sources":["app\\renderer\\preview\\pages\\PreviewPage\\PreviewPage.jsx"],"names":[],"mappings":"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","file":"PreviewPage.jsx","sourceRoot":"C:/Users/david/repositories/stemn-electron-2","sourcesContent":["// Container Core\nimport { bindActionCreators } from 'redux';\nimport { connect } from 'react-redux';\n\n// Container Actions\n\n// Component Core\nimport React from 'react';\n\n// Styles\nimport classNames from 'classnames';\n\n// Functions\nimport { orderBy, has }        from 'lodash';\nimport moment from 'moment';\n\n// Actions\nimport * as FilesActions from 'app/renderer/main/modules/Files/Files.actions.js';\nimport * as SyncTimelineActions from 'app/shared/modules/SyncTimeline/SyncTimeline.actions.js';\n\n// Sub Components\nimport FileCompareInner   from 'app/renderer/main/modules/FileCompare/FileCompareInner/FileCompareInner.jsx';\nimport Timeline           from 'app/renderer/main/modules/Timeline/Timeline.jsx';\nimport DragResize         from 'app/renderer/main/modules/DragResize/DragResize.jsx';\nimport FileBreadCrumbs    from 'app/renderer/main/modules/FileList/components/FileBreadCrumbs.jsx'\nimport FileCompareMenu    from 'app/renderer/main/modules/FileCompare/FileCompareMenu/FileCompareMenu.jsx';\nimport LoadingOverlay     from 'app/renderer/main/components/Loading/LoadingOverlay/LoadingOverlay.jsx';\nimport TimelineVertical   from 'app/shared/modules/TimelineVertical/TimelineVertical.jsx';\nimport SimpleTable        from 'app/shared/modules/Tables/SimpleTable/SimpleTable.jsx';\nimport SectionTitle       from 'app/shared/modules/Titles/SectionTitle/SectionTitle.jsx';\n\n// Styles\nimport classes from './PagePreview.css';\n\n///////////////////////////////// COMPONENT /////////////////////////////////\n\nexport const InnerComponent = React.createClass({\n  getInitialState () {\n    return {\n      selected1: this.props.syncTimeline.data[0],\n      selected2: null,\n      lastSelected: 1,\n      mode: 'single'\n    }\n  },\n  onSelect(response){\n    if(this.state.mode == 'single'){\n      this.setState({\n        selected1: response,\n        lastSelected: 1\n      })\n    }\n    else{\n      if(this.state.lastSelected == 1){\n        this.setState({\n          selected2: response,\n          lastSelected: 2\n        })\n      }\n      else{\n        this.setState({\n          selected1: response,\n          lastSelected: 1\n        })\n      }\n    }\n  },\n  changeMode(mode){\n    this.setState({mode: mode})\n  },\n  clickCrumb({file}){\n    console.log(file);\n  },\n  isSelected(item){\n    const selected1 = has(this.state, 'selected1.data.revisionId') ? item.data.revisionId == this.state.selected1.data.revisionId : false;\n    const selected2 = has(this.state, 'selected2.data.revisionId') ? item.data.revisionId == this.state.selected2.data.revisionId : false;\n    return this.state.mode == 'single' ? selected1 : selected1 || selected2;\n  },\n  render() {\n    const { fileMeta, syncTimeline } = this.props;\n    const { mode, selected1, selected2 } = this.state;\n    const items = mode == 'single' ? [selected1, selected1] : orderBy([selected1, selected2], item => (new Date(item.timestamp)).getTime());\n\n    const revisions = syncTimeline && syncTimeline.data ? syncTimeline.data.filter(item => item.event == 'revision') : [];\n\n    return (\n      <div className=\"layout-column flex\">\n        <div className={classes.header + ' layout-row layout-align-start-center'}>\n          <div className=\"flex\">{fileMeta && fileMeta.data ? <FileBreadCrumbs meta={fileMeta.data} clickFn={this.clickCrumb}/> : ''}</div>\n          <FileCompareMenu\n            file1={items[1].data}\n            file2={items[0].data}\n            revisions={revisions}\n            mode={mode}\n            changeMode={this.changeMode}\n          />\n        </div>\n        <div className=\"layout-row flex\">\n          <div className=\"layout-column flex\">\n            <FileCompareInner\n              project={fileMeta.data.project}\n              file1={items[1].data}\n              file2={items[0].data}\n              mode={mode} />\n            <Timeline className={classes.timeline}\n              items={revisions}\n              onSelect={this.onSelect}\n              isSelected={this.isSelected}\n              preferPlace=\"above\"/>\n          </div>\n          <DragResize side=\"left\" width=\"450\" widthRange={[0, 450]} className=\"layout-column\">\n            <aside className={classes.sidebar + ' flex'} style={{minWidth: '400px', overflowY: 'auto'}}>\n              <SectionTitle style={{marginBottom: '15px'}}>Meta</SectionTitle>\n              <SimpleTable>\n                <tr><td>Name</td><td>{fileMeta.data.name}</td></tr>\n                <tr><td>Size</td><td>{fileMeta.data.size}</td></tr>\n                <tr><td>Last modified</td><td>{moment(fileMeta.data.modified).fromNow()}</td></tr>\n                <tr><td>Revisions</td><td>{revisions.length}</td></tr>\n              </SimpleTable>\n              <SectionTitle style={{margin: '30px 0'}}>Timeline</SectionTitle>\n              <TimelineVertical\n                items={syncTimeline && syncTimeline.data ? syncTimeline.data : []}\n              />\n            </aside>\n          </DragResize>\n        </div>\n      </div>\n    );\n  }\n});\n\nexport const Component = React.createClass({\n\n  // Mounting\n  onMount(nextProps, prevProps){\n    const { revisionId, fileId, projectId} = nextProps.params;\n\n    // If we do not yet have the meta, get it:\n    if(!nextProps.fileMeta || !nextProps.fileMeta.data && !nextProps.fileMeta.loading){\n      nextProps.filesActions.getMeta({fileId, revisionId});\n    }\n\n    // If we don't have the timeline, get it:\n    if(!nextProps.syncTimeline || !nextProps.syncTimeline.data && !nextProps.syncTimeline.loading){\n      nextProps.syncTimelineActions.fetchTimeline({projectId, fileId })\n    }\n  },\n  componentWillMount() { this.onMount(this.props) },\n\n  render() {\n    const { fileMeta, syncTimeline } = this.props;\n    return (\n      <div className=\"layout-column flex\">\n        {\n          fileMeta && syncTimeline && syncTimeline.data\n          ? <InnerComponent fileMeta={fileMeta} syncTimeline={syncTimeline}/>\n          : null\n        }\n        <LoadingOverlay show={!fileMeta || !syncTimeline}/>\n      </div>\n    );\n  }\n});\n\n\n///////////////////////////////// CONTAINER /////////////////////////////////\n\nfunction mapStateToProps({files, syncTimeline}, {params}) {\n  const cacheKey = `${params.fileId}-${params.revisionId}`\n  return {\n    fileMeta: files.fileMeta[cacheKey],\n    syncTimeline: syncTimeline[params.fileId]\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    filesActions: bindActionCreators(FilesActions, dispatch),\n    syncTimelineActions: bindActionCreators(SyncTimelineActions, dispatch),\n  }\n}\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Component);\n"]}