'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _index = require('C:\\Users\\david\\repositories\\stemn-electron-2\\node_modules\\redbox-react\\lib\\index.js');

var _index2 = _interopRequireDefault(_index);

var _index3 = require('C:\\Users\\david\\repositories\\stemn-electron-2\\node_modules\\react-transform-catch-errors\\lib\\index.js');

var _index4 = _interopRequireDefault(_index3);

var _react2 = require('react');

var _react3 = _interopRequireDefault(_react2);

var _index5 = require('C:\\Users\\david\\repositories\\stemn-electron-2\\node_modules\\react-transform-hmr\\lib\\index.js');

var _index6 = _interopRequireDefault(_index5);

var _FileCompareCollapse = require('./FileCompareCollapse.css');

var _FileCompareCollapse2 = _interopRequireDefault(_FileCompareCollapse);

var _TogglePanel = require('app/renderer/main/components/Panels/TogglePanel/TogglePanel.jsx');

var _TogglePanel2 = _interopRequireDefault(_TogglePanel);

var _DragResize = require('app/renderer/main/modules/DragResize/DragResize.jsx');

var _DragResize2 = _interopRequireDefault(_DragResize);

var _FileCompareMenu = require('app/renderer/main/modules/FileCompare/FileCompareMenu/FileCompareMenu.jsx');

var _FileCompareMenu2 = _interopRequireDefault(_FileCompareMenu);

var _FileCompareInner = require('app/renderer/main/modules/FileCompare/FileCompareInner/FileCompareInner.jsx');

var _FileCompareInner2 = _interopRequireDefault(_FileCompareInner);

var _Timeline = require('app/renderer/main/modules/Timeline/Timeline.jsx');

var _Timeline2 = _interopRequireDefault(_Timeline);

var _lodash = require('lodash');

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _components = {
  _component: {}
};

var _CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformHmrLibIndexJs2 = (0, _index6.default)({
  filename: 'C:/Users/david/repositories/stemn-electron-2/app/renderer/main/modules/FileCompare/FileCompareCollapse/FileCompareCollapse.jsx',
  components: _components,
  locals: [module],
  imports: [_react3.default]
});

var _CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformCatchErrorsLibIndexJs2 = (0, _index4.default)({
  filename: 'C:/Users/david/repositories/stemn-electron-2/app/renderer/main/modules/FileCompare/FileCompareCollapse/FileCompareCollapse.jsx',
  components: _components,
  locals: [],
  imports: [_react3.default, _index2.default]
});

function _wrapComponent(id) {
  return function (Component) {
    return _CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformHmrLibIndexJs2(_CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformCatchErrorsLibIndexJs2(Component, id), id);
  };
}

exports.default = _wrapComponent('_component')(_react3.default.createClass({
  // Mounting
  onMount: function onMount(nextProps, prevProps) {
    if (!prevProps || nextProps.file != prevProps.file) {
      this.setState({
        selected1: nextProps.file.revisions[0],
        selected2: nextProps.file.revisions[1],
        lastSelected: 1,
        mode: nextProps.file.revisions[0] && nextProps.file.revisions[1] ? 'sideBySide' : 'single'
      });
    }
  },
  componentWillMount: function componentWillMount() {
    this.onMount(this.props);
  },
  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
    this.onMount(nextProps, this.props);
  },
  onSelect: function onSelect(response) {
    if (this.state.mode == 'single') {
      this.setState({
        selected1: response,
        lastSelected: 1
      });
    } else {
      if (this.state.lastSelected == 1) {
        this.setState({
          selected2: response,
          lastSelected: 2
        });
      } else {
        this.setState({
          selected1: response,
          lastSelected: 1
        });
      }
    }
  },
  changeMode: function changeMode(mode) {
    this.setState({ mode: mode });
  },
  isSelected: function isSelected(item) {
    var selected1 = (0, _lodash.has)(this.state, 'selected1.data.revisionId') ? item.data.revisionId == this.state.selected1.data.revisionId : false;
    var selected2 = (0, _lodash.has)(this.state, 'selected2.data.revisionId') ? item.data.revisionId == this.state.selected2.data.revisionId : false;
    return this.state.mode == 'single' ? selected1 : selected1 || selected2;
  },
  render: function render() {
    var _props = this.props;
    var file = _props.file;
    var project = _props.project;
    var _state = this.state;
    var mode = _state.mode;
    var selected1 = _state.selected1;
    var selected2 = _state.selected2;

    console.log(selected1, selected2);
    var items = mode == 'single' ? [selected1, selected1] : (0, _lodash.orderBy)([selected1, selected2], function (item) {
      return new Date(item.timestamp).getTime();
    });
    return _react3.default.createElement(
      _TogglePanel2.default,
      null,
      _react3.default.createElement(
        'div',
        null,
        file.data.path
      ),
      _react3.default.createElement(_FileCompareMenu2.default, {
        file1: items[1].data,
        file2: items[0].data,
        revisions: file.revisions,
        mode: mode,
        changeMode: this.changeMode,
        enablePreview: true
      }),
      _react3.default.createElement(
        _DragResize2.default,
        { side: 'bottom', height: '500', heightRange: [0, 1000], className: 'layout-column flex' },
        _react3.default.createElement(_FileCompareInner2.default, {
          project: project.data,
          file1: items[1].data,
          file2: items[0].data,
          mode: mode }),
        _react3.default.createElement(_Timeline2.default, { className: _FileCompareCollapse2.default.timeline,
          size: 'sm',
          onSelect: this.onSelect,
          isSelected: this.isSelected,
          items: file.revisions,
          preferPlace: 'above' })
      )
    );
  }
}));
module.exports = exports['default'];