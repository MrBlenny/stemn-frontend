{"version":3,"sources":["app\\renderer\\main\\modules\\Files\\PreviewFile\\PreviewCad\\PreviewCad.jsx"],"names":[],"mappings":"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","file":"PreviewCad.jsx","sourceRoot":"C:/Users/david/repositories/stemn-electron-2","sourcesContent":["import React from 'react';\nimport Promise from 'es6-promise'\n\nimport previewCadUtils from './PreviewCad.utils.js';\n\nimport AutodeskViewer from './AutodeskViewer/AutodeskViewer';\nimport LoadingOverlay from 'app/renderer/main/components/Loading/LoadingOverlay/LoadingOverlay.jsx';\nimport modelLocked    from 'app/renderer/assets/images/pure-vectors/model-locked.svg';\nimport modelGear      from 'app/renderer/assets/images/pure-vectors/model-gear.svg';\n\nexport default React.createClass({\n  checkStatusInterval: null,\n  getInitialState () {\n    return {\n      status: 'pending',\n      urn: '',\n      token: '',\n    }\n  },\n    // Mounting\n  onMount (nextProps, prevProps) {\n    if(!prevProps || nextProps.fileMeta != prevProps.fileMeta){\n      this.init(nextProps);\n    }\n  },\n  componentDidMount() { this.onMount(this.props) },\n  componentWillReceiveProps(nextProps) { this.onMount(nextProps, this.props)},\n\n  componentWillUnmount(){\n    clearInterval(this.checkStatusInterval);\n  },\n  init(props){\n    const { fileMeta } = props;\n\n    this.setState({status: 'pending'})\n    clearInterval(this.checkStatusInterval); // Clear interval if we re-init\n\n    if(previewCadUtils.isWebGlSupported()){\n      Promise.all([\n        previewCadUtils.render({\n          projectId  : fileMeta.project._id,\n          fileId     : fileMeta.fileId,\n          revisionId : fileMeta.revisionId,\n        }),\n        previewCadUtils.authenticate()\n      ]).then(response => {\n        // Apply to state\n        this.setState({urn: response[0].data.urn, token: response[1].data.token});\n\n        // Begin to check status\n        this.checkStatusInterval = setInterval(this.checkStatus, 700);\n      }).catch(error => console.log(error))\n    }\n    else{\n      this.setState({status:'disabled'});\n    }\n  },\n  checkStatus(){\n    previewCadUtils.getViewStatus(this.state.urn).then((response) =>{\n      this.setState({status: response.data.status})\n      if(this.state.status == 'success'){\n        clearInterval(this.checkStatusInterval)\n      }\n      else if(this.state.status == 'failed'){\n        clearInterval(this.checkStatusInterval)\n      }\n    }).catch((error)=>{\n      clearInterval(this.checkStatusInterval)\n      this.setState({status: 'failed'})\n    })\n  },\n  render() {\n    const { status, token, urn } = this.state;\n    if(status == 'success'){\n      return <AutodeskViewer urn={urn} token={token} />\n    }\n    else if(status == 'failed'){\n      return (\n        <div className=\"layout-column layout-align-center-center flex\">\n          <img style={{width: '100px'}} src={modelGear}/>\n          <div className=\"text-title-4\" style={{marginBottom: '10px'}}>Something went wrong.</div>\n          <div className=\"text-title-5\">Your model could not be processed for viewing.</div>\n        </div>\n      )\n    }\n    else if(status == 'disabled'){\n      return (\n        <div className=\"layout-column layout-align-center-center flex text-center\">\n          <img style={{width: '100px'}} src={modelLocked}/>\n          <div className=\"text-title-4\" style={{marginBottom: '10px'}}>WebGl is disabled or not supported.</div>\n          <div className=\"text-title-5\">Visit <a className=\"link-primary\" href=\"http://get.webgl.org/\" target=\"_blank\">webgl.org</a> for more.</div>\n        </div>\n      )    }\n    else if(status == 'pending') {\n      return <div className=\"rel-box flex\"><LoadingOverlay show={true}>Processing File...</LoadingOverlay></div>\n    }\n    else{\n      return null\n    }\n  }\n})\n"]}