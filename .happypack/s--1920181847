'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Component = undefined;

var _index = require('C:\\Users\\david\\repositories\\stemn-electron-2\\node_modules\\redbox-react\\lib\\index.js');

var _index2 = _interopRequireDefault(_index);

var _index3 = require('C:\\Users\\david\\repositories\\stemn-electron-2\\node_modules\\react-transform-catch-errors\\lib\\index.js');

var _index4 = _interopRequireDefault(_index3);

var _react2 = require('react');

var _react3 = _interopRequireDefault(_react2);

var _index5 = require('C:\\Users\\david\\repositories\\stemn-electron-2\\node_modules\\react-transform-hmr\\lib\\index.js');

var _index6 = _interopRequireDefault(_index5);

var _redux = require('redux');

var _reactRedux = require('react-redux');

var _reactReduxForm = require('react-redux-form');

var _EditorActions = require('./Editor.actions.js');

var editorActions = _interopRequireWildcard(_EditorActions);

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

var _Editor = require('./Editor.css');

var _Editor2 = _interopRequireDefault(_Editor);

var _index7 = require('app/renderer/main/modules/Mentions/MentionsInput/index.js');

var _UserAvatar = require('app/renderer/main/components/Avatar/UserAvatar/UserAvatar.jsx');

var _UserAvatar2 = _interopRequireDefault(_UserAvatar);

var _autosuggestHighlight = require('autosuggest-highlight');

var _autosuggestHighlight2 = _interopRequireDefault(_autosuggestHighlight);

var _Checkbox = require('app/renderer/main/components/Input/Checkbox/Checkbox');

var _Checkbox2 = _interopRequireDefault(_Checkbox);

var _getUuid = require('app/shared/helpers/getUuid.js');

var _getUuid2 = _interopRequireDefault(_getUuid);

var _axios = require('axios');

var _axios2 = _interopRequireDefault(_axios);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _objectDestructuringEmpty(obj) { if (obj == null) throw new TypeError("Cannot destructure undefined"); }

var _components = {
  _component: {}
};

var _CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformHmrLibIndexJs2 = (0, _index6.default)({
  filename: 'C:/Users/david/repositories/stemn-electron-2/app/renderer/main/modules/Editor/Editor.jsx',
  components: _components,
  locals: [module],
  imports: [_react3.default]
});

var _CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformCatchErrorsLibIndexJs2 = (0, _index4.default)({
  filename: 'C:/Users/david/repositories/stemn-electron-2/app/renderer/main/modules/Editor/Editor.jsx',
  components: _components,
  locals: [],
  imports: [_react3.default, _index2.default]
});

function _wrapComponent(id) {
  return function (Component) {
    return _CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformHmrLibIndexJs2(_CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformCatchErrorsLibIndexJs2(Component, id), id);
  };
} // Container Core


// Container Actions


// Component Core


// Styles


// Sub Components


/////////////////////////////////////////////////////////////////////////////
///////////////////////////////// COMPONENT /////////////////////////////////
/////////////////////////////////////////////////////////////////////////////

//export const Component = React.createClass({
//  getInitialState () {
//    return {
//      value: this.props.value,
//    }
//  },
//  componentWillReceiveProps(nextProps) {
//    if(nextProps.value != this.props.value){
//      this.setState({ value: nextProps.value })
//    }
//  },
//
//  handleChange(event){
//    this.props.dispatch(actions.change(this.props.model, event.target.value));
//  },
//  render() {
//    const { className, model, value } = this.props;
//
//    return (
//      <textarea value={this.state.value}
//       onChange={this.handleChange}
//       className={classNames(classes.editor, className)} />
//    )
//  }
//});


var Component = exports.Component = _wrapComponent('_component')(_react3.default.createClass({
  displayName: 'Component',
  getInitialState: function getInitialState() {
    return {
      value: this.props.value
    };
  },
  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
    // Update the internal state if it differs from the redux state
    if (nextProps.value != this.state.value) {
      this.setState({ value: nextProps.value });
    }
  },
  handleChange: function handleChange(event, value) {
    this.setState({ value: value });
    this.props.dispatch(_reactReduxForm.actions.change(this.props.model, value));
  },

  displayTransform: function displayTransform(id, display, type) {
    var name = display.split('[')[1].split(']')[0]; // Get the name (from between the square brackets)
    if (type == 'user') {
      return "@" + name;
    } else if (type == 'task') {
      return '#' + name;
    } else if (type == 'task-complete') {
      return '#' + name + ' (completed)';
    }
  },
  userRenderSuggestion: function userRenderSuggestion(entry, search, highlightedDisplay, index) {
    var matches = _autosuggestHighlight2.default.match(entry.name, search);
    var parts = _autosuggestHighlight2.default.parse(entry.name, matches);
    return _react3.default.createElement(
      'div',
      { className: 'layout-row layout-align-start-center' },
      _react3.default.createElement(_UserAvatar2.default, { picture: entry.picture }),
      _react3.default.createElement(
        'div',
        { style: { marginLeft: '10px' }, className: 'flex' },
        parts.map(function (part, index) {
          var className = part.highlight ? 'text-primary' : null;
          return _react3.default.createElement(
            'span',
            { className: className, key: index },
            part.text
          );
        })
      )
    );
  },
  userData: function userData(search, callback) {
    return (0, _axios2.default)({
      url: '/api/v1/search',
      method: 'GET',
      params: {
        type: 'user',
        key: 'name',
        value: search,
        size: 20,
        match: 'regex'
      }
    }).then(function (response) {
      response.data.forEach(function (item) {
        item.id = (0, _getUuid2.default)(); // Get a random mention id
        item.display = '[' + item.name + '](' + item._id; // Create the display
      });
      callback(response.data);
    });
  },

  taskRenderSuggestion: function taskRenderSuggestion(entry, search, highlightedDisplay, index) {
    var matches = _autosuggestHighlight2.default.match(entry.name, search);
    var parts = _autosuggestHighlight2.default.parse(entry.name, matches);
    return _react3.default.createElement(
      'div',
      { className: 'layout-row layout-align-start-center' },
      _react3.default.createElement(_Checkbox2.default, { circle: true }),
      _react3.default.createElement(
        'div',
        { style: { marginLeft: '10px', marginBottom: '2px' }, className: 'flex' },
        parts.map(function (part, index) {
          var className = part.highlight ? 'text-primary' : null;
          return _react3.default.createElement(
            'span',
            { className: className, key: index },
            part.text
          );
        })
      )
    );
  },
  render: function render() {
    var className = this.props.className;

    return _react3.default.createElement(
      _index7.MentionsInput,
      {
        className: (0, _classnames2.default)(_Editor2.default.editor, className),
        placeholder: 'Detailed Description',
        value: this.state.value,
        displayTransform: this.displayTransform,
        markup: '@__display__:__type__:__id__)' // format @[username](userName:mentionType:mentionId)
        , onChange: this.handleChange },
      _react3.default.createElement(_index7.Mention, {
        trigger: '@',
        type: 'user',
        data: this.userData,
        renderSuggestion: this.userRenderSuggestion,
        style: { background: 'rgba(68, 154, 211, 0.6)' }
      }),
      _react3.default.createElement(_index7.Mention, {
        trigger: '#',
        type: 'task',
        data: this.userData,
        renderSuggestion: this.taskRenderSuggestion,
        style: { background: 'rgba(68, 211, 95, 0.3)' }
      }),
      _react3.default.createElement(_index7.Mention, {
        trigger: '#',
        type: 'task-complete',
        data: this.userData,
        renderSuggestion: this.taskRenderSuggestion,
        style: { background: 'rgba(68, 211, 95, 0.3)' }
      })
    );
  }
}));

/////////////////////////////////////////////////////////////////////////////
///////////////////////////////// CONTAINER /////////////////////////////////
/////////////////////////////////////////////////////////////////////////////

function mapStateToProps(_ref) {
  _objectDestructuringEmpty(_ref);

  return {};
}

function mapDispatchToProps(dispatch) {
  return {
    EditorActions: (0, _redux.bindActionCreators)(editorActions, dispatch),
    dispatch: dispatch
  };
}

exports.default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(Component);