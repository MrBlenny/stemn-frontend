{"version":3,"sources":["app\\renderer\\assets\\other\\gerber\\js\\ObjectControls.js"],"names":[],"mappings":"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","file":"ObjectControls.js","sourceRoot":"C:/Users/david/repositories/stemn-electron-2","sourcesContent":["/**\n * @author Eberhard Graether / http://egraether.com/\n * @note Edited by eddyb to provide object-centered controls instead of camera-centered.\n */\n\nexport default ObjectControls;\n\nfunction ObjectControls ( object, domElement, globalInstances) {\n\n    THR51.EventTarget.call( this );\n\n    var _this = this,\n    STATE = { NONE : -1, ROTATE : 0, ZOOM : 1, PAN : 2 };\n\n    this.object = object;\n    this.domElement = ( domElement !== undefined ) ? domElement : document;\n\n    // API\n\n    this.enabled = true;\n\n    this.screen = { width: window.innerWidth, height: window.innerHeight, offsetLeft: 0, offsetTop: 0 };\n    this.radius = ( this.screen.width + this.screen.height ) / 4;\n\n    this.rotateSpeed = 1.0;\n    this.zoomSpeed = 1.2;\n    this.panSpeed = 0.3;\n\n    this.noRotate = false;\n    this.noZoom = false;\n    this.noPan = false;\n\n    this.staticMoving = false;\n    this.dynamicDampingFactor = 0.2;\n\n    this.minDistance = 0;\n    this.maxDistance = Infinity;\n\n    this.keys = [ 65 /*A*/, 83 /*S*/, 68 /*D*/ ];\n\n    this.mouseState = STATE.NONE;\n\n    // internals\n\n    var lastPosition = new THR51.Vector3();\n\n    var _keyPressed = false,\n\n    //_eye = new THR51.Vector3(),\n\n    _rotateStart = new THR51.Vector3(),\n    _rotateEnd = new THR51.Vector3(),\n\n    _zoomStart = new THR51.Vector2(),\n    _zoomEnd = new THR51.Vector2(),\n\n    _panStart = new THR51.Vector2(),\n    _panEnd = new THR51.Vector2();\n\n\n    // methods\n\n    this.handleEvent = function ( event ) {\n        if ( typeof this[ event.type ] == 'function' ) {\n            this[ event.type ]( event );\n        }\n\n    };\n\n    this.getMouseOnScreen = function ( clientX, clientY ) {\n\n        return new THR51.Vector2(\n            ( clientX - _this.screen.offsetLeft ) / _this.radius * 0.5,\n            ( clientY - _this.screen.offsetTop ) / _this.radius * 0.5\n        );\n\n    };\n\n    this.getMouseProjectionOnBall = function ( clientX, clientY ) {\n\n        var mouseOnBall = new THR51.Vector3(\n            ( clientX - _this.screen.width * 0.5 - _this.screen.offsetLeft ) / _this.radius,\n            ( _this.screen.height * 0.5 + _this.screen.offsetTop - clientY ) / _this.radius,\n            0.0\n        );\n\n        var length = mouseOnBall.length();\n\n        if ( length > 1.0 ) {\n\n            mouseOnBall.normalize();\n\n        } else {\n\n            mouseOnBall.z = Math.sqrt( 1.0 - length * length );\n\n        }\n\n        var projection = _this.camera.up.clone().setLength( mouseOnBall.y );\n        projection.addSelf( _this.camera.up.clone().crossSelf( _this.eye ).setLength( mouseOnBall.x ) );\n        projection.addSelf( _this.eye.clone().setLength( mouseOnBall.z ) );\n\n        return projection;//(new THR51.Quaternion).setFromEuler(_this.object.rotation.clone()/*.negate()*/).multiplyVector3(projection);\n\n    };\n\n    this.rotateCamera = function () {\n        var angle = Math.acos( _rotateStart.dot( _rotateEnd ) / _rotateStart.length() / _rotateEnd.length() );\n        if ( angle ) {\n            var axis = ( new THR51.Vector3() ).cross( _rotateStart, _rotateEnd ).normalize();\n            angle *= _this.rotateSpeed;\n\n            if ( _this.staticMoving )\n                _rotateStart = _rotateEnd;\n            else {\n                _rotateStart.multiplyScalar(1 - _this.dynamicDampingFactor).addSelf(_rotateEnd.clone().multiplyScalar(_this.dynamicDampingFactor));\n                //var quaternion = new THR51.Quaternion();\n                //quaternion.setFromAxisAngle( axis, angle * ( _this.dynamicDampingFactor - 1.0 ) );\n                //quaternion.multiplyVector3( _rotateStart );\n            }\n\n            _this.object.useQuaternion = true;\n            _this.object.quaternion.clone().inverse().multiplyVector3(axis);\n            _this.object.quaternion.multiplySelf((new THR51.Quaternion).setFromAxisAngle(axis, angle));\n\n            // Apply to all global instances\n            _.forEach(globalInstances, function(instance){\n                instance.boardControls.object.useQuaternion = true;\n                instance.boardControls.object.quaternion = _this.object.quaternion;\n            })\n\n        }\n\n    };\n\n\n    this.zoomCamera = function () {\n        var factor = 1.0 + ( _zoomEnd.y - _zoomStart.y ) * _this.zoomSpeed;\n        if ( factor !== 1.0 && factor > 0.0 ) {\n            _.forEach(globalInstances, function(instance){\n                instance.boardControls.object.position.y *= factor;\n            })\n            if ( _this.staticMoving ){\n                _zoomStart = _zoomEnd;\n            }\n            else{\n                _zoomStart.y += ( _zoomEnd.y - _zoomStart.y ) * this.dynamicDampingFactor;\n            }\n        }\n\n    };\n\n    this.panCamera = function () {\n        var mouseChange = _panEnd.clone().subSelf( _panStart );\n        if ( mouseChange.x || mouseChange.y ) {\n            mouseChange.multiplyScalar( Math.abs(_this.object.position.y) * _this.panSpeed );\n            var pan = _this.eye.clone().crossSelf( _this.camera.up ).setLength( mouseChange.x );\n            pan.addSelf( _this.camera.up.clone().setLength( mouseChange.y ) );\n            var panAbs = _this.object.position.subSelf( pan );\n\n            // Apply to all global instances\n            _.forEach(globalInstances, function(instance){\n                instance.boardControls.object.position = panAbs;\n            })\n\n            if ( _this.staticMoving ){\n                _panStart = _panEnd;\n            }\n            else{\n                _panStart.addSelf( mouseChange.sub( _panEnd, _panStart ).multiplyScalar( _this.dynamicDampingFactor ) );\n            }\n        }\n    };\n\n    this.update = function () {\n        if ( !_this.noRotate )\n            _this.rotateCamera();\n        if ( !_this.noZoom )\n            _this.zoomCamera();\n        if ( !_this.noPan )\n            _this.panCamera();\n    };\n\n    // listeners\n\n    function keydown( event ) {\n\n        if ( ! _this.enabled ) return;\n\n        if ( _this.mouseState !== STATE.NONE ) {\n\n            return;\n\n        } else if ( event.keyCode === _this.keys[ STATE.ROTATE ] && !_this.noRotate ) {\n\n            _this.mouseState = STATE.ROTATE;\n\n        } else if ( event.keyCode === _this.keys[ STATE.ZOOM ] && !_this.noZoom ) {\n\n            _this.mouseState = STATE.ZOOM;\n\n        } else if ( event.keyCode === _this.keys[ STATE.PAN ] && !_this.noPan ) {\n\n            _this.mouseState = STATE.PAN;\n\n        }\n\n        if ( _this.mouseState !== STATE.NONE ) {\n\n            _keyPressed = true;\n\n        }\n\n    };\n\n    function keyup( event ) {\n\n        if ( ! _this.enabled ) return;\n\n        if ( _this.mouseState !== STATE.NONE ) {\n\n            _this.mouseState = STATE.NONE;\n\n        }\n\n    };\n\n    function mousedown( event ) {\n        if ( ! _this.enabled ) return;\n\n\n        event.preventDefault();\n        event.stopPropagation();\n\n        if ( _this.mouseState === STATE.NONE ) {\n\n            // Globalise mouse state\n            _.forEach(globalInstances, function(instance){\n                instance.boardControls.mouseState = event.button\n            })\n\n            _this.mouseState = event.button;\n\n            if ( _this.mouseState === STATE.ROTATE && !_this.noRotate ) {\n\n                _rotateStart = _rotateEnd = _this.getMouseProjectionOnBall( event.clientX, event.clientY );\n\n            } else if ( _this.mouseState === STATE.ZOOM && !_this.noZoom ) {\n\n                _zoomStart = _zoomEnd = _this.getMouseOnScreen( event.clientX, event.clientY );\n\n            } else if ( !_this.noPan ) {\n\n                _panStart = _panEnd = _this.getMouseOnScreen( event.clientX, event.clientY );\n\n            }\n\n        }\n\n    };\n\n    function mousemove( event ) {\n\n        if ( ! _this.enabled ) return;\n\n        if ( _keyPressed ) {\n\n            _rotateStart = _rotateEnd = _this.getMouseProjectionOnBall( event.clientX, event.clientY );\n            _zoomStart = _zoomEnd = _this.getMouseOnScreen( event.clientX, event.clientY );\n            _panStart = _panEnd = _this.getMouseOnScreen( event.clientX, event.clientY );\n\n            _keyPressed = false;\n\n        }\n\n        if ( _this.mouseState === STATE.NONE ) {\n\n            return;\n\n        } else if ( _this.mouseState === STATE.ROTATE && !_this.noRotate ) {\n\n            _rotateEnd = _this.getMouseProjectionOnBall( event.clientX, event.clientY );\n\n        } else if ( _this.mouseState === STATE.ZOOM && !_this.noZoom ) {\n\n            _zoomEnd = _this.getMouseOnScreen( event.clientX, event.clientY );\n\n        } else if ( _this.mouseState === STATE.PAN && !_this.noPan ) {\n\n            _panEnd = _this.getMouseOnScreen( event.clientX, event.clientY );\n\n        }\n\n    };\n\n    function mouseup( event ) {\n        if ( ! _this.enabled ) return;\n\n        // Globalise mouse state\n        _.forEach(globalInstances, function(instance){\n            instance.boardControls.mouseState = STATE.NONE\n        })\n\n        event.preventDefault();\n        event.stopPropagation();\n        _this.mouseState = STATE.NONE;\n\n    };\n\n    function mousewheel(event) {\n        var amount = 5; // parameter\n        // get wheel direction\n        var d = ((typeof event.wheelDelta != \"undefined\") ? (-event.wheelDelta) : event.detail);\n        d = amount * ((d > 0) ? -1 : 1);\n        var scrollPosition = _this.object.position.y + d < -1 ? _this.object.position.y + d : -1;\n        _.forEach(globalInstances, function(instance){\n            instance.boardControls.object.position.y = scrollPosition;\n\n        })\n    }\n\n    this.domElement.addEventListener( 'contextmenu', function ( event ) { event.preventDefault(); }, false );\n\n    this.domElement.addEventListener( 'mousemove', mousemove, false );\n    this.domElement.addEventListener( 'mousedown', mousedown, false );\n    this.domElement.addEventListener( 'mouseup', mouseup, false );\n    this.domElement.addEventListener('DOMMouseScroll', mousewheel, false);\n    this.domElement.addEventListener('mousewheel', mousewheel, false);\n\n    window.addEventListener( 'keydown', keydown, false );\n    window.addEventListener( 'keyup', keyup, false );\n};\n"]}