{"version":3,"sources":["app\\renderer\\assets\\other\\gerber\\js\\webGerber.js"],"names":[],"mappings":"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","file":"webGerber.js","sourceRoot":"C:/Users/david/repositories/stemn-electron-2","sourcesContent":["import webGerberConstants from './constants/webGerberConstants.js';\nimport ViewEEPCB from './viewee.js';\nimport initGerberParser from './parse/gerber.js';\n//import THR51 from './three.min.js';\nimport ObjectControls from './ObjectControls.js';\nimport RenderGerber from './render/gerber.js';\n\nimport 'javascript-detect-element-resize'; // addResizeListener && removeResizeListener\n\nexport default () => {\n  var wG = {};\n\n  // Defined after init\n  wG.parser = undefined;\n  wG.domParent = undefined;\n\n  wG.constants = {\n    ppmm         : 40,  // Pixels per mm.\n    maxTexSize   : 4096,\n    minTexSize   : 256, // Largest possible texture size.\n    pcbFileTypes : ['pcb', 'brd', 'kicad_pcb'],\n\n    geometry     : {\n      boardThickness: 1.54\n    },\n    materials    : {\n      board: {shininess: 80, ambient: 0x333333, specular: 0xcccccc, color: 0x255005}\n    },\n  };\n\n  wG.index = {\n    BOTTOM   : 1,\n    TOP      : 2,\n    BOTH     : 3,\n\n    BOARD    : 0,\n    COPPER   : 1,\n    SOLDER   : 2,\n    PASTE    : 3,\n    SILK     : 4,\n    OUTLINE  : 5\n  };\n\n  wG.isFlipped = false;\n\n  wG.utils = {\n    isPcb      : isPcb,\n  };\n\n  wG.boards    = {\n    bottom     : {},\n    top        : {},\n    makeBoard  : makeBoard,\n    clearBoard : clearBoard\n  };\n\n  wG.init        = init;           // function(layers, domParent, globalInstances)\n  wG.parse       = parse;\n  wG.destroy     = destroy;\n  wG.flip        = flip;\n  wG.render      = render;\n  wG.renderLayer = renderLayer;\n  wG.center      = center;\n\n\n  /////////////////\n\n  function parse(layer){\n    var parser;\n    if(wG.utils.isPcb(layer.name)){\n      parser = new ViewEEPCB();\n      wG.parser = parser;\n      return parser.findParser(layer.data);\n    }\n    else{\n      parser = new initGerberParser();\n      return parser.parse(layer.data, layer.name);\n    }\n  }\n\n  function flip(flipStatus){\n    wG.isFlipped = flipStatus;\n    wG.boardControls.object.useQuaternion = true;\n    var flipArray = wG.isFlipped ? {x: 0, y: 0, z: 1, w: 0} : {x: 0, y: 0, z: 0, w: 1};\n    _.extend(wG.boardControls.object.quaternion, flipArray);\n  }\n\n  function reposition(){\n    wG.center();\n    wG.boardControls.screen.width = window.innerWidth;\n    wG.boardControls.screen.height = window.innerHeight;\n    wG.boardControls.radius = (window.innerWidth + window.innerHeight) / 4;\n  }\n\n  function destroy(){\n    window.removeResizeListener(wG.domParent, reposition);\n    if(wG.domParent){\n      while (wG.domParent.hasChildNodes()) {\n        wG.domParent.removeChild(wG.domParent.lastChild);\n      }\n    }\n    // jackson's code from http://stackoverflow.com/questions/21453309/how-can-i-destroy-THR51js-scene\n    cancelAnimationFrame(this.id);// Stop the animation\n    wG.scene = null;\n    wG.projector = null;\n    wG.camera = null;\n    wG.controls = null;\n    wG.destroyed = true;\n  }\n\n  function center(){\n    if(wG.renderer && wG.camera && wG.boardControls){\n      wG.renderer.setSize(wG.domParent.offsetWidth, wG.domParent.offsetHeight);\n      wG.camera.aspect = wG.domParent.offsetWidth / wG.domParent.offsetHeight;\n      wG.camera.updateProjectionMatrix();\n      wG.boardControls.object.useQuaternion = true;\n      var flipArray = wG.isFlipped ? {x: 0, y: 0, z: 1, w: 0} : {x: 0, y: 0, z: 0, w: 1};\n      _.extend(wG.boardControls.object.quaternion, flipArray)\n    }\n  }\n\n  function init(layers, domParent, globalInstances) {\n    wG.domParent = domParent;\n    wG.layers = layers;\n    wG.limits = _.reduce(wG.layers, function(bound, layer) {\n      return {\n        minX : bound.minX < layer.bounds.minX ? bound.minX : layer.bounds.minX,\n        minY : bound.minY < layer.bounds.minY ? bound.minY : layer.bounds.minY,\n        maxX : bound.maxX > layer.bounds.maxX ? bound.maxX : layer.bounds.maxX,\n        maxY : bound.maxY > layer.bounds.maxY ? bound.maxY : layer.bounds.maxY,\n      };\n    }, {});\n\n    _.forEach(wG.layers, function(layer){\n        layer.enabled = true;\n    });\n\n    wG.boards.width  = wG.limits.maxX - wG.limits.minX;\n    wG.boards.height = wG.limits.maxY - wG.limits.minY;\n\n    var has3D = true;\n    try {\n        wG.renderer = new THR51.WebGLRenderer({antialias: true});\n        //wG.constants.ppmm = 20;\n        wG.renderer.sortObjects = false;\n    } catch(e) {\n        console.error('Got WebGL error, falling back to 2D canvas.');\n        has3D = false;\n        wG.constants.ppmm = 20;\n        wG.renderer = new THR51.CanvasRenderer({antialias: true});\n    }\n\n    wG.scene  = new THR51.Scene();\n    wG.camera = new THR51.PerspectiveCamera(40);\n    wG.camera.up.set(0, 0, -1);\n    wG.scene.add(wG.camera);\n\n    // Ambient light.\n    var ambientLight = new THR51.AmbientLight(0xcccccc);\n    wG.scene.add(ambientLight);\n\n    // Sun light.\n    if(has3D) {\n        var sunLight = new THR51.SpotLight(0xcccccc, .3);\n        sunLight.position.set(0, 150000, 0);\n        wG.scene.add(sunLight);\n    }\n\n    // Board.\n    var Material = has3D ? THR51.MeshPhongMaterial : THR51.MeshBasicMaterial;\n    wG.boards.bottom.canvas = wG.boards.makeBoard(wG.boards.width, wG.boards.height);\n    wG.boards.top.canvas    = wG.boards.makeBoard(wG.boards.width, wG.boards.height, true);\n    wG.boards.bottom.texture = new THR51.Texture(wG.boards.bottom.canvas);\n    wG.boards.top.texture    = new THR51.Texture(wG.boards.top.canvas);\n    wG.boards.clearBoard(wG.boards.bottom.canvas);\n    wG.boards.clearBoard(wG.boards.top.canvas);\n    wG.boards.bottom.texture.needsUpdate = true, wG.boards.top.texture.needsUpdate = true;\n    var materials = [\n        null,\n        null,\n        new Material({shininess: 80, ambient: 0xaaaaaa, specular: 0xcccccc, map: wG.boards.top.texture}),\n        new Material({shininess: 80, ambient: 0xaaaaaa, specular: 0xcccccc, map: wG.boards.bottom.texture}),\n        null,\n        null\n    ];\n    if(!has3D){\n        materials[2].overdraw = true, materials[3].overdraw = true;\n    }\n    wG.board = new THR51.Mesh(new THR51.CubeGeometry(wG.boards.width, wG.constants.geometry.boardThickness, wG.boards.height, has3D ? 1 : Math.ceil(wG.boards.width / 3), 1, has3D ? 1 : Math.ceil(wG.boards.height / 3), materials, {px: 0, nx: 0, pz: 0, nz: 0}), new THR51.MeshFaceMaterial());\n    wG.board.position.y = -100;\n\n    if(has3D){\n        wG.scene.add(wG.board);\n    }\n\n    // Add the sides.\n    var boardSides = new THR51.CubeGeometry(wG.boards.width, wG.constants.geometry.boardThickness, wG.boards.height, 1, 1, 1, undefined, {py: 0, ny: 0});\n    var boardMaterial = new Material(wG.constants.materials.board);\n    //boardSides.computeVertexNormals();\n    boardSides = new THR51.Mesh(boardSides, boardMaterial);\n    wG.board.add(boardSides);\n\n    // Create all the holes.\n    drillHoles(boardMaterial);\n\n    if(!has3D){\n        wG.scene.add(wG.board);\n    }\n\n    wG.camera.lookAt(wG.board.position);\n    wG.boardControls        = new ObjectControls(wG.board, wG.renderer.domElement, globalInstances);\n    wG.boardControls.camera = wG.camera;\n    wG.boardControls.eye    = wG.camera.position.clone().subSelf(wG.board.position);\n\n    // Resize handler.\n    window.addResizeListener(wG.domParent, reposition);\n    setTimeout(reposition, 1);\n\n    // Add element to DOM\n    domParent.appendChild(wG.renderer.domElement);\n\n    // Sort by type, but after listing them.\n    wG.layers.sort(function(a, b) {\n        return (a.type || 10) - (b.type || 10);\n    });\n\n    wG.repaint = 0;\n    // Renders the scene (and repaints all the textures that need repainting.\n    wG.render();\n  }\n\n  function drillHoles(boardMaterial){\n    var holeMaterial = boardMaterial.clone();\n    holeMaterial.side = THR51.BackSide;\n    if(wG.layers[0].isGerber){\n      _.forEach(wG.layers, function(layer){\n        if(layer.type == wG.index.BOARD){\n          _.forEach(layer.cmds, function(cmd){\n            var r    = layer.scale*layer.shapes[cmd[1]][1]/2;\n            var hole = new THR51.CylinderGeometry(r, r, wG.constants.geometry.boardThickness, 32, 0, true);\n            //hole.computeVertexNormals();\n            hole = new THR51.Mesh(hole, holeMaterial);\n            hole.position.x = (cmd[2]*layer.scale-wG.limits.minX)-wG.boards.width/2;\n            hole.position.z = wG.boards.height/2-(cmd[3]*layer.scale-wG.limits.minY);\n            wG.board.add(hole);\n          });\n        }\n      });\n    }\n    else {\n      // Else this is a pcb file - we drill the plainHoles\n      _.forEach(wG.layers[0].plainHoles, function(cmd){\n        var r    = cmd.drill/2;\n        var hole = new THR51.CylinderGeometry(r, r, wG.constants.geometry.boardThickness, 32, 0, true);\n        //hole.computeVertexNormals();\n        hole = new THR51.Mesh(hole, holeMaterial);\n        hole.position.x = cmd.x - wG.boards.width/2;\n        hole.position.z = wG.boards.height/2- cmd.y;\n        wG.board.add(hole);\n      });\n    }\n  }\n\n  function render() {\n    // jackson's hack to stop rendering after destroying canvas. PROBABLY BAD AS MEMORY IS LEFT AROUND\n    if (wG.destroyed) return;\n    requestAnimationFrame(render);\n    if(wG.repaint !== null) {\n      if(wG.callbacks && wG.callbacks.renderStart){\n        wG.callbacks.renderStart()\n      }\n      if(wG.repaint === 0){\n        wG.boards.clearBoard(wG.boards.bottom.canvas);\n        wG.boards.clearBoard(wG.boards.top.canvas);\n        wG.repaint++;\n      }\n      else {\n        // Skip any disabled layers.\n        while(wG.repaint <= wG.layers.length && !wG.layers[wG.repaint-1].enabled)\n          wG.repaint++;\n\n        if(wG.repaint <= wG.layers.length) { // wG.repaint a layer.\n          if(wG.layers[wG.repaint-1].side == wG.index.TOP){\n            wG.renderLayer(wG.boards.top.canvas, wG.layers[wG.repaint-1], wG.limits);\n          }\n          else if(wG.layers[wG.repaint-1].side == wG.index.BOTTOM){\n            wG.renderLayer(wG.boards.bottom.canvas, wG.layers[wG.repaint-1], wG.limits);\n          }\n          else if(wG.layers[wG.repaint-1].side == wG.index.BOTH){\n            wG.renderLayer(wG.boards.top.canvas, wG.layers[wG.repaint-1], wG.limits);\n            wG.renderLayer(wG.boards.bottom.canvas, wG.layers[wG.repaint-1], wG.limits);\n          }\n        }\n\n        // Are we finished repainting?\n        if(wG.repaint > wG.layers.length){\n          wG.repaint = null;\n          wG.boards.bottom.texture.needsUpdate = true;\n          wG.boards.top.texture.needsUpdate = true;\n          if(wG.callbacks && wG.callbacks.renderComplete){\n            wG.callbacks.renderComplete()\n          }\n        }\n        else\n          wG.repaint++;\n      }\n    }\n    wG.boardControls.update();\n    wG.renderer.render(wG.scene, wG.camera);\n  };\n\n  function renderLayer(canvas, board, limits) {\n    if(!board.canvas) {\n      board.canvas = document.createElement('canvas');\n      board.canvas.width = canvas.width;\n      board.canvas.height = canvas.height;\n      if(board.isGerber){\n        RenderGerber.renderLayer(board.canvas, board, limits);\n      }\n      else{\n        board.render(canvas);\n      }\n    }\n    var ctx = canvas.getContext('2d');\n    ctx.globalCompositeOperation = board.type ? 'source-over' : 'destination-out';\n    if(canvas.inverted){\n      ctx.setTransform(1, 0, 0,-1, 0, canvas.height);\n    }\n    else{\n      ctx.setTransform(1, 0, 0, 1, 0, 0);\n    }\n\n    ctx.drawImage(board.canvas, 0, 0);\n  };\n\n\n  // Creates a 2D canvas that is a board side texture, for the given width and height.\n  function makeBoard(w, h, inverted) {\n    var canvas = document.createElement('canvas');\n    //canvas.width = w*wG.constants.ppmm, canvas.height = h*wG.constants.ppmm;\n    /*var maxSize = Math.max(w*wG.constants.ppmm, h*wG.constants.ppmm) >> 1, size = 1;\n    while(size < maxSize && size < wG.constants.maxTexSize)\n        size <<= 1;*/\n    canvas.width = texSize(w*wG.constants.ppmm);\n    canvas.height = texSize(h*wG.constants.ppmm);\n\n    // Don't allow mipmapping for stretched textures.\n    var stretch = canvas.width/canvas.height;\n    if(stretch > 4)\n      canvas.width--;\n    else if(stretch < .25)\n      canvas.height--;\n//        canvas.invertedY = invertedY;\n  canvas.inverted = inverted;\n\n    // Debugging: adds canvas to the page.\n    /*canvas.className = 'layer';\n    document.body.appendChild(canvas);*/\n    return canvas;\n  }\n\n  // Clears a 2D canvas that is a board side texture.\n  function clearBoard(canvas) {\n    var ctx = canvas.getContext('2d');\n    ctx.globalCompositeOperation = 'source-over';\n    ctx.fillStyle = webGerberConstants.colors.board;\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n  }\n\n\n  // Returns true if the filetype is that of a pcb/brd\n  function isPcb(fileName){\n    var nameSplit = fileName.split('.');\n    return wG.constants.pcbFileTypes.indexOf(nameSplit[nameSplit.length-1]) != -1\n  }\n\n\n\n  // Internal Functions ------------------------------------------------------------------\n\n  // Finds the closest power of two to the given size of a texture (needed for mipmapping).\n  function texSize(x) {\n    x = Math.min(Math.max(x, wG.constants.minTexSize), wG.constants.maxTexSize);\n    var r = 1;\n    while(r < x)\n      r <<= 1;\n    return r;\n  }\n\n  return wG\n}\n"]}