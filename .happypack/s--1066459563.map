{"version":3,"sources":["app\\renderer\\main\\modules\\Files\\PreviewFile\\PreviewCad\\AutodeskViewer\\autodeskViewerUtils.js"],"names":[],"mappings":";;;;;;AAAA;;;;AACA;;;;AAEA,IAAI,WAAiB,EAAC,UAAU,EAAE,KAAK,CAAC,CAAD,CAAP,EAAX,EAArB;AACA,IAAM,SAAe,EAAC,UAAU,IAAX,EAArB;AACA,IAAI,eAAe,KAAnB;;AAEA,IAAM,UAAU;AACd,mBAAkB,EADJ;AAEd,YAAW,QAFG;AAGd,cAAa;AAHC,CAAhB;;kBAMe,O;;AAEf;;;AAGA,SAAS,QAAT,CAAkB,QAAlB,EAA2B;AACzB,MAAI,KAAK,wBAAT;AACA,MAAI,WAAW,IAAI,OAAO,QAAP,CAAgB,OAAhB,CAAwB,OAAxB,CAAgC,WAApC,CAAgD,QAAhD,EAA0D,EAA1D,CAAf;AACA,WAAS,EAAT,GAAc,EAAd;AACA,UAAQ,eAAR,CAAwB,IAAxB,CAA6B,QAA7B;AACA,MAAG,QAAQ,eAAR,CAAwB,MAAxB,GAAiC,CAAjC,IAAsC,CAAC,YAA1C,EAAuD;AACrD,mBAAe,IAAf;;AAEA,qBAAiB,QAAjB,EAA2B,uEAA3B,EAAoG,MAApG;AACD;AACD,SAAO,QAAP;AACD;;AAED,SAAS,UAAT,CAAoB,QAApB,EAA6B;AAC3B,MAAG,QAAH,EAAY;AACV,YAAQ,eAAR,CAAwB,MAAxB,CAA+B,uBAAU,QAAQ,eAAlB,EAAmC,IAAnC,EAAyC,SAAS,EAAlD,CAA/B,EAAqF,CAArF;AACA,QAAG,QAAQ,eAAR,CAAwB,MAAxB,GAAiC,CAAjC,IAAsC,YAAzC,EAAsD;AACpD,qBAAe,KAAf;AACA,0BAAoB,QAApB,EAA8B,uEAA9B,EAAuG,MAAvG;AACD;AACD,aAAS,MAAT;AACD;AACF;;AAED,SAAS,MAAT,GAAiB;AACf,MAAG,QAAQ,eAAR,IAA2B,QAAQ,eAAR,CAAwB,MAAxB,GAAiC,CAA/D,EAAiE;AAC/D,QAAI,QAAJ;AACA,QAAI,eAAe,EAAnB;AACA,yBAAQ,QAAQ,eAAhB,EAAiC,UAAS,QAAT,EAAkB;AACjD,UAAG,SAAS,WAAZ,EAAwB;AACtB,YAAI,mBAAmB,SAAS,QAAT,CAAkB,MAAlB,CAAvB;AACA;AACA,YAAG,iBAAiB,QAAjB,CAA0B,GAA1B,CAA8B,CAA9B,KAAoC,SAAS,QAAT,CAAkB,GAAlB,CAAsB,CAAtB,CAAvC,EAAgE;AAC9D,qBAAW,gBAAX;AACD,SAFD,MAGI;AACF,uBAAa,IAAb,CAAkB,QAAlB;AACD;AACF;AACF,KAXD;;AAaA;AACA,QAAG,QAAH,EAAY;AACV,UAAG,aAAa,MAAb,GAAsB,CAAzB,EAA2B;AACzB,6BAAQ,YAAR,EAAsB,UAAS,QAAT,EAAkB;AACtC,mBAAS,YAAT,CAAsB,QAAtB,EAAgC,MAAhC,EAAwC,IAAxC;AACD,SAFD;AAGD;AACD,iBAAW,QAAX;AACD;AACF;AACF;;AAED,SAAS,gBAAT,CAA0B,EAA1B,EAA8B,MAA9B,EAAsC,EAAtC,EAA0C;AACxC,SAAO,KAAP,CAAa,GAAb,EAAkB,OAAlB,CAA0B;AAAA,WAAS,GAAG,gBAAH,CAAoB,KAApB,EAA2B,EAA3B,CAAT;AAAA,GAA1B;AACD;AACD,SAAS,mBAAT,CAA6B,EAA7B,EAAiC,MAAjC,EAAyC,EAAzC,EAA6C;AAC3C,SAAO,KAAP,CAAa,GAAb,EAAkB,OAAlB,CAA0B;AAAA,WAAS,GAAG,mBAAH,CAAuB,KAAvB,EAA8B,EAA9B,CAAT;AAAA,GAA1B;AACD","file":"autodeskViewerUtils.js","sourceRoot":"C:/Users/david/repositories/stemn-electron-2","sourcesContent":["import getUuid from 'app/shared/helpers/getUuid.js';\nimport { findIndex, forEach } from 'lodash';\n\nlet oldState       = {viewport: { eye: [1]}};\nconst filter       = {viewport: true};\nlet syncIsActive = false;\n\nconst library = {\n  activeInstances : [],\n  register : register,\n  deregister : deregister,\n}\n\nexport default library\n\n////////////////////////////////////////////\n\n\nfunction register(viewerEl){\n  var id = getUuid();\n  var instance = new window.Autodesk.Viewing.Private.GuiViewer3D(viewerEl, {});\n  instance.id = id;\n  library.activeInstances.push(instance);\n  if(library.activeInstances.length > 1 && !syncIsActive){\n    syncIsActive = true;\n\n    addListenerMulti(document, 'mousemove vmousemove mousewheel click mousedown DOMMouseScroll scroll', onMove);\n  }\n  return instance;\n}\n\nfunction deregister(instance){\n  if(instance){\n    library.activeInstances.splice(findIndex(library.activeInstances, 'id', instance.id),1);\n    if(library.activeInstances.length < 2 && syncIsActive){\n      syncIsActive = false;\n      removeListenerMulti(document, 'mousemove vmousemove mousewheel click mousedown DOMMouseScroll scroll', onMove);\n    }\n    instance.finish();\n  }\n}\n\nfunction onMove(){\n  if(library.activeInstances && library.activeInstances.length > 1){\n    var newState;\n    var oldInstances = [];\n    forEach(library.activeInstances, function(instance){\n      if(instance.viewerState){\n        var possibleNewState = instance.getState(filter);\n        // If the state is different, this is the new state!\n        if(possibleNewState.viewport.eye[0] != oldState.viewport.eye[0]){\n          newState = possibleNewState;\n        }\n        else{\n          oldInstances.push(instance);\n        }\n      }\n    });\n\n    // If there is a new state, update the old instances\n    if(newState){\n      if(oldInstances.length > 0){\n        forEach(oldInstances, function(instance){\n          instance.restoreState(newState, filter, true)\n        })\n      }\n      oldState = newState;\n    }\n  }\n}\n\nfunction addListenerMulti(el, events, fn) {\n  events.split(' ').forEach(event => el.addEventListener(event, fn));\n}\nfunction removeListenerMulti(el, events, fn) {\n  events.split(' ').forEach(event => el.removeEventListener(event, fn));\n}\n"]}