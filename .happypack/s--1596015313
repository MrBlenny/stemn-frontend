'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.Component = undefined;

var _index = require('C:\\Users\\david\\repositories\\stemn-electron-2\\node_modules\\redbox-react\\lib\\index.js');

var _index2 = _interopRequireDefault(_index);

var _index3 = require('C:\\Users\\david\\repositories\\stemn-electron-2\\node_modules\\react-transform-catch-errors\\lib\\index.js');

var _index4 = _interopRequireDefault(_index3);

var _react2 = require('react');

var _react3 = _interopRequireDefault(_react2);

var _index5 = require('C:\\Users\\david\\repositories\\stemn-electron-2\\node_modules\\react-transform-hmr\\lib\\index.js');

var _index6 = _interopRequireDefault(_index5);

var _redux = require('redux');

var _reactRedux = require('react-redux');

var _CommentsActions = require('app/renderer/main/modules/Comments/Comments.actions.js');

var CommentsActions = _interopRequireWildcard(_CommentsActions);

var _ModalActions = require('app/renderer/main/modules/Modal/Modal.actions.js');

var ModalActions = _interopRequireWildcard(_ModalActions);

var _reactReduxForm = require('react-redux-form');

var _moment = require('moment');

var _moment2 = _interopRequireDefault(_moment);

var _classnames = require('classnames');

var _classnames2 = _interopRequireDefault(_classnames);

var _Comment = require('./Comment.css');

var _Comment2 = _interopRequireDefault(_Comment);

var _UserAvatar = require('app/renderer/main/components/Avatar/UserAvatar/UserAvatar.jsx');

var _UserAvatar2 = _interopRequireDefault(_UserAvatar);

var _Editor = require('app/renderer/main/modules/Editor/Editor.jsx');

var _Editor2 = _interopRequireDefault(_Editor);

var _EditorDisplay = require('app/renderer/main/modules/Editor/EditorDisplay.jsx');

var _EditorDisplay2 = _interopRequireDefault(_EditorDisplay);

var _ReactionPopup = require('app/renderer/main/modules/Reactions/ReactionPopup.jsx');

var _ReactionPopup2 = _interopRequireDefault(_ReactionPopup);

var _Reactions = require('app/renderer/main/modules/Reactions/Reactions.jsx');

var _Reactions2 = _interopRequireDefault(_Reactions);

var _PopoverMenu = require('app/renderer/main/components/PopoverMenu/PopoverMenu');

var _PopoverMenu2 = _interopRequireDefault(_PopoverMenu);

var _SimpleIconButton = require('app/renderer/main/components/Buttons/SimpleIconButton/SimpleIconButton');

var _SimpleIconButton2 = _interopRequireDefault(_SimpleIconButton);

var _moreHoriz = require('react-icons/md/more-horiz');

var _moreHoriz2 = _interopRequireDefault(_moreHoriz);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _components = {
  _component: {}
};

var _CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformHmrLibIndexJs2 = (0, _index6.default)({
  filename: 'C:/Users/david/repositories/stemn-electron-2/app/renderer/main/modules/Comments/Comment/Comment.jsx',
  components: _components,
  locals: [module],
  imports: [_react3.default]
});

var _CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformCatchErrorsLibIndexJs2 = (0, _index4.default)({
  filename: 'C:/Users/david/repositories/stemn-electron-2/app/renderer/main/modules/Comments/Comment/Comment.jsx',
  components: _components,
  locals: [],
  imports: [_react3.default, _index2.default]
});

function _wrapComponent(id) {
  return function (Component) {
    return _CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformHmrLibIndexJs2(_CUsersDavidRepositoriesStemnElectron2Node_modulesReactTransformCatchErrorsLibIndexJs2(Component, id), id);
  };
} // Container Core


// Container Actions


// Component Core


// Styles


// Sub Components


/////////////////////////////////////////////////////////////////////////////
///////////////////////////////// COMPONENT /////////////////////////////////
/////////////////////////////////////////////////////////////////////////////

var onMount = function onMount(nextProps, prevProps) {
  if (!prevProps || nextProps.commentId !== prevProps.commentId) {
    nextProps.commentsActions.getComment({ commentId: nextProps.commentId });
  }
};

var Component = exports.Component = _wrapComponent('_component')(_react3.default.createClass({
  displayName: 'Component',


  // Mounting
  componentWillMount: function componentWillMount() {
    onMount(this.props);
  },
  componentWillReceiveProps: function componentWillReceiveProps(nextProps) {
    onMount(nextProps, this.props);
  },
  confirmDelete: function confirmDelete() {
    this.props.modalActions.showConfirm({
      modalConfirm: {
        functionAlias: 'CommentsActions.deleteComment',
        functionInputs: { comment: this.props.comment.data }
      }
    });
  },
  submitReaction: function submitReaction(reactionType) {
    this.props.commentsActions.toggleReaction({
      commentId: this.props.commentId,
      reactionType: reactionType
    });
  },
  render: function render() {
    var _props = this.props;
    var item = _props.item;
    var comment = _props.comment;
    var entityModel = _props.entityModel;
    var commentsActions = _props.commentsActions;
    var style = _props.style;


    if (!comment || !comment.data) {
      return null;
    }

    return _react3.default.createElement(
      'div',
      { className: _Comment2.default.comment + ' layout-row', style: style },
      _react3.default.createElement(
        'div',
        { className: _Comment2.default.commentAvatar },
        _react3.default.createElement(_UserAvatar2.default, { picture: comment.data.owner.picture, size: '33', shape: 'square' })
      ),
      _react3.default.createElement(
        'div',
        { className: _Comment2.default.commentBody + ' flex' },
        _react3.default.createElement(
          'div',
          { className: _Comment2.default.commentHeader + ' layout-row layout-align-start-center' },
          comment.data.owner.name,
          _react3.default.createElement(
            'span',
            { className: _Comment2.default.date },
            ' ',
            _react3.default.createElement('b', { className: 'text-interpunct' }),
            ' ',
            (0, _moment2.default)(comment.data.timestamp).fromNow(),
            ' '
          ),
          _react3.default.createElement('div', { className: 'flex' }),
          _react3.default.createElement(_ReactionPopup2.default, { reactions: comment.data.reactions, preferPlace: 'above', submitFn: this.submitReaction }),
          _react3.default.createElement(
            _PopoverMenu2.default,
            { preferPlace: 'right' },
            _react3.default.createElement(
              _SimpleIconButton2.default,
              { style: { padding: '0 0 0 5px' } },
              _react3.default.createElement(_moreHoriz2.default, { size: '20px' })
            ),
            _react3.default.createElement(
              'div',
              { className: 'PopoverMenu' },
              comment.editActive ? null : _react3.default.createElement(
                'a',
                { onClick: function onClick() {
                    return commentsActions.startEdit({ commentId: comment.data._id });
                  } },
                'Edit'
              ),
              _react3.default.createElement(
                'a',
                { onClick: this.confirmDelete },
                'Delete'
              )
            )
          )
        ),
        _react3.default.createElement(
          'div',
          { className: _Comment2.default.commentContent },
          comment.editActive ? _react3.default.createElement(_Editor2.default, { model: entityModel + '.data.body', value: comment.data.body }) : _react3.default.createElement(_EditorDisplay2.default, { value: comment.data.body })
        ),
        comment.editActive ? _react3.default.createElement(
          'div',
          { className: _Comment2.default.commentFooter },
          _react3.default.createElement(
            'div',
            null,
            _react3.default.createElement(
              'a',
              { className: 'link-primary', onClick: function onClick() {
                  return commentsActions.finishEdit({ commentId: comment.data._id });
                } },
              'Cancel'
            ),
            ' ',
            _react3.default.createElement('b', { className: 'text-interpunct text-grey-3' }),
            ' ',
            _react3.default.createElement(
              'a',
              { className: 'link-primary', onClick: function onClick() {
                  return commentsActions.updateComment({ comment: comment.data });
                } },
              'Save'
            )
          )
        ) : '',
        !comment.editActive && comment.data.reactions && comment.data.reactions.length > 0 ? _react3.default.createElement(
          'div',
          null,
          _react3.default.createElement(_Reactions2.default, { reactions: comment.data.reactions })
        ) : ''
      )
    );
  }
}));

/////////////////////////////////////////////////////////////////////////////
///////////////////////////////// CONTAINER /////////////////////////////////
/////////////////////////////////////////////////////////////////////////////

function mapStateToProps(_ref, _ref2) {
  var comments = _ref.comments;
  var commentId = _ref2.commentId;

  return {
    comment: comments.data[commentId],
    entityModel: 'comments.data.' + commentId
  };
}

function mapDispatchToProps(dispatch) {
  return {
    commentsActions: (0, _redux.bindActionCreators)(CommentsActions, dispatch),
    modalActions: (0, _redux.bindActionCreators)(ModalActions, dispatch),
    dispatch: dispatch
  };
}

exports.default = (0, _reactRedux.connect)(mapStateToProps, mapDispatchToProps)(Component);